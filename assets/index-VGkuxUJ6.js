import{u as V,r as d,j as s,i as G,B as Le,a as Ee,b as ke,E as oe,R as Pe}from"./vendor-XPNbIhcT.js";import{R as Ae}from"./react-dom-BYbQ8dEu.js";import{t as Re,i as Ne,f as Me,l as Te,c as Ie,a as Fe}from"./i18n-en-84MEhzKe.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(a){if(a.ep)return;a.ep=!0;const c=e(a);fetch(a.href,c)}})();const De="modulepreload",Oe=function(t){return"/poke-corpus/"+t},ce={},E=function(n,e,o){let a=Promise.resolve();if(e&&e.length>0){let l=function(g){return Promise.all(g.map(w=>Promise.resolve(w).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),v=r?.nonce||r?.getAttribute("nonce");a=l(e.map(g=>{if(g=Oe(g),g in ce)return;ce[g]=!0;const w=g.endsWith(".css"),h=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${h}`))return;const C=document.createElement("link");if(C.rel=w?"stylesheet":De,w||(C.as="script"),C.crossOrigin="",C.href=g,v&&C.setAttribute("nonce",v),document.head.appendChild(C),w)return new Promise((P,L)=>{C.addEventListener("load",P),C.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${g}`)))})}))}function c(l){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=l,window.dispatchEvent(r),!r.defaultPrevented)throw l}return a.then(l=>{for(const r of l||[])r.status==="rejected"&&c(r.reason);return n().catch(c)})};function Ve(t={}){const{immediate:n=!1,onNeedRefresh:e,onOfflineReady:o,onRegistered:a,onRegisteredSW:c,onRegisterError:l}=t;let r,v;const g=async(h=!0)=>{await v};async function w(){if("serviceWorker"in navigator){if(r=await E(async()=>{const{Workbox:h}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:h}},[]).then(({Workbox:h})=>new h("/poke-corpus/sw.js",{scope:"/poke-corpus/",type:"classic"})).catch(h=>{l?.(h)}),!r)return;r.addEventListener("activated",h=>{(h.isUpdate||h.isExternal)&&window.location.reload()}),r.addEventListener("installed",h=>{h.isUpdate||o?.()}),r.register({immediate:n}).then(h=>{c?c("/poke-corpus/sw.js",h):a?.(h)}).catch(h=>{l?.(h)})}}return v=w(),g}const ie=t=>t.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&");function H(t){try{return localStorage.getItem(t)}catch{return null}}function K(t,n){try{localStorage.setItem(t,n)}catch{return}}function $e(t){try{localStorage.removeItem(t)}catch{return}}const me=["system","light","dark"],fe=t=>me.some(n=>t===n),qe=t=>typeof t=="string"&&fe(t)?t:"system",pe=()=>qe(H("mode")),se=500,Be=t=>!Number.isNaN(t)&&Number.isInteger(t)&&t>0,ze=()=>{const t=+(H("corpus-limit")??se);return Number.isNaN(t)?se:t},Ue=()=>H("corpus-richText")!=="false",le=["byte","kilobyte","megabyte","gigabyte","terabyte","petabyte"];function Q(t){const n=Math.min(Math.floor((t.toString().length-1)/3),le.length-1),e={style:"unit",unit:le[n],unitDisplay:n===0?"long":"short",minimumFractionDigits:n===0?0:1,maximumFractionDigits:1,maximumSignificantDigits:3,roundingPriority:"lessPrecision"};return{amount:t/Math.pow(1e3,n),formatParams:{amount:e}}}function We(t,n=1){return{amount:t,formatParams:{amount:{style:"percent",minimumFractionDigits:n,maximumFractionDigits:n}}}}function je(t){try{return JSON.parse(t)}catch(n){return console.error(n),null}}const He=[{code:"en",name:"English (United States)"},{code:"en-GB",name:"English (United Kingdom)"},{code:"ja",name:"日本語"},{code:"de",name:"Deutsch"},{code:"fr",name:"Français (France)"},{code:"fr-CA",name:"Français (Canada)"},{code:"es",name:"Español (España)"},{code:"it",name:"Italiano"},{code:"ko",name:"한국어"},{code:"zh-Hans",name:"简体中文"},{code:"zh-Hant",name:"繁体中文"}];function Ge({showModal:t,richText:n,richTextRef:e,limit:o,limitRef:a}){const{t:c}=V(),[l,r]=d.useState(pe),v=h=>{G.changeLanguage(h.target.value,C=>{C?.some(P=>!P.message.includes("Unknown variable dynamic import"))&&(console.error(C),t({message:c("options.network"),buttons:[{message:s.jsx(ve,{}),autoFocus:!0}]}))}).catch(C=>{console.error(C)})},g=h=>{const C=h.target.value;fe(C)&&(r(C),K("mode",C),document.body.classList.replace(`mode-${l}`,`mode-${C}`))},w=h=>{const C=h.target.value;(C==="true"||C==="false")&&K("corpus-longURL",C)};return s.jsx("div",{className:"options",children:s.jsxs("div",{className:"options-grid",children:[s.jsx("label",{htmlFor:"language",children:c("options.language")}),s.jsx("select",{name:"language",id:"language",onChange:v,defaultValue:G.language,autoFocus:!0,translate:"no",children:He.map(h=>s.jsx("option",{value:h.code,lang:h.code,children:h.name},h.code))}),s.jsx("label",{htmlFor:"mode",children:c("options.mode")}),s.jsx("select",{name:"mode",id:"mode",onChange:g,defaultValue:l,children:me.map(h=>s.jsx("option",{value:h,children:c(`options.modes.${h}`)},h))}),s.jsx("label",{htmlFor:"longURL",children:c("options.longURL")}),s.jsx("select",{name:"longURL",id:"longURL",onChange:w,defaultValue:H("corpus-longURL")??"false",children:["true","false"].map(h=>s.jsx("option",{value:h,children:c(`options.longURLSelect.${h}`)},h))}),s.jsx("label",{htmlFor:"richText",children:c("options.richText")}),s.jsx("select",{ref:e,name:"richText",id:"richText",defaultValue:n?"true":"false",children:["true","false"].map(h=>s.jsx("option",{value:h,children:c(`options.richTextSelect.${h}`)},h))}),s.jsx("label",{htmlFor:"limit",children:c("options.limit")}),s.jsx("input",{ref:a,type:"number",name:"limit",id:"limit",min:1,defaultValue:o})]})})}function ve(){const{t}=V();return t("options.close")}function Ke(t){const{t:n}=V(),{showModal:e,setRichText:o,setLimit:a}=t,c=d.useRef(null),l=d.useRef(null),r=()=>{if(c.current!==null){const g=c.current.value;(g==="true"||g==="false")&&(K("corpus-richText",g),o(g!=="false"))}if(l.current!==null){const g=l.current.valueAsNumber;Be(g)&&(K("corpus-limit",g.toString()),a(g))}},v={classes:["modal-options"],message:s.jsx(Ge,{...t,richTextRef:c,limitRef:l}),buttons:[{message:s.jsx(ve,{}),callback:r}],cancelCallback:r};return s.jsxs("button",{className:"header-options",onClick:()=>{e(v)},children:[s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#gear"})}),n("options.options")]})}function Je(t){return new Worker("/poke-corpus/assets/searchWorkerManager-BMspc0xu.js",{name:t?.name})}function Ze(t){return new Worker("/poke-corpus/assets/textWorker-Xwew4GOV.js",{name:t?.name})}const Qe=["error","regex","noMatch","network","boolean.parentheses","boolean.regex","boolean.slash","boolean.quote","boolean.operand","boolean.empty","boolean.where"],Xe=t=>Qe.some(n=>t===n),Ye=["waiting","loading","processing","collecting"],xe=t=>Ye.some(n=>t===n),J=["exact","regex","boolean","all"],re=t=>J.some(n=>t===n),we={id:"",file:"",query:"",type:"all",caseInsensitive:!0,common:!0,script:!0,showAllLanguages:!0,run:!1},et=t=>({...we,collections:t.collections.filter(n=>t.getCollection(n).structured),languages:t.languages}),tt=t=>{function n(i){const u={};return i.id!==void 0&&(u.id=i.id),i.file!==void 0&&(u.file=i.file),i.run!==void 0&&(u.run=i.run.toString()),new URLSearchParams({query:i.query,type:i.type,caseInsensitive:i.caseInsensitive.toString(),common:i.common.toString(),script:i.script.toString(),showAllLanguages:i.showAllLanguages.toString(),collections:i.collections.join(","),languages:i.languages.join(","),...u}).toString()}function e(i){const u=new URLSearchParams(i);return{id:o(u.get("id")),file:o(u.get("file")),query:o(u.get("query")),type:c(u.get("type")??(u.get("regex")==="true"?"regex":null),re),caseInsensitive:a(u.get("caseInsensitive")),common:a(u.get("common")),script:a(u.get("script")),showAllLanguages:a(u.get("showAllLanguages")),collections:l(u.get("collections"),t.isCollectionKey),languages:l(u.get("languages"),t.isLanguageKey,r),run:a(u.get("run"))}}function o(i){return i??void 0}function a(i){switch(i){case"true":return!0;case"false":return!1}}function c(i,u){if(i!==null&&u(i))return i}function l(i,u,x=k=>k){if(i!==null)return i.split(",").map(x).filter(u)}function r(i){switch(i){case"qid-ZZ":case"ja-JP":case"en-US":case"fr-FR":case"it-IT":case"de-DE":case"es-ES":case"ko-KR":return i.split("-",1)[0];case"ja-Hrkt-JP":return"ja-Hrkt";case"zh-CN":return"zh-Hans";case"zh-TW":return"zh-Hant";default:return i}}const v=t.collections.length^t.languages.length<<4,g=2,w=Math.ceil(t.languages.length/8),h=Math.ceil(t.collections.length/8),C=w+h,P=64,L=Math.ceil(Math.log2(t.languages.length+t.collections.length)),A=g+C,q=i=>btoa(String.fromCodePoint(...i)).replaceAll("/","_").replaceAll("+","-").replace(/=+$/,""),I=i=>Uint8Array.from(atob(i.replaceAll("_","/").replaceAll("-","+")),u=>u.charCodeAt(0));function T(i){const u={};i.id!==void 0&&(u.id=i.id),i.file!==void 0&&(u.file=i.file);const x=B(i);return _(x),new URLSearchParams({...u,q:i.query,s:q(x)}).toString()}function F(i){const u=new URLSearchParams(i),x={id:o(u.get("id")),file:o(u.get("file")),query:o(u.get("q"))},k=o(u.get("s"));if(!k)return x;try{const O=I(k).subarray(0,A);return S(O),{...x,...f(O)}}catch{return x}}function B(i){const u=new Uint8Array(A);u[1]=+(i.run??we.run)<<0|+i.caseInsensitive<<1|+i.common<<2|+i.script<<3|J.indexOf(i.type)<<4|+!i.showAllLanguages<<7;const x=u.subarray(g);p(i,x),j(x,u.subarray(1,2));let k=u.length;for(;u[k-1]===0&&k>1;)k--;return u.subarray(0,k)}function f(i){const u=new Uint8Array(C);i[1]&P?b(i.subarray(g),u):u.set(i.subarray(g));const x=t.languages.filter((O,W)=>U(u,W)===1),k=t.collections.filter((O,W)=>U(u,8*w+W)===1);return{run:(i[1]&1)!==0,caseInsensitive:(i[1]&2)!==0,common:(i[1]&4)!==0,script:(i[1]&8)!==0,type:J[(i[1]&48)>>4],showAllLanguages:(i[1]&128)===0,languages:x,collections:k}}function p(i,u){t.languages.forEach((x,k)=>{i.languages.includes(x)&&N(u,k)}),t.collections.forEach((x,k)=>{i.collections.includes(x)&&N(u,8*w+k)})}function b(i,u){const x=R(i);t.languages.forEach((k,O)=>{x.next().value&&N(u,O)}),t.collections.forEach((k,O)=>{x.next().value&&N(u,8*w+O)})}function j(i,u){const x=U(i,0)===1,k=y(i,x);let O=i.length;for(;i[O-1]===0;)O--;if(1+k.length*L<8*O){u[0]|=P,i.fill(0),x||N(i,0);let W=1;k.forEach(([Ce])=>{for(let te=0;te<L;W++,te++)N(i,W,Ce>>te&1)})}}function y(i,u){const x=[[0,u]];return t.languages.forEach((k,O)=>{const W=U(i,O)===1;x[x.length-1][1]===W?x[x.length-1][0]++:x.push([1,W])}),t.collections.forEach((k,O)=>{const W=U(i,8*w+O)===1;x[x.length-1][1]===W?x[x.length-1][0]++:x.push([1,W])}),x.pop(),x}function*R(i){const u=new Uint8Array(C);u.set(i);let x=U(u,0)!==1;for(let k=1;k+L<=u.length*8;){let O=0;for(let W=0;W<L;k++,W++)O|=U(u,k)<<W;if(O===0)break;for(;O>0;)yield x,O--;x=!x}for(;;)yield x}function N(i,u,x=1){i[u>>3]|=x<<(u&7)}function U(i,u){return i[u>>3]>>(u&7)&1}function _(i){const u=i[0]=M(i);$(u,i)}function S(i){const u=i[0];if($(u,i),u!==M(i))throw Error("invalid checksum")}function M(i,u=1){return i.subarray(u).reduce((x,k)=>x+k&255,0)^v&255}function $(i,u,x=1){let k=m(i);for(let O=x;O<u.length;O++)u[O]^=k>>24,k=D(k)}const m=i=>2480367069*i&4294967295,D=i=>2438952949*i+2654435769&4294967295;function z(i){return(H("corpus-longURL")==="true"?n:T)(i)}function X(i){const u=new URLSearchParams(i);return(u.get("q")||u.get("s")?F:e)(i)}return{_bytesBase64:A,_searchParamsToQueryString:n,_queryStringToSearchParams:e,_searchParamsToBase64:T,_base64ToSearchParams:F,_serializeByteArray:B,_deserializeByteArray:f,_encryptBytes:_,_decryptBytes:S,searchParamsToHash:z,hashToSearchParams:X}};function be(t){return tt(t)}const Z="qid",st="zxx",nt=t=>t!==null&&typeof t=="object"&&"hash"in t&&typeof t.hash=="string"&&"size"in t&&typeof t.size=="number",at=t=>{const n=Object.entries(t.corpus.collections);return Object.fromEntries(n.flatMap(([e,o])=>o.languages.flatMap(a=>o.files.map(c=>Y(e,a,c)))).map((e,o)=>[e,{hash:t.hashes[o],size:t.sizes[o]}]))},ot=t=>{const n=t.corpus,e=Object.keys(n.collections),o=Object.entries(n.collections),a=at(t);return{_corpus:n,collections:e,languages:n.languages,entries:o,metadata:a,getCollection:c=>n.collections[c],isCollectionKey:c=>e.some(l=>c===l),isLanguageKey:c=>n.languages.some(l=>c===l)}},Y=(t,n,e)=>`corpus/${t}/${n}_${e}.txt.gz`,ye="corpus";async function rt(t){const[[n,e],o]=await Promise.all(["caches"in window?caches.open(ye).then(async a=>[a,await a.match(t).catch(()=>{})]).catch(()=>[void 0,void 0]):[void 0,void 0],navigator.onLine?fetch(t).then(a=>a.ok?a:void 0).catch(()=>{}):void 0]);return n&&o&&n.put(t,o.clone()).catch(a=>{console.error(a)}),o??e}async function ct(){const t=await rt("/poke-corpus/data.json");if(t===void 0)throw new TypeError("Failed to fetch corpus data");const n=await t.json();return ot(n)}function _e(t){return{corpus:t._corpus,metadata:t.metadata}}const it=(t,n,e)=>{const o=t[n];return o?typeof o=="function"?o():Promise.resolve(o):new Promise((a,c)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(c.bind(null,new Error("Unknown variable dynamic import: "+n+(n.split("/").length!==e?". Note that variables only represent file names one level deep.":""))))})};G.use(Le).use(Ee).use(ke((t,n)=>it(Object.assign({"./de/collections.json":()=>E(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.c),[]),"./de/files.json":()=>E(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.f),[]),"./de/languages.json":()=>E(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.l),[]),"./de/translation.json":()=>E(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.t),[]),"./en-GB/translation.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.j),[]),"./en/collections.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.d),[]),"./en/files.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.g),[]),"./en/icons.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.h),[]),"./en/languages.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.e),[]),"./en/translation.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.b),[]),"./es/collections.json":()=>E(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.c),[]),"./es/files.json":()=>E(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.f),[]),"./es/languages.json":()=>E(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.l),[]),"./es/translation.json":()=>E(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.t),[]),"./fr-CA/translation.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.t),[]),"./fr/collections.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.c),[]),"./fr/files.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.f),[]),"./fr/languages.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.l),[]),"./fr/translation.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.a),[]),"./it/collections.json":()=>E(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.c),[]),"./it/files.json":()=>E(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.f),[]),"./it/languages.json":()=>E(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.l),[]),"./it/translation.json":()=>E(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.t),[]),"./ja/collections.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.c),[]),"./ja/files.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.f),[]),"./ja/icons.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.i),[]),"./ja/languages.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.l),[]),"./ja/translation.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.t),[]),"./ko/collections.json":()=>E(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.c),[]),"./ko/files.json":()=>E(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.f),[]),"./ko/languages.json":()=>E(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.l),[]),"./ko/translation.json":()=>E(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.t),[]),"./zh-Hans/collections.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.c),[]),"./zh-Hans/files.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.f),[]),"./zh-Hans/languages.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.l),[]),"./zh-Hans/translation.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.t),[]),"./zh-Hant/collections.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.a),[]),"./zh-Hant/files.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.b),[]),"./zh-Hant/languages.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.d),[]),"./zh-Hant/translation.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.e),[])}),`./${t}/${n}.json`,3))).init({partialBundledLanguages:!0,fallbackLng:"en",ns:["translation","collections","languages","files","icons"],resources:{en:{translation:Fe,collections:Ie,languages:Te,files:Me,icons:Ne},"en-GB":{translation:Re}}}).catch(t=>{console.error(t)});function ne(t,n=4){let e=0;for(let o=0;o<t.length;o++)e+=t.charCodeAt(o)>255?1:.5;return e<=n?void 0:{fontSize:`${n*100/e}%`,scale:`1 ${e/n}`,whiteSpace:"nowrap"}}function lt(t,n){if(n.length===0)return new Set(t.collections);const e=new Set,o=new Set(n);for(const a of t.collections)t.getCollection(a).languages.some(c=>o.has(c))&&e.add(a);return e}function ut(t,n){if(n.length===0)return new Set(t.languages);const e=new Set;for(const o of n)for(const a of t.getCollection(o).languages)e.add(a);return e}function dt({corpus:t,collections:n,languages:e,setCollections:o}){const{t:a}=V(),c=["ja","ko","zh"].some(r=>G.language.startsWith(r)),l=lt(t,e);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"search-collections",children:t.collections.map(r=>[r,a(`collections:${r}.name`),a(`collections:${r}.short`)]).map(([r,v,g])=>s.jsxs("div",{className:`search-collection search-${l.has(r)?"valid":"invalid"}`,children:[s.jsx("input",{type:"checkbox",name:`collection-${r}`,id:`collection-${r}`,checked:n.includes(r),onChange:w=>{w.target.checked&&!n.includes(r)?o(n.concat([r])):!w.target.checked&&n.includes(r)&&o(n.filter(h=>h!==r))}}),s.jsx("label",{htmlFor:`collection-${r}`,style:c?ne(g):void 0,children:v===g?v:s.jsx("abbr",{title:v,children:s.jsx("span",{translate:"no",children:g})})})]},r))}),s.jsxs("div",{className:"item-group",children:[s.jsx("button",{disabled:n.length===t.collections.length,onClick:()=>{o(t.collections)},children:a("selectAll")}),s.jsx("button",{disabled:n.length===0,onClick:()=>{o([])},children:a("deselectAll")})]})]})}function ht({corpus:t,collections:n,languages:e,setLanguages:o}){const{t:a}=V(),c=["ja","ko","zh"].some(r=>G.language.startsWith(r)),l=ut(t,n);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"search-languages",children:t.languages.map(r=>[r,a(`languages:${r}.name`),a(`languages:${r}.code`)]).map(([r,v,g])=>s.jsxs("div",{className:`search-language search-${l.has(r)?"valid":"invalid"}`,children:[s.jsx("input",{type:"checkbox",name:`language-${r}`,id:`language-${r}`,checked:e.includes(r),onChange:w=>{w.target.checked&&!e.includes(r)?o(e.concat([r])):!w.target.checked&&e.includes(r)&&o(e.filter(h=>h!==r))}}),s.jsxs("label",{htmlFor:`language-${r}`,children:[s.jsx("span",{className:"search-language-code",children:s.jsx("abbr",{title:v,children:s.jsx("span",{translate:"no",children:g})})}),s.jsx("span",{className:"search-language-name",style:c?ne(v,12):ne(v,15),children:v})]})]},r))}),s.jsxs("div",{className:"item-group",children:[s.jsx("button",{disabled:e.length===t.languages.length,onClick:()=>{o(t.languages)},children:a("selectAll")}),s.jsx("button",{disabled:e.length===0,onClick:()=>{o([])},children:a("deselectAll")})]})]})}function gt({corpus:t,filtersVisible:n,collections:e,setCollections:o,languages:a,setLanguages:c}){const l=d.useRef(null),r=()=>l.current?.style.setProperty("--search-filters-height",`${l.current.scrollHeight}px`);return d.useEffect(()=>{if(!CSS.supports("interpolate-size","allow-keywords"))return r(),window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[]),s.jsx("div",{ref:l,className:`search-filters search-filters-${n?"show":"hide"}`,children:s.jsxs(s.Fragment,{children:[s.jsx(dt,{corpus:t,collections:e,languages:a,setCollections:o}),s.jsx("div",{className:"search-filters-divider"}),s.jsx(ht,{corpus:t,collections:e,languages:a,setLanguages:c})]})})}const ue=t=>Array.isArray(t)&&t.every(n=>typeof n=="string"),mt=t=>{const n=t.languages.filter(c=>c.startsWith(G.language.split("-")[0])),e={...et(t),languages:n.length===0?t.languages.filter(c=>c.startsWith("en")):n},o=H("corpus-params");if(o===null)return e;const a=je(o);return typeof a=="object"&&a!==null&&("query"in a&&typeof a.query=="string"&&(e.query=a.query),"type"in a&&re(a.type)&&(e.type=a.type),"caseInsensitive"in a&&typeof a.caseInsensitive=="boolean"&&(e.caseInsensitive=a.caseInsensitive),"common"in a&&typeof a.common=="boolean"&&(e.common=a.common),"script"in a&&typeof a.script=="boolean"&&(e.script=a.script),"showAllLanguages"in a&&typeof a.showAllLanguages=="boolean"&&(e.showAllLanguages=a.showAllLanguages),"collections"in a&&ue(a.collections)&&a.collections.every(c=>t.isCollectionKey(c))&&(e.collections=a.collections),"languages"in a&&ue(a.languages)&&a.languages.every(c=>t.isLanguageKey(c))&&(e.languages=a.languages)),e},ft=[J[3],J[0],J[1],J[2]];function pt({corpus:t,waiting:n,inProgress:e,postToWorker:o,terminateWorker:a}){const{t:c}=V(),l=d.useMemo(()=>mt(t),[t]),[r,v]=d.useState(l.query),[g,w]=d.useState(l.type),[h,C]=d.useState(l.caseInsensitive),[P,L]=d.useState(l.common),[A,q]=d.useState(l.script),[I,T]=d.useState(l.showAllLanguages),[F,B]=d.useState(l.collections),[f,p]=d.useState(l.languages),[b,j]=d.useState((H("corpus-filtersVisible")??(window.location.hash?"false":"true"))!=="false"),y=d.useMemo(()=>be(t),[t]),R=d.useCallback(()=>{const m=y.hashToSearchParams(window.location.hash.substring(1));if(m.query!==void 0&&v(m.query),m.type!==void 0&&w(m.type),m.caseInsensitive!==void 0&&C(m.caseInsensitive),m.common!==void 0&&L(m.common),m.script!==void 0&&q(m.script),m.showAllLanguages!==void 0&&T(m.showAllLanguages),m.collections!==void 0&&B(m.collections),m.languages!==void 0&&p(m.languages),m.id!==void 0&&m.id!==""){const D=m.id.split(".")[0];o({query:`^${ie(m.id)}$`,type:"regex",caseInsensitive:!1,common:!0,script:!0,showAllLanguages:!0,collections:t.collections.filter(z=>t.getCollection(z).id===D),languages:[Z]});return}if(m.file!==void 0&&m.file!==""){const D=m.file.split(".")[0];o({query:`^${ie(m.file)}\\..*$`,type:"regex",caseInsensitive:!1,common:!0,script:!0,showAllLanguages:!0,collections:t.collections.filter(z=>t.getCollection(z).id===D),languages:[Z]});return}if(m.run!==void 0&&m.run){const D={query:m.query??l.query,type:m.type??l.type,caseInsensitive:m.caseInsensitive??l.caseInsensitive,common:m.common??l.common,script:m.script??l.script,showAllLanguages:m.showAllLanguages??l.showAllLanguages,collections:m.collections??l.collections,languages:m.languages??l.languages};window.location.hash=y.searchParamsToHash(D),o(D);return}H("corpus-filtersVisible")===null&&j(!m.query||!m.collections||!m.languages)},[o,l]);d.useEffect(()=>(window.location.hash&&R(),window.addEventListener("hashchange",R),()=>{window.removeEventListener("hashchange",R)}),[R]),d.useEffect(()=>{K("corpus-params",JSON.stringify({query:r,type:g,caseInsensitive:h,common:P,script:A,showAllLanguages:I,collections:F,languages:f}))},[r,g,h,P,A,I,F,f]);const N=m=>{m.preventDefault(),H("corpus-filtersVisible")||K("corpus-filtersVisible",b.toString());const D=document.getElementsByClassName("view-search").item(0);D&&D.scrollHeight>document.body.clientHeight&&j(!1);const z={query:r,type:g,caseInsensitive:h,common:P,script:A,showAllLanguages:I,collections:F,languages:f};window.location.hash=y.searchParamsToHash(z),o(z)},U=()=>{a()},_=()=>{const m=!b;j(m),K("corpus-filtersVisible",m.toString())},S=m=>{const D=m.target.value;re(D)&&w(D)},M=n||e||r.length===0||F.length===0||f.length===0,$=d.useMemo(()=>s.jsx(gt,{corpus:t,filtersVisible:b,collections:F,setCollections:B,languages:f,setLanguages:p}),[b,F,f]);return s.jsxs("form",{className:"search-form",role:"search",onSubmit:N,children:[s.jsxs("div",{className:"search-bar",children:[s.jsxs("div",{className:"item-group",children:[s.jsx("label",{htmlFor:"query",children:c("query")}),s.jsx("input",{type:"search",name:"query",id:"query",value:r,onChange:m=>{v(m.target.value)}}),s.jsxs("div",{className:"btn-alternate-container",children:[s.jsx("input",{id:"submit",type:"submit",className:e?"invisible":"visible",value:c("search"),disabled:M}),s.jsx("button",{type:"button",className:e?"visible":"invisible",onClick:U,disabled:!e,children:c("cancel")})]}),s.jsx("button",{type:"button",className:b?"active":void 0,onClick:_,children:c("filters")}),s.jsx("select",{name:"type",id:"type",onChange:S,value:g,title:c("searchType.searchType"),"aria-label":c("searchType.searchType"),children:ft.map(m=>s.jsx("option",{value:m,children:c(`searchType.${m}`)},m))})]}),s.jsxs("div",{className:"item-group search-option-group",children:[s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"caseInsensitive",id:"caseInsensitive",checked:h,onChange:m=>{C(m.target.checked)}}),s.jsx("label",{htmlFor:"caseInsensitive",children:c("caseInsensitive")})]}),s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"common",id:"common",checked:P,onChange:m=>{L(m.target.checked)}}),s.jsx("label",{htmlFor:"common",children:c("common")})]}),s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"script",id:"script",checked:A,onChange:m=>{q(m.target.checked)}}),s.jsx("label",{htmlFor:"script",children:c("script")})]}),s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"showAllLanguages",id:"showAllLanguages",checked:I,onChange:m=>{T(m.target.checked)}}),s.jsx("label",{htmlFor:"showAllLanguages",children:c("showAllLanguages")})]})]})]}),$]})}function jt({src:t,active:n=!0}){const e=d.useRef(null);d.useEffect(()=>{e.current?.classList.add("spinner-stopped")},[]),d.useEffect(()=>{const a=e.current;if(a!==null){const c=()=>{n||a.classList.add("spinner-stopped")};return a.addEventListener("animationiteration",c),()=>{a.removeEventListener("animationiteration",c)}}},[n]);const o=["spinner",n?"spinner-active":"spinner-inactive"];return s.jsx("img",{ref:e,className:o.join(" "),src:t,alt:""})}function Se({progress:t}){const{t:n}=V(),e=Math.min(Math.max(0,t*100),100);return s.jsxs("div",{className:"progress-bar-container",role:"progressbar","aria-label":n("progressBar.title"),"aria-valuenow":e,children:[s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-bar-complete",style:{width:`${e}%`,maxWidth:e===0?0:void 0,visibility:e===0?"hidden":void 0}})}),s.jsx("div",{className:"progress-bar-text",children:n("progressBar.value",We(t))})]})}const vt=t=>{if("share"in navigator){const n=t.currentTarget.href;t.preventDefault(),navigator.share({url:n}).catch(e=>{e instanceof Error&&e.name!=="AbortError"||(console.error(e),window.open(n,"_blank"))})}};function xt({hash:t}){const{t:n}=V();return s.jsx("a",{href:t,rel:"bookmark noreferrer",target:"_blank",title:n("share"),onClick:vt,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#share"})})})}function wt({hash:t,callback:n}){const{t:e}=V();return s.jsx("a",{href:t,rel:"bookmark noreferrer",title:e("viewNearby"),onClick:n,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#file-lines"})})})}function bt({callback:t}){const{t:n}=V();return s.jsx("button",{className:"link",title:n("copy"),onClick:t,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#copy"})})})}function yt(t,n,e,o,a){return t.replaceAll(/<a class="speaker" data-var="(.+?)">(.+?)<\/a>/gu,(c,l,r)=>`<a class="speaker" href="#${n.searchParamsToHash({query:l,type:"exact",caseInsensitive:!1,common:!1,script:!0,showAllLanguages:!1,collections:[e],languages:[o],run:!0})}" title="${a}" translate="yes"><span translate="no">${r}</span></a>`)}const _t=(t,n)=>n===Z?t.replaceAll(/([._/]|([a-z])(?=[A-Z])|([A-Za-z])(?=[0-9]))/gu,"$1<wbr>"):t;function St(){const{t}=V();return s.jsx("div",{className:"results-rendering",children:t("status.rendering")})}function Ct({id:t}){return s.jsx("td",{className:"results-table-actions-cell",translate:"yes",children:s.jsxs("div",{className:"results-table-actions",children:[s.jsx(xt,{hash:`#id=${t}`}),s.jsx(wt,{hash:`#file=${t.split(".").slice(0,-1).join(".")}`})]})},"actions")}function Lt({corpus:t,index:n,collection:e,file:o,languages:a,lines:c,start:l,end:r,showId:v,richText:g,sectionOffset:w,onShowSection:h,searchParamsFactory:C}){const{t:P}=V(),L=a.indexOf(Z),A=a.map(j=>j===Z?st:j),q=P("viewSpeaker"),I=t.getCollection(e).speaker!==void 0,T=A.map(j=>G.dir(j)),F=T.every(j=>j===T[0]),B=d.useRef(null),f=()=>{const j=B.current,y=window.getSelection();y!==null&&j!==null&&(y.removeAllRanges(),y.selectAllChildren(j),document.execCommand("copy"),y.removeAllRanges())},p=["results-table",`collection-${t.getCollection(e).id??e.toLowerCase()}`,`file-${o}`,`rich-text-${g?"enabled":"disabled"}`];t.getCollection(e).softWrap===!0&&p.push("soft");const b=s.jsx("div",{className:"results-table-container",children:s.jsxs("table",{ref:B,className:p.join(" "),children:[s.jsx("thead",{children:s.jsxs("tr",{children:[L!==-1&&s.jsx("th",{className:"results-table-actions-cell",children:s.jsx(bt,{callback:f})}),a.filter(j=>v||j!==Z).map(j=>s.jsx("th",{children:s.jsx("abbr",{title:P(`languages:${j}.name`),children:s.jsx("span",{translate:"no",children:P(`languages:${j}.code`)})})},j))]})}),s.jsx("tbody",{dir:F&&T[0]!==G.dir()?T[0]:void 0,translate:"no",children:c.map((j,y)=>l<=y&&y<r&&s.jsxs("tr",{"data-id":L!==-1?j[L]:void 0,children:[L!==-1&&s.jsx(Ct,{id:j[L]}),j.map((R,N)=>{if(v||a[N]!==Z)return s.jsx("td",{lang:A[N],dir:F?void 0:T[N],dangerouslySetInnerHTML:{__html:_t(I?yt(R,C,e,a[N],q):R,a[N])}},N)})]},y))})]})});return s.jsxs(s.Fragment,{children:[l!==0&&s.jsx("button",{className:"results-notice",onClick:h(w,n),children:P("tablePartial",{count:l})}),l!==r&&b,r<c.length&&s.jsx("button",{className:"results-notice",onClick:h(w+r,n),children:P("tablePartial",{count:c.length-r})})]})}function Et(t){const{index:n,status:e,header:o,offset:a,limit:c,lines:l,sectionOffset:r,richText:v}=t,g=Math.max(0,Math.min(l.length,a-r)),w=Math.max(0,Math.min(l.length,a+c-r)),h=d.useMemo(()=>{switch(e){case"noLines":return;case"worker":return s.jsx(St,{});case"done":return s.jsx(Lt,{...t,start:g,end:w})}},[e,g,w,v]);return h&&s.jsxs("section",{id:`results-section${n}`,className:"results-section",children:[o&&s.jsx("h2",{children:o}),h]})}function kt({results:t,headers:n,jumpTo:e,...o}){const a=d.useMemo(()=>be(o.corpus),[o.corpus]),c=d.useMemo(()=>{let l=0;const r=[];for(const[v,g]of t.entries()){if(g.status==="initial")break;const w=g.status==="done"&&g.richText;r.push({...o,...g.params,index:v,sectionOffset:l,richText:w,status:g.status,header:n[v],searchParamsFactory:a}),l+=g.params.lines.length}return r},[t,o]);return d.useEffect(()=>{let l=0;for(const[r,v]of t.entries())if(v.status!=="initial"){if(o.offset>=l&&o.offset<l+v.params.lines.length){e(r);break}l+=v.params.lines.length}},[o.offset]),s.jsx("div",{className:"app-window-inner",children:c.map(l=>s.jsx(Et,{...l},l.index))})}function ee(t){const n=document.getElementById("results"),e=document.getElementById(`results-section${t}`),o=n?.firstElementChild;n&&e&&o instanceof HTMLElement&&(n.scrollTop=e.offsetTop-o.offsetTop)}function Pt({headers:t}){const{t:n}=V();return s.jsx("nav",{className:"results-jump",children:s.jsxs("select",{name:"jump",id:"jump",onChange:e=>{ee(Number(e.target.value))},value:"",children:[s.jsx("option",{value:"",disabled:!0,children:n("jumpTo")}),t.map((e,o)=>e!==void 0&&(o===0||t[o-1]!==e)&&s.jsx("option",{value:o,children:e},o))]})})}function At({count:t,offset:n,limit:e,setOffset:o}){const{t:a}=V();return s.jsxs("div",{className:"results-nav",children:[s.jsxs("div",{children:[s.jsx("span",{className:"results-nav-range-long",children:a("displayedRange.long",{count:t,start:n+1,end:Math.min(t,n+e)})}),s.jsx("span",{className:"results-nav-range-short",children:a("displayedRange.short",{count:t,start:n+1,end:Math.min(t,n+e)})})]}),s.jsx("button",{className:"button-square",disabled:n===0,onClick:()=>{o(Math.max(0,n-e))},title:a("loadPrev"),children:a("icons:loadPrev",{limit:e})}),s.jsx("button",{className:"button-square",disabled:n+e>=t,onClick:()=>{o(Math.min(Math.floor(t/e)*e,n+e))},title:a("loadNext"),children:a("icons:loadNext",{limit:e})})]})}const de={showVariables:0,showAllCharacters:!1,showGender:2,showPlural:0,showGrammar:!0,showFurigana:!0},Rt=()=>{const t=H("corpus-toggle");if(t===null)return de;const n={...de},e=je(t);return typeof e=="object"&&e!==null&&("showVariables"in e&&typeof e.showVariables=="number"&&[0,1,2].includes(e.showVariables)&&(n.showVariables=e.showVariables),"showAllCharacters"in e&&typeof e.showAllCharacters=="boolean"&&(n.showAllCharacters=e.showAllCharacters),"showGender"in e&&typeof e.showGender=="number"&&[0,1,2].includes(e.showGender)&&(n.showGender=e.showGender),"showPlural"in e&&typeof e.showPlural=="number"&&[0,1,2].includes(e.showPlural)&&(n.showPlural=e.showPlural),"showGrammar"in e&&typeof e.showGrammar=="boolean"&&(n.showGrammar=e.showGrammar),"showFurigana"in e&&typeof e.showFurigana=="boolean"&&(n.showFurigana=e.showFurigana)),n};function Nt({corpus:t,status:n,progress:e,results:o,showId:a=!0,richText:c=!0,limit:l=se}){const{t:r}=V(),v=d.useMemo(Rt,[]),[g,w]=d.useState(v.showVariables),[h,C]=d.useState(v.showAllCharacters),[P,L]=d.useState(v.showGender),[A,q]=d.useState(v.showPlural),[I,T]=d.useState(v.showGrammar),[F,B]=d.useState(v.showFurigana),[f,p]=d.useState(null),[b,j]=d.useState(0);d.useEffect(()=>{K("corpus-toggle",JSON.stringify({showVariables:g,showAllCharacters:h,showGender:P,showPlural:A,showGrammar:I,showFurigana:F}))},[g,h,P,A,I,F]);const y=d.useCallback((m,D)=>()=>{j(m),ee(D)},[]),R=d.useMemo(()=>{const m=[];let D="";for(const z of o){if(z.status==="initial"||z.status==="noLines"){m.push(void 0);continue}const{collection:X,file:i}=z.params,u=r("tableHeader",{collection:r(`collections:${X}.name`),file:r(`files:${i}`),interpolation:{escapeValue:!1}});m.push(u===D?void 0:u),D=u}return m},[o,G.language]),N=d.useMemo(()=>o.reduce((m,D)=>m+(D.status==="initial"?0:D.params.lines.length),0),[o]);N<b&&j(m=>Math.min(m,N));const U=s.jsxs("div",{className:"results-toggle",children:[s.jsx("button",{className:g!==2?"button-square active":"button-square",disabled:!c,onClick:()=>{w((g+1)%3)},title:r("showVariables"),children:s.jsx("span",{translate:"no",children:r("icons:showVariables",{context:g})})}),s.jsx("button",{className:h?"button-square active":"button-square",disabled:!c,onClick:()=>{C(!h)},title:r("showAllCharacters"),children:s.jsx("span",{translate:"no",children:r("icons:showAllCharacters")})}),s.jsx("button",{className:P!==2?"button-square active":"button-square",disabled:!c,onClick:()=>{L((P+1)%3)},title:r("showGender"),children:s.jsx("span",{translate:"no",children:r("icons:showGender",{context:P})})}),s.jsx("button",{className:A!==0?"button-square active":"button-square",disabled:!c,onClick:()=>{q((A+1)%3)},title:r("showPlural"),children:s.jsx("span",{translate:"no",children:r("icons:showPlural",{context:A})})}),s.jsx("button",{className:I?"button-square active":"button-square",disabled:!c,onClick:()=>{T(!I)},title:r("showGrammar"),children:s.jsx("span",{translate:"no",children:r("icons:showGrammar")})}),s.jsx("button",{className:F?"button-square active":"button-square",disabled:!c,onClick:()=>{B(!F)},title:r("showFurigana"),children:s.jsx("span",{className:"results-toggle-furigana",translate:"no",children:r("icons:showFurigana")})})]});d.useEffect(()=>{d.startTransition(()=>{p(s.jsx(kt,{corpus:t,results:o,headers:R,showId:a,offset:b,limit:l,onShowSection:y,jumpTo:ee}))})},[t,o,R,a,b,l,y,ee]);const _=xe(n),S=r(`status.${n.split(".",1)[0]}`),M=d.useMemo(()=>!_&&R.filter(m=>m!==void 0).length>1?s.jsx(Pt,{headers:R}):s.jsx("div",{className:"results-status-text",children:S}),[_,R]),$=`app-window variables-${["short","show","hide"][g]} control-${h?"show":"hide"} gender-${P} number-${A} grammar-${I?"show":"hide"} furigana-${F?"show":"hide"}`;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"results-status",children:[M,s.jsx(jt,{src:"logo.svg",active:_}),!_&&N>l?s.jsx(At,{count:N,offset:b,limit:l,setOffset:j}):s.jsx(Se,{progress:e}),U]}),s.jsx("main",{id:"results",className:$,children:f})]})}const Mt={status:"initial"},he="corpus-warn",Tt=2e7;function It({loader:t,showModal:n,richText:e,limit:o}){const{t:a}=V(),c=d.useRef(null),l=d.useRef(null),r=d.useRef([]),v=d.useRef(e),g=d.useRef(H(he)!=="false"),[w,h]=d.useState("initial"),[C,P]=d.useState(0),[L,A]=d.useState(!0),[q,I]=d.useState([]);d.useEffect(()=>{v.current=e;for(const{index:_,params:S}of r.current)B(_,S)},[e]);const T=(_,S)=>{I(M=>{const $=Array().concat(M);for(let m=$.length;m<_;m++)$[m]=Mt;return $[_]=S,$})},F=_=>{T(_.data.index,{status:"done",params:_.data,richText:_.data.richText}),_.data.error&&n({message:a("statusModal.error"),buttons:[{message:a("statusModal.buttons.ok"),autoFocus:!0}]})},B=(_,S)=>{l.current===null&&(console.log("Creating new TextWorker..."),l.current=new Ze,l.current.addEventListener("message",F)),l.current.postMessage({...S,index:_,richText:v.current,corpusLiterals:t.corpus.getCollection(S.collection).literals})},f=_=>{if(h(_.data.status),P(_.data.progress),A(_.data.showId),"index"in _.data&&"result"in _.data){const{index:S,result:M}=_.data;_.data.result.lines.length===0?T(S,{status:"noLines",params:M}):(r.current.push({index:S,params:M}),T(S,{status:"worker",params:M}),B(S,M))}_.data.complete&&Xe(_.data.status)&&n({message:a(`statusModal.${_.data.status}`),buttons:[{message:a("statusModal.buttons.ok"),autoFocus:!0}]})},p=d.useCallback(()=>{console.log("Terminating workers!"),c.current!==null&&(c.current.removeEventListener("message",f),c.current.terminate(),c.current=null),l.current!==null&&(l.current.removeEventListener("message",f),l.current.terminate(),l.current=null),h("initial"),P(0),I([]),r.current=[]},[]),b=_=>{I([]),r.current=[],_.query.length>0&&_.collections.length>0&&_.languages.length>0&&(c.current===null&&(console.log("Creating new SearchWorkerManager..."),c.current=new Je,c.current.addEventListener("message",f)),h("waiting"),P(0),c.current.postMessage({..._,serializedCorpus:_e(t.corpus)}))},j=d.useCallback(_=>{if(!g.current){b(_);return}t.getDownloadSizeTotal().then(S=>{if(S<=Tt){b(_);return}n({message:a("searchModal.message",Q(S)),checkbox:{message:a("searchModal.checkboxDoNotShowAgain"),checked:!1},buttons:[{message:a("searchModal.buttons.yes"),callback:()=>{b(_)},checkboxCallback:M=>{g.current=!M,K(he,(!M).toString())}},{message:a("searchModal.buttons.no"),callback:()=>{h("initial")},autoFocus:!0}],cancelCallback:()=>{h("initial")}})}).catch(S=>{console.error(S)})},[]),y=xe(w),R=w==="waiting",N=d.useMemo(()=>s.jsx(pt,{corpus:t.corpus,inProgress:y,waiting:R,postToWorker:j,terminateWorker:p}),[y,R,j,p]),U=d.useMemo(()=>s.jsx(Nt,{corpus:t.corpus,status:w,progress:C,showId:L,richText:e,results:q,limit:o}),[w,C,L,e,q,o]);return s.jsxs("div",{className:"search",children:[N,U]})}function Ft(t){return new Worker("/poke-corpus/assets/cacheManagerWorker-CyjKoZZK.js",{name:t?.name})}function Dt({callback:t}){const{t:n}=V();return s.jsx("button",{className:"link",title:n("delete"),onClick:t,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#trash-can"})})})}function Ot({callback:t}){const{t:n}=V();return s.jsx("button",{className:"link",title:n("refresh"),onClick:t,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#arrows-rotate"})})})}function Vt({cacheStorageEnabled:t,cachedMetadata:n}){const{t:e}=V(),o=d.useMemo(()=>Q(n.reduce((a,[,c])=>a+c,0)),[n]);return s.jsxs("ul",{children:[s.jsx("li",{children:e("cache.storageStatus",{val:e(t?"cache.storageEnabled":"cache.storageDisabled")})}),t&&s.jsx("li",{children:e("cache.filesStored",{count:n.length})}),t&&s.jsx("li",{children:e("cache.storageUsed",o)})]})}function $t({loadedBytes:t,totalBytes:n,progress:e}){const{t:o}=V();return s.jsxs("div",{className:"cache-entry-notice",children:[o("cache.loading",{message:o("cache.inProgress"),loaded:o("cache.size",Q(t)),total:o("cache.size",Q(n))}),s.jsx(Se,{progress:e})]})}function qt({corpus:t,cachedMetadata:n,cacheCollections:e,clearCachedFile:o}){const{t:a}=V(),c=d.useMemo(()=>t.collections.map(r=>{const v=n.filter(([[g]])=>r===g);return[r,v.reduce((g,[,w])=>g+w,0),v.every(([,,g])=>g)]}).filter(([,r])=>r>0),[n]);return s.jsx("div",{className:"cache-entry-list",children:n.length>0&&c.map(([l,r,v],g)=>s.jsxs("div",{className:`cache-entry cache-entry-${v?"current":"outdated"}`,children:[s.jsxs("div",{className:"cache-entry-text",children:[s.jsx("div",{children:s.jsx("abbr",{title:a(`collections:${l}.name`),children:s.jsx("span",{translate:"no",children:a(`collections:${l}.short`)})})}),s.jsx("div",{translate:"no",children:a("cache.size",Q(r))})]}),s.jsxs("div",{className:"cache-entry-actions",children:[!v&&s.jsx(Ot,{callback:()=>{e(l)}}),s.jsx(Dt,{callback:()=>{o(l)}})]})]},g))})}function Bt({active:t,loader:n,showModal:e}){const{t:o}=V(),[a,c]=d.useTransition(),[l,r]=d.useState(!1),[v,g]=d.useState([]),[w,h]=d.useState(!1),[C,P]=d.useState(0),[L,A]=d.useState(0),[q,I]=d.useState(0),T=d.useRef(null),F=async()=>{r("caches"in window&&await window.caches.keys().then(()=>!0).catch(()=>!1))},B=S=>{const{status:M,loadedBytes:$,totalBytes:m,requestedCollection:D}=S.data;switch(P($/m),A($),I(m),M){case"loading":return;case"done":console.log("Caching complete");break;case"error":console.log("Caching error");break}T.current?.terminate(),T.current=null,h(!1),b(D)},f=d.useCallback(S=>{"caches"in window&&(h(!0),P(0),A(0),T.current===null&&(console.log("Creating new CacheManagerWorker..."),T.current=new Ft,T.current.addEventListener("message",B),T.current.postMessage({serializedCorpus:_e(n.corpus),requestedCollection:S})))},[]),p=async(S="background")=>{if("caches"in window&&"indexedDB"in window&&"databases"in window.indexedDB){const[M,$]=await Promise.all([n.getCache(),n.getIndexedDB()]),m=n.corpus.entries.flatMap(([u,x])=>x.files.flatMap(k=>x.languages.map(O=>[u,O,k]))),D=m.map(([u,x,k])=>n.getFilePath(u,x,k)),z=await Promise.all(D.map(u=>n.getFileCacheOnly(M,$,u).then(async([x,k])=>[x!==void 0?(await x.blob()).size:-1,k])));g(z.map(([u,x],k)=>[m[k],u,x]).filter(([,u])=>u!==-1));const X=new Set(D),i=(await n.getAllLocalFilePaths()).filter(u=>!X.has(u));await Promise.all(i.flatMap(u=>n.deleteLocalMetadata($,u).then(()=>M.delete(u)).then(()=>{console.debug(`Deleted ${u} from cache`)}))),$.close(),S==="cacheAll"&&z.some(([u,x])=>u===-1||!x)&&U()}},b=S=>{p(S).catch(M=>{console.error(M)})},j=()=>{const S=[];T.current&&(T.current.terminate(),T.current=null),"serviceWorker"in navigator&&S.push(navigator.serviceWorker.ready.then(M=>M.unregister())),"indexedDB"in window&&"databases"in window.indexedDB&&S.push(n.clearLocalMetadata().then(()=>p())),"caches"in window&&S.push(n.getCache().then(M=>M.keys().then($=>Promise.all($.map(m=>M.delete(m)))))),Promise.all(S).then(()=>{console.log("Cache cleared")}).catch(M=>{console.log("Error clearing cache"),console.error(M)})},y=async S=>{if("caches"in window&&"indexedDB"in window&&"databases"in window.indexedDB){const[M,$]=await Promise.all([n.getCache(),n.getIndexedDB()]);await Promise.all(n.corpus.getCollection(S).languages.flatMap(m=>n.corpus.getCollection(S).files.flatMap(D=>{const z=n.getFilePath(S,m,D);return[n.deleteLocalMetadata($,z),M.delete(z)]}))),$.close(),await p()}},R=d.useCallback(S=>{y(S).catch(M=>{console.error(M)})},[]);d.useEffect(()=>{c(async()=>{await Promise.all([F(),p()])})},[]),d.useEffect(()=>{t&&c(async()=>{await Promise.all([F(),p()])})},[t]);const N=()=>{n.getDownloadSizeTotal().then(S=>{e({message:o("cache.cacheAllModal.message",Q(S)),buttons:[{message:o("cache.cacheAllModal.buttons.yes"),callback:()=>{f("cacheAll")}},{message:o("cache.cacheAllModal.buttons.no"),callback:()=>{h(!1)},autoFocus:!0}],cancelCallback:()=>{h(!1)}})}).catch(S=>{console.error(S)})},U=()=>{e({message:o("cache.cacheAllFailedModal.message"),buttons:[{message:o("cache.cacheAllFailedModal.buttons.ok"),autoFocus:!0}]})},_=()=>{e({message:o("cache.clearCacheModal.message"),buttons:[{message:o("cache.clearCacheModal.buttons.yes"),callback:j},{message:o("cache.clearCacheModal.buttons.no"),autoFocus:!0}]})};return t&&s.jsxs("div",{className:"cache",children:[s.jsxs("div",{className:"cache-button-group item-group",children:[s.jsx("button",{onClick:N,disabled:w!==!1,children:o("cacheAll")}),s.jsx("button",{onClick:_,children:o("clearCache")})]}),s.jsx("div",{className:"cache-results app-window",children:!a&&s.jsxs("div",{className:"app-window-inner",children:[s.jsx(Vt,{cacheStorageEnabled:l,cachedMetadata:v}),w?s.jsx($t,{loadedBytes:L,totalBytes:q,progress:C}):s.jsx(qt,{corpus:n.corpus,cachedMetadata:v,cacheCollections:f,clearCachedFile:R})]})})]})}function zt({classes:t,message:n,buttons:e,checkbox:o,cancelCallback:a}){const[c,l]=d.useState(n!==void 0),[r,v]=d.useState(o?.checked??!1),g=d.useRef(null),w=d.useRef(null);d.useEffect(()=>{const L=g.current,A=w.current;if(L!==null)if(c){if(L.showModal(),e){const q=e.findIndex(I=>I.autoFocus);A!==null&&q!==-1&&Array.from(A.children).filter(I=>I instanceof HTMLButtonElement)[q].focus()}}else L.close()},[c]);const h=(L,A)=>()=>{l(!1),L&&L(),A&&A(r)},C=()=>{a&&a(),l(!1)};if(!c)return null;const P=["modal"];return t&&t.forEach(L=>P.push(L)),s.jsxs("dialog",{ref:g,id:"modal",className:P.join(" "),onCancel:C,children:[s.jsx("div",{className:"modal-message",children:n}),o&&s.jsx("div",{className:"modal-checkbox",children:s.jsxs("div",{children:[s.jsx("input",{type:"checkbox",id:"modalCheckbox",name:"modalCheckbox",checked:r,onChange:L=>{v(L.target.checked)}}),s.jsx("label",{htmlFor:"modalCheckbox",children:o.message})]})}),s.jsx("div",{ref:w,className:"modal-button-group",children:e?.map(({message:L,callback:A,checkboxCallback:q,autoFocus:I},T)=>s.jsx("button",{type:"button",onClick:h(A,q),autoFocus:I,children:L},T))})]})}function ae(){const{t}=V();return s.jsx("div",{className:"app-window",children:s.jsx("div",{className:"app-window-inner",children:s.jsxs("section",{className:"results-section",children:[s.jsx("h2",{children:t("error.title")}),s.jsx("div",{children:t("error.message")})]})})})}const Ut=t=>{const n=f=>h(f).size,e=async(f,p)=>{const[b,j]=await A(f,p);return j?.hash===b.hash?0:b.size},o=async(f=t.collections)=>{try{const p=await w(),b=(await Promise.all(f.flatMap(j=>t.getCollection(j).languages.flatMap(y=>t.getCollection(j).files.map(R=>e(p,Y(j,y,R))))))).reduce((j,y)=>j+y,0);return p.close(),b}catch{return f.flatMap(p=>t.getCollection(p).languages.flatMap(b=>t.getCollection(p).files.map(j=>n(Y(p,b,j))))).reduce((p,b)=>p+b,0)}},a=f=>"/poke-corpus/"+f,c=async(f,p,b)=>{const j=a(b),[y,R]=await A(p,b);if(R?.hash===y.hash||!navigator.onLine&&R?.hash!==void 0){const _=await F(f,j);if(_!==void 0)return _}const N=await fetch(j);return N.ok?(await B(f,j,N).then(async _=>{_&&await P(p,b)}),N):await F(f,j)??null},l=async(f,p,b)=>{const j=a(b),[y,R]=await A(p,b);return R!==void 0?[await F(f,j),R.hash===y.hash]:[void 0,!1]},r=async f=>{const p=a(f),b=await fetch(p);return b.ok?b:null},v="corpus",g="files",w=()=>{const f=indexedDB.open(v);return new Promise((p,b)=>{f.onupgradeneeded=()=>{f.result.createObjectStore(g),f.transaction!==null&&(f.transaction.oncomplete=()=>{console.log("Created object store")})},f.onsuccess=()=>{p(f.result)},f.onerror=()=>{b(f.error)}})},h=f=>t.metadata[f],C=(f,p)=>{const y=f.transaction([g],"readonly").objectStore(g).get(p);return new Promise((R,N)=>{y.onsuccess=()=>{R(nt(y.result)?y.result:void 0)},y.onerror=()=>{N(y.error)}})},P=(f,p)=>{const y=f.transaction([g],"readwrite").objectStore(g).put(h(p),p);return new Promise((R,N)=>{y.onsuccess=()=>{R(y.result===p)},y.onerror=()=>{N(y.error)}})},L=(f,p)=>{const y=f.transaction([g],"readwrite").objectStore(g).delete(p);return new Promise((R,N)=>{y.onsuccess=()=>{R(!0)},y.onerror=()=>{N(y.error)}})},A=async(f,p)=>[h(p),await C(f,p)],q=()=>w().then(f=>{const j=f.transaction(["files"],"readwrite").objectStore("files").clear();return f.close(),new Promise((y,R)=>{j.onsuccess=()=>{y(!0)},j.onerror=()=>{R(j.error)}})}),I=()=>w().then(f=>{const j=f.transaction([g],"readonly").objectStore(g).getAllKeys();return f.close(),new Promise((y,R)=>{j.onsuccess=()=>{y(j.result.filter(N=>typeof N=="string"))},j.onerror=()=>{R(j.error)}})}),T=async()=>await caches.open(ye),F=async(f,p)=>{try{return await f.match(p)}catch(b){console.error(b);return}},B=async(f,p,b)=>{try{return await f.put(p,b.clone()),!0}catch(j){return console.error(j),!1}};return{corpus:t,getFilePath:Y,getFileSize:n,getDownloadSizeTotal:o,getFile:c,getFileCacheOnly:l,getFileRemote:r,getIndexedDB:w,deleteLocalMetadata:L,clearLocalMetadata:q,getAllLocalFilePaths:I,getCache:T}};async function Wt(){const t=await ct();return Ut(t)}const ge="Search";function Ht({showModal:t,richText:n,setRichText:e,limit:o,setLimit:a,reset:c}){const{t:l}=V();return s.jsxs("header",{className:"header",children:[s.jsx("h1",{children:s.jsxs("a",{href:"/poke-corpus/",onClick:c,children:[s.jsx("img",{className:"header-logo",src:"logo.svg",alt:"",height:"40",width:"40"})," ",l("title",{version:l("version")})]})}),s.jsx(oe,{fallback:null,children:s.jsx(Ke,{showModal:t,richText:n,setRichText:e,limit:o,setLimit:a})})]})}function Gt({view:t,switchView:n}){const{t:e}=V();return s.jsxs("footer",{children:[s.jsx("span",{children:e("tagline")}),s.jsx("span",{className:"separator",translate:"no",children:" | "}),s.jsx("span",{children:e("footerText")}),s.jsx("span",{className:"separator",translate:"no",children:" | "}),s.jsx("span",{children:s.jsx("button",{className:"link",onClick:n,children:e(t!=="Search"?"backToSearch":"manageCache")})}),s.jsx("span",{className:"separator",translate:"no",children:" | "}),s.jsx("span",{children:s.jsx("a",{href:"https://github.com/abcboy101/poke-corpus",children:e("github")})})]})}function Kt(){const[t,n]=d.useState(Ue),[e,o]=d.useState(ze),[a,c]=d.useState(ge),[l,r]=d.useState(0),[v,g]=d.useState(0),[w,h]=d.useState(null),[C,P]=d.useState(!1),[L,A]=d.useState(void 0);d.useEffect(()=>{const f=pe();document.body.classList.add(`mode-${f}`),P(!0),Wt().then(p=>{A(p)}).catch(p=>{console.error(p),A(null)})},[]);const q=d.useCallback(f=>{window.location.hash="",$e("corpus-params"),c(ge),r(p=>p+1&255),g(0),h(null),f.preventDefault()},[]),I=d.useCallback(f=>{h(f),g(p=>p+1&255)},[]),T=d.useCallback(()=>{c(f=>{const p=f!=="Search"?"Search":"CacheManager";return C||P(p==="CacheManager"),p})},[]);if(L===void 0)return;const F=L!==null&&C&&s.jsx(Bt,{active:a==="CacheManager",loader:L,showModal:I}),B=["app",`view-${a.toLowerCase()}`];return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&B.push("ua-safari"),s.jsxs("div",{className:B.join(" "),lang:G.language,dir:G.dir(),children:[s.jsx(Ht,{showModal:I,richText:t,setRichText:n,limit:e,setLimit:o,reset:q}),s.jsxs(oe,{FallbackComponent:ae,children:[L!==null?s.jsx(It,{loader:L,showModal:I,richText:t,limit:e}):s.jsx(ae,{}),F]}),s.jsx(Gt,{view:a,switchView:T}),s.jsx(zt,{...w},v)]},l)}function Jt(){return s.jsx("div",{className:"app",children:s.jsx(ae,{})})}const Zt=Ae.createRoot(document.getElementById("root"));Zt.render(s.jsx(Pe.StrictMode,{children:s.jsx(oe,{FallbackComponent:Jt,children:s.jsx(Kt,{})})}));Ve({onOfflineReady(){console.log("Ready to work offline!")}});
