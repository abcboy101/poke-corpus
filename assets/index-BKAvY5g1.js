import{u as q,r as d,j as s,i as K,B as Pe,a as Ae,b as Re,E as ce,R as Ne}from"./vendor-XPNbIhcT.js";import{R as Me}from"./react-dom-BYbQ8dEu.js";import{t as Te,i as Ie,f as Fe,l as De,c as Oe,a as Ve}from"./i18n-en-84MEhzKe.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=e(a);fetch(a.href,i)}})();const $e="modulepreload",Be=function(t){return"/poke-corpus/"+t},ue={},E=function(n,e,o){let a=Promise.resolve();if(e&&e.length>0){let l=function(g){return Promise.all(g.map(w=>Promise.resolve(w).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),p=r?.nonce||r?.getAttribute("nonce");a=l(e.map(g=>{if(g=Be(g),g in ue)return;ue[g]=!0;const w=g.endsWith(".css"),h=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${h}`))return;const L=document.createElement("link");if(L.rel=w?"stylesheet":$e,w||(L.as="script"),L.crossOrigin="",L.href=g,p&&L.setAttribute("nonce",p),document.head.appendChild(L),w)return new Promise((k,S)=>{L.addEventListener("load",k),L.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${g}`)))})}))}function i(l){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=l,window.dispatchEvent(r),!r.defaultPrevented)throw l}return a.then(l=>{for(const r of l||[])r.status==="rejected"&&i(r.reason);return n().catch(i)})};function qe(t={}){const{immediate:n=!1,onNeedRefresh:e,onOfflineReady:o,onRegistered:a,onRegisteredSW:i,onRegisterError:l}=t;let r,p;const g=async(h=!0)=>{await p};async function w(){if("serviceWorker"in navigator){if(r=await E(async()=>{const{Workbox:h}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:h}},[]).then(({Workbox:h})=>new h("/poke-corpus/sw.js",{scope:"/poke-corpus/",type:"classic"})).catch(h=>{l?.(h)}),!r)return;r.addEventListener("activated",h=>{(h.isUpdate||h.isExternal)&&window.location.reload()}),r.addEventListener("installed",h=>{h.isUpdate||o?.()}),r.register({immediate:n}).then(h=>{i?i("/poke-corpus/sw.js",h):a?.(h)}).catch(h=>{l?.(h)})}}return p=w(),g}const de=t=>t.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&");function G(t){try{return localStorage.getItem(t)}catch{return null}}function Z(t,n){try{localStorage.setItem(t,n)}catch{return}}function ze(t){try{localStorage.removeItem(t)}catch{return}}const je=["system","light","dark"],xe=t=>je.some(n=>t===n),Ue=t=>typeof t=="string"&&xe(t)?t:"system",ve=()=>Ue(G("mode")),ae=500,We=t=>!Number.isNaN(t)&&Number.isInteger(t)&&t>0,He=()=>{const t=+(G("corpus-limit")??ae);return Number.isNaN(t)?ae:t},Ge=()=>G("corpus-richText")!=="false",he=["byte","kilobyte","megabyte","gigabyte","terabyte","petabyte"];function Y(t){const n=Math.min(Math.floor((t.toString().length-1)/3),he.length-1),e={style:"unit",unit:he[n],unitDisplay:n===0?"long":"short",minimumFractionDigits:n===0?0:1,maximumFractionDigits:1,maximumSignificantDigits:3,roundingPriority:"lessPrecision"};return{amount:t/Math.pow(1e3,n),formatParams:{amount:e}}}function Ke(t,n=1){return{amount:t,formatParams:{amount:{style:"percent",minimumFractionDigits:n,maximumFractionDigits:n}}}}function we(t){try{return JSON.parse(t)}catch(n){return console.error(n),null}}function J(t){console.error(t)}const Je=[{code:"en",name:"English (United States)"},{code:"en-GB",name:"English (United Kingdom)"},{code:"ja",name:"日本語"},{code:"de",name:"Deutsch"},{code:"fr",name:"Français (France)"},{code:"fr-CA",name:"Français (Canada)"},{code:"es",name:"Español (España)"},{code:"it",name:"Italiano"},{code:"ko",name:"한국어"},{code:"zh-Hans",name:"简体中文"},{code:"zh-Hant",name:"繁体中文"}];function Ze({showModal:t,richText:n,richTextRef:e,limit:o,limitRef:a}){const{t:i}=q(),[l,r]=d.useState(ve),p=h=>{K.changeLanguage(h.target.value,L=>{L?.some(k=>!k.message.includes("Unknown variable dynamic import"))&&(console.error(L),t({message:i("options.network"),buttons:[{message:s.jsx(be,{}),autoFocus:!0}]}))}).catch(J)},g=h=>{const L=h.target.value;xe(L)&&(r(L),Z("mode",L),document.body.classList.replace(`mode-${l}`,`mode-${L}`))},w=h=>{const L=h.target.value;(L==="true"||L==="false")&&Z("corpus-longURL",L)};return s.jsx("div",{className:"options",children:s.jsxs("div",{className:"options-grid",children:[s.jsx("label",{htmlFor:"language",children:i("options.language")}),s.jsx("select",{name:"language",id:"language",onChange:p,defaultValue:K.language,autoFocus:!0,translate:"no",children:Je.map(h=>s.jsx("option",{value:h.code,lang:h.code,children:h.name},h.code))}),s.jsx("label",{htmlFor:"mode",children:i("options.mode")}),s.jsx("select",{name:"mode",id:"mode",onChange:g,defaultValue:l,children:je.map(h=>s.jsx("option",{value:h,children:i(`options.modes.${h}`)},h))}),s.jsx("label",{htmlFor:"longURL",children:i("options.longURL")}),s.jsx("select",{name:"longURL",id:"longURL",onChange:w,defaultValue:G("corpus-longURL")??"false",children:["true","false"].map(h=>s.jsx("option",{value:h,children:i(`options.longURLSelect.${h}`)},h))}),s.jsx("label",{htmlFor:"richText",children:i("options.richText")}),s.jsx("select",{ref:e,name:"richText",id:"richText",defaultValue:n?"true":"false",children:["true","false"].map(h=>s.jsx("option",{value:h,children:i(`options.richTextSelect.${h}`)},h))}),s.jsx("label",{htmlFor:"limit",children:i("options.limit")}),s.jsx("input",{ref:a,type:"number",name:"limit",id:"limit",min:1,defaultValue:o})]})})}function be(){const{t}=q();return t("options.close")}function Qe(t){const{t:n}=q(),{showModal:e,setRichText:o,setLimit:a}=t,i=d.useRef(null),l=d.useRef(null),r=()=>{if(i.current!==null){const g=i.current.value;(g==="true"||g==="false")&&(Z("corpus-richText",g),o(g!=="false"))}if(l.current!==null){const g=l.current.valueAsNumber;We(g)&&(Z("corpus-limit",g.toString()),a(g))}},p={classes:["modal-options"],message:s.jsx(Ze,{...t,richTextRef:i,limitRef:l}),buttons:[{message:s.jsx(be,{}),callback:r}],cancelCallback:r};return s.jsxs("button",{className:"header-options",onClick:()=>{e(p)},children:[s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#gear"})}),n("options.options")]})}function Xe(t){return new Worker("/poke-corpus/assets/searchWorkerManager-CzrL3kum.js",{name:t?.name})}function Ye(t){return new Worker("/poke-corpus/assets/textWorker-Xwew4GOV.js",{name:t?.name})}const et=["error","regex","noMatch","network","boolean.parentheses","boolean.regex","boolean.slash","boolean.quote","boolean.operand","boolean.empty","boolean.where"],tt=t=>et.some(n=>t===n),st=["waiting","loading","processing","collecting"],ye=t=>st.some(n=>t===n),Q=["exact","regex","boolean","all"],ie=t=>Q.some(n=>t===n),_e={id:"",file:"",query:"",type:"all",caseInsensitive:!0,common:!0,script:!0,showAllLanguages:!0,run:!1},nt=t=>({..._e,collections:t.collections.filter(n=>t.getCollection(n).structured),languages:t.languages}),at=t=>{function n(c){const u={};return c.id!==void 0&&(u.id=c.id),c.file!==void 0&&(u.file=c.file),c.run!==void 0&&(u.run=c.run.toString()),new URLSearchParams({query:c.query,type:c.type,caseInsensitive:c.caseInsensitive.toString(),common:c.common.toString(),script:c.script.toString(),showAllLanguages:c.showAllLanguages.toString(),collections:c.collections.join(","),languages:c.languages.join(","),...u}).toString()}function e(c){const u=new URLSearchParams(c);return{id:o(u.get("id")),file:o(u.get("file")),query:o(u.get("query")),type:i(u.get("type")??(u.get("regex")==="true"?"regex":null),ie),caseInsensitive:a(u.get("caseInsensitive")),common:a(u.get("common")),script:a(u.get("script")),showAllLanguages:a(u.get("showAllLanguages")),collections:l(u.get("collections"),t.isCollectionKey),languages:l(u.get("languages"),t.isLanguageKey,r),run:a(u.get("run"))}}function o(c){return c??void 0}function a(c){switch(c){case"true":return!0;case"false":return!1}}function i(c,u){if(c!==null&&u(c))return c}function l(c,u,y=T=>T){if(c!==null)return c.split(",").map(y).filter(u)}function r(c){switch(c){case"qid-ZZ":case"ja-JP":case"en-US":case"fr-FR":case"it-IT":case"de-DE":case"es-ES":case"ko-KR":return c.split("-",1)[0];case"ja-Hrkt-JP":return"ja-Hrkt";case"zh-CN":return"zh-Hans";case"zh-TW":return"zh-Hant";default:return c}}const p=t.collections.length^t.languages.length<<4,g=2,w=Math.ceil(t.languages.length/8),h=Math.ceil(t.collections.length/8),L=w+h,k=64,S=Math.ceil(Math.log2(t.languages.length+t.collections.length)),A=g+L,I=c=>btoa(String.fromCodePoint(...c)).replaceAll("/","_").replaceAll("+","-").replace(/=+$/,""),M=c=>Uint8Array.from(atob(c.replaceAll("_","/").replaceAll("-","+")),u=>u.charCodeAt(0));function D(c){const u={};c.id!==void 0&&(u.id=c.id),c.file!==void 0&&(u.file=c.file);const y=f(c);return x(y),new URLSearchParams({...u,q:c.query,s:I(y)}).toString()}function F(c){const u=new URLSearchParams(c),y={id:o(u.get("id")),file:o(u.get("file")),query:o(u.get("q"))},T=o(u.get("s"));if(!T)return y;try{const B=M(T).subarray(0,A);return N(B),{...y,...v(B)}}catch{return y}}function f(c){const u=new Uint8Array(A);u[1]=+(c.run??_e.run)<<0|+c.caseInsensitive<<1|+c.common<<2|+c.script<<3|Q.indexOf(c.type)<<4|+!c.showAllLanguages<<7;const y=u.subarray(g);_(c,y),j(y,u.subarray(1,2));let T=u.length;for(;u[T-1]===0&&T>1;)T--;return u.subarray(0,T)}function v(c){const u=new Uint8Array(L);c[1]&k?b(c.subarray(g),u):u.set(c.subarray(g));const y=t.languages.filter((B,W)=>P(u,W)===1),T=t.collections.filter((B,W)=>P(u,8*w+W)===1);return{run:(c[1]&1)!==0,caseInsensitive:(c[1]&2)!==0,common:(c[1]&4)!==0,script:(c[1]&8)!==0,type:Q[(c[1]&48)>>4],showAllLanguages:(c[1]&128)===0,languages:y,collections:T}}function _(c,u){t.languages.forEach((y,T)=>{c.languages.includes(y)&&$(u,T)}),t.collections.forEach((y,T)=>{c.collections.includes(y)&&$(u,8*w+T)})}function b(c,u){const y=R(c);t.languages.forEach((T,B)=>{y.next().value&&$(u,B)}),t.collections.forEach((T,B)=>{y.next().value&&$(u,8*w+B)})}function j(c,u){const y=P(c,0)===1,T=C(c,y);let B=c.length;for(;c[B-1]===0;)B--;if(1+T.length*S<8*B){u[0]|=k,c.fill(0),y||$(c,0);let W=1;T.forEach(([ke])=>{for(let ne=0;ne<S;W++,ne++)$(c,W,ke>>ne&1)})}}function C(c,u){const y=[[0,u]];return t.languages.forEach((T,B)=>{const W=P(c,B)===1;y[y.length-1][1]===W?y[y.length-1][0]++:y.push([1,W])}),t.collections.forEach((T,B)=>{const W=P(c,8*w+B)===1;y[y.length-1][1]===W?y[y.length-1][0]++:y.push([1,W])}),y.pop(),y}function*R(c){const u=new Uint8Array(L);u.set(c);let y=P(u,0)!==1;for(let T=1;T+S<=u.length*8;){let B=0;for(let W=0;W<S;T++,W++)B|=P(u,T)<<W;if(B===0)break;for(;B>0;)yield y,B--;y=!y}for(;;)yield y}function $(c,u,y=1){c[u>>3]|=y<<(u&7)}function P(c,u){return c[u>>3]>>(u&7)&1}function x(c){const u=c[0]=O(c);U(u,c)}function N(c){const u=c[0];if(U(u,c),u!==O(c))throw Error("invalid checksum")}function O(c,u=1){return c.subarray(u).reduce((y,T)=>y+T&255,0)^p&255}function U(c,u,y=1){let T=m(c);for(let B=y;B<u.length;B++)u[B]^=T>>24,T=V(T)}const m=c=>2480367069*c&4294967295,V=c=>2438952949*c+2654435769&4294967295;function H(c){return(G("corpus-longURL")==="true"?n:D)(c)}function z(c){const u=new URLSearchParams(c);return(u.get("q")||u.get("s")?F:e)(c)}return{_bytesBase64:A,_searchParamsToQueryString:n,_queryStringToSearchParams:e,_searchParamsToBase64:D,_base64ToSearchParams:F,_serializeByteArray:f,_deserializeByteArray:v,_encryptBytes:x,_decryptBytes:N,searchParamsToHash:H,hashToSearchParams:z}};function Se(t){return at(t)}const X="qid",ot="zxx",rt=t=>t!==null&&typeof t=="object"&&"hash"in t&&typeof t.hash=="string"&&"size"in t&&typeof t.size=="number",ct=t=>{const n=Object.entries(t.corpus.collections);return Object.fromEntries(n.flatMap(([e,o])=>o.languages.flatMap(a=>o.files.map(i=>ee(e,a,i)))).map((e,o)=>[e,{hash:t.hashes[o],size:t.sizes[o]}]))},it=t=>{const n=t.corpus,e=Object.keys(n.collections),o=Object.entries(n.collections),a=ct(t);return{_corpus:n,collections:e,languages:n.languages,entries:o,metadata:a,getCollection:i=>n.collections[i],isCollectionKey:i=>e.some(l=>i===l),isLanguageKey:i=>n.languages.some(l=>i===l)}},ee=(t,n,e)=>`corpus/${t}/${n}_${e}.txt.gz`;function Ce(t){return{corpus:t._corpus,metadata:t.metadata}}const lt=(t,n,e)=>{const o=t[n];return o?typeof o=="function"?o():Promise.resolve(o):new Promise((a,i)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(i.bind(null,new Error("Unknown variable dynamic import: "+n+(n.split("/").length!==e?". Note that variables only represent file names one level deep.":""))))})};K.use(Pe).use(Ae).use(Re((t,n)=>lt(Object.assign({"./de/collections.json":()=>E(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.c),[]),"./de/files.json":()=>E(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.f),[]),"./de/languages.json":()=>E(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.l),[]),"./de/translation.json":()=>E(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.t),[]),"./en-GB/translation.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.j),[]),"./en/collections.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.d),[]),"./en/files.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.g),[]),"./en/icons.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.h),[]),"./en/languages.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.e),[]),"./en/translation.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.b),[]),"./es/collections.json":()=>E(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.c),[]),"./es/files.json":()=>E(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.f),[]),"./es/languages.json":()=>E(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.l),[]),"./es/translation.json":()=>E(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.t),[]),"./fr-CA/translation.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.t),[]),"./fr/collections.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.c),[]),"./fr/files.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.f),[]),"./fr/languages.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.l),[]),"./fr/translation.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.a),[]),"./it/collections.json":()=>E(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.c),[]),"./it/files.json":()=>E(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.f),[]),"./it/languages.json":()=>E(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.l),[]),"./it/translation.json":()=>E(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.t),[]),"./ja/collections.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.c),[]),"./ja/files.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.f),[]),"./ja/icons.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.i),[]),"./ja/languages.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.l),[]),"./ja/translation.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.t),[]),"./ko/collections.json":()=>E(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.c),[]),"./ko/files.json":()=>E(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.f),[]),"./ko/languages.json":()=>E(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.l),[]),"./ko/translation.json":()=>E(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.t),[]),"./zh-Hans/collections.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.c),[]),"./zh-Hans/files.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.f),[]),"./zh-Hans/languages.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.l),[]),"./zh-Hans/translation.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.t),[]),"./zh-Hant/collections.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.a),[]),"./zh-Hant/files.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.b),[]),"./zh-Hant/languages.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.d),[]),"./zh-Hant/translation.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.e),[])}),`./${t}/${n}.json`,3))).init({partialBundledLanguages:!0,fallbackLng:"en",ns:["translation","collections","languages","files","icons"],resources:{en:{translation:Ve,collections:Oe,languages:De,files:Fe,icons:Ie},"en-GB":{translation:Te}}}).catch(J);function oe(t,n=4){let e=0;for(let o=0;o<t.length;o++)e+=t.charCodeAt(o)>255?1:.5;return e<=n?void 0:{fontSize:`${n*100/e}%`,scale:`1 ${e/n}`,whiteSpace:"nowrap"}}function ut(t,n){if(n.length===0)return new Set(t.collections);const e=new Set,o=new Set(n);for(const[a,i]of t.entries)i.languages.some(l=>o.has(l))&&e.add(a);return e}function dt(t,n){if(n.length===0)return new Set(t.languages);const e=new Set;for(const o of n)for(const a of t.getCollection(o).languages)e.add(a);return e}function ht({corpus:t,collections:n,languages:e,setCollections:o}){const{t:a}=q(),i=["ja","ko","zh"].some(r=>K.language.startsWith(r)),l=ut(t,e);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"search-collections",children:t.collections.map(r=>[r,a(`collections:${r}.name`),a(`collections:${r}.short`)]).map(([r,p,g])=>s.jsxs("div",{className:`search-collection search-${l.has(r)?"valid":"invalid"}`,children:[s.jsx("input",{type:"checkbox",name:`collection-${r}`,id:`collection-${r}`,checked:n.includes(r),onChange:w=>{w.target.checked&&!n.includes(r)?o(n.concat([r])):!w.target.checked&&n.includes(r)&&o(n.filter(h=>h!==r))}}),s.jsx("label",{htmlFor:`collection-${r}`,style:i?oe(g):void 0,children:p===g?p:s.jsx("abbr",{title:p,children:s.jsx("span",{translate:"no",children:g})})})]},r))}),s.jsxs("div",{className:"item-group",children:[s.jsx("button",{disabled:n.length===t.collections.length,onClick:()=>{o(t.collections)},children:a("selectAll")}),s.jsx("button",{disabled:n.length===0,onClick:()=>{o([])},children:a("deselectAll")})]})]})}function gt({corpus:t,collections:n,languages:e,setLanguages:o}){const{t:a}=q(),i=["ja","ko","zh"].some(r=>K.language.startsWith(r)),l=dt(t,n);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"search-languages",children:t.languages.map(r=>[r,a(`languages:${r}.name`),a(`languages:${r}.code`)]).map(([r,p,g])=>s.jsxs("div",{className:`search-language search-${l.has(r)?"valid":"invalid"}`,children:[s.jsx("input",{type:"checkbox",name:`language-${r}`,id:`language-${r}`,checked:e.includes(r),onChange:w=>{w.target.checked&&!e.includes(r)?o(e.concat([r])):!w.target.checked&&e.includes(r)&&o(e.filter(h=>h!==r))}}),s.jsxs("label",{htmlFor:`language-${r}`,children:[s.jsx("span",{className:"search-language-code",children:s.jsx("abbr",{title:p,children:s.jsx("span",{translate:"no",children:g})})}),s.jsx("span",{className:"search-language-name",style:i?oe(p,12):oe(p,15),children:p})]})]},r))}),s.jsxs("div",{className:"item-group",children:[s.jsx("button",{disabled:e.length===t.languages.length,onClick:()=>{o(t.languages)},children:a("selectAll")}),s.jsx("button",{disabled:e.length===0,onClick:()=>{o([])},children:a("deselectAll")})]})]})}function mt({corpus:t,filtersVisible:n,collections:e,setCollections:o,languages:a,setLanguages:i}){const l=d.useRef(null),r=()=>l.current?.style.setProperty("--search-filters-height",`${l.current.scrollHeight}px`);return d.useEffect(()=>{if(!CSS.supports("interpolate-size","allow-keywords"))return r(),window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[]),s.jsx("div",{ref:l,className:`search-filters search-filters-${n?"show":"hide"}`,children:s.jsxs(s.Fragment,{children:[s.jsx(ht,{corpus:t,collections:e,languages:a,setCollections:o}),s.jsx("div",{className:"search-filters-divider"}),s.jsx(gt,{corpus:t,collections:e,languages:a,setLanguages:i})]})})}const ge=t=>Array.isArray(t)&&t.every(n=>typeof n=="string"),ft=t=>{const n=t.languages.filter(i=>i.startsWith(K.language.split("-")[0])),e={...nt(t),languages:n.length===0?t.languages.filter(i=>i.startsWith("en")):n},o=G("corpus-params");if(o===null)return e;const a=we(o);return typeof a=="object"&&a!==null&&("query"in a&&typeof a.query=="string"&&(e.query=a.query),"type"in a&&ie(a.type)&&(e.type=a.type),"caseInsensitive"in a&&typeof a.caseInsensitive=="boolean"&&(e.caseInsensitive=a.caseInsensitive),"common"in a&&typeof a.common=="boolean"&&(e.common=a.common),"script"in a&&typeof a.script=="boolean"&&(e.script=a.script),"showAllLanguages"in a&&typeof a.showAllLanguages=="boolean"&&(e.showAllLanguages=a.showAllLanguages),"collections"in a&&ge(a.collections)&&a.collections.every(i=>t.isCollectionKey(i))&&(e.collections=a.collections),"languages"in a&&ge(a.languages)&&a.languages.every(i=>t.isLanguageKey(i))&&(e.languages=a.languages)),e},pt=[Q[3],Q[0],Q[1],Q[2]];function jt({corpus:t,waiting:n,inProgress:e,postToWorker:o,terminateWorker:a}){const{t:i}=q(),l=d.useMemo(()=>ft(t),[t]),[r,p]=d.useState(l.query),[g,w]=d.useState(l.type),[h,L]=d.useState(l.caseInsensitive),[k,S]=d.useState(l.common),[A,I]=d.useState(l.script),[M,D]=d.useState(l.showAllLanguages),[F,f]=d.useState(l.collections),[v,_]=d.useState(l.languages),[b,j]=d.useState((G("corpus-filtersVisible")??(window.location.hash?"false":"true"))!=="false"),C=d.useMemo(()=>Se(t),[t]),R=d.useCallback(()=>{const m=C.hashToSearchParams(window.location.hash.substring(1));if(m.query!==void 0&&p(m.query),m.type!==void 0&&w(m.type),m.caseInsensitive!==void 0&&L(m.caseInsensitive),m.common!==void 0&&S(m.common),m.script!==void 0&&I(m.script),m.showAllLanguages!==void 0&&D(m.showAllLanguages),m.collections!==void 0&&f(m.collections),m.languages!==void 0&&_(m.languages),m.id!==void 0&&m.id!==""){const V=m.id.split(".")[0];o({query:`^${de(m.id)}$`,type:"regex",caseInsensitive:!1,common:!0,script:!0,showAllLanguages:!0,collections:t.collections.filter(H=>t.getCollection(H).id===V),languages:[X]});return}if(m.file!==void 0&&m.file!==""){const V=m.file.split(".")[0];o({query:`^${de(m.file)}\\..*$`,type:"regex",caseInsensitive:!1,common:!0,script:!0,showAllLanguages:!0,collections:t.collections.filter(H=>t.getCollection(H).id===V),languages:[X]});return}if(m.run!==void 0&&m.run){const V={query:m.query??l.query,type:m.type??l.type,caseInsensitive:m.caseInsensitive??l.caseInsensitive,common:m.common??l.common,script:m.script??l.script,showAllLanguages:m.showAllLanguages??l.showAllLanguages,collections:m.collections??l.collections,languages:m.languages??l.languages};window.location.hash=C.searchParamsToHash(V),o(V);return}G("corpus-filtersVisible")===null&&j(!m.query||!m.collections||!m.languages)},[o,l]);d.useEffect(()=>(window.location.hash&&R(),window.addEventListener("hashchange",R),()=>{window.removeEventListener("hashchange",R)}),[R]),d.useEffect(()=>{Z("corpus-params",JSON.stringify({query:r,type:g,caseInsensitive:h,common:k,script:A,showAllLanguages:M,collections:F,languages:v}))},[r,g,h,k,A,M,F,v]);const $=m=>{m.preventDefault(),G("corpus-filtersVisible")||Z("corpus-filtersVisible",b.toString());const V=document.getElementsByClassName("view-search").item(0);V&&V.scrollHeight>document.body.clientHeight&&j(!1);const H={query:r,type:g,caseInsensitive:h,common:k,script:A,showAllLanguages:M,collections:F,languages:v};window.location.hash=C.searchParamsToHash(H),o(H)},P=()=>{a()},x=()=>{const m=!b;j(m),Z("corpus-filtersVisible",m.toString())},N=m=>{const V=m.target.value;ie(V)&&w(V)},O=n||e||r.length===0||F.length===0||v.length===0,U=d.useMemo(()=>s.jsx(mt,{corpus:t,filtersVisible:b,collections:F,setCollections:f,languages:v,setLanguages:_}),[b,F,v]);return s.jsxs("form",{className:"search-form",role:"search",onSubmit:$,children:[s.jsxs("div",{className:"search-bar",children:[s.jsxs("div",{className:"item-group",children:[s.jsx("label",{htmlFor:"query",children:i("query")}),s.jsx("input",{type:"search",name:"query",id:"query",value:r,onChange:m=>{p(m.target.value)}}),s.jsxs("div",{className:"btn-alternate-container",children:[s.jsx("input",{id:"submit",type:"submit",className:e?"invisible":"visible",value:i("search"),disabled:O}),s.jsx("button",{type:"button",className:e?"visible":"invisible",onClick:P,disabled:!e,children:i("cancel")})]}),s.jsx("button",{type:"button",className:b?"active":void 0,onClick:x,children:i("filters")}),s.jsx("select",{name:"type",id:"type",onChange:N,value:g,title:i("searchType.searchType"),"aria-label":i("searchType.searchType"),children:pt.map(m=>s.jsx("option",{value:m,children:i(`searchType.${m}`)},m))})]}),s.jsxs("div",{className:"item-group search-option-group",children:[s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"caseInsensitive",id:"caseInsensitive",checked:h,onChange:m=>{L(m.target.checked)}}),s.jsx("label",{htmlFor:"caseInsensitive",children:i("caseInsensitive")})]}),s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"common",id:"common",checked:k,onChange:m=>{S(m.target.checked)}}),s.jsx("label",{htmlFor:"common",children:i("common")})]}),s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"script",id:"script",checked:A,onChange:m=>{I(m.target.checked)}}),s.jsx("label",{htmlFor:"script",children:i("script")})]}),s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"showAllLanguages",id:"showAllLanguages",checked:M,onChange:m=>{D(m.target.checked)}}),s.jsx("label",{htmlFor:"showAllLanguages",children:i("showAllLanguages")})]})]})]}),U]})}function xt({src:t,active:n=!0}){const e=d.useRef(null);d.useEffect(()=>{e.current?.classList.add("spinner-stopped")},[]),d.useEffect(()=>{const a=e.current;if(a!==null){const i=()=>{n||a.classList.add("spinner-stopped")};return a.addEventListener("animationiteration",i),()=>{a.removeEventListener("animationiteration",i)}}},[n]);const o=["spinner",n?"spinner-active":"spinner-inactive"];return s.jsx("img",{ref:e,className:o.join(" "),src:t,alt:""})}function Le({progress:t}){const{t:n}=q(),e=Math.min(Math.max(0,t*100),100);return s.jsxs("div",{className:"progress-bar-container",role:"progressbar","aria-label":n("progressBar.title"),"aria-valuenow":e,children:[s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-bar-complete",style:{width:`${e}%`,maxWidth:e===0?0:void 0,visibility:e===0?"hidden":void 0}})}),s.jsx("div",{className:"progress-bar-text",children:n("progressBar.value",Ke(t))})]})}const vt=t=>{if("share"in navigator){const n=t.currentTarget.href;t.preventDefault(),navigator.share({url:n}).catch(e=>{e instanceof Error&&e.name!=="AbortError"||(console.error(e),window.open(n,"_blank"))})}};function wt({hash:t}){const{t:n}=q();return s.jsx("a",{href:t,rel:"bookmark noreferrer",target:"_blank",title:n("share"),onClick:vt,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#share"})})})}function bt({hash:t,callback:n}){const{t:e}=q();return s.jsx("a",{href:t,rel:"bookmark noreferrer",title:e("viewNearby"),onClick:n,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#file-lines"})})})}function yt({callback:t}){const{t:n}=q();return s.jsx("button",{className:"link",title:n("copy"),onClick:t,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#copy"})})})}function _t(t,n,e,o,a){return t.replaceAll(/<a class="speaker" data-var="(.+?)">(.+?)<\/a>/gu,(i,l,r)=>`<a class="speaker" href="#${n.searchParamsToHash({query:l,type:"exact",caseInsensitive:!1,common:!1,script:!0,showAllLanguages:!1,collections:[e],languages:[o],run:!0})}" title="${a}" translate="yes"><span translate="no">${r}</span></a>`)}const St=(t,n)=>n===X?t.replaceAll(/([._/]|([a-z])(?=[A-Z])|([A-Za-z])(?=[0-9]))/gu,"$1<wbr>"):t;function Ct(){const{t}=q();return s.jsx("div",{className:"results-rendering",children:t("status.rendering")})}function Lt({id:t}){return s.jsx("td",{className:"results-table-actions-cell",translate:"yes",children:s.jsxs("div",{className:"results-table-actions",children:[s.jsx(wt,{hash:`#id=${t}`}),s.jsx(bt,{hash:`#file=${t.split(".").slice(0,-1).join(".")}`})]})},"actions")}function Et({corpus:t,index:n,collection:e,file:o,languages:a,lines:i,start:l,end:r,showId:p,richText:g,sectionOffset:w,onShowSection:h,searchParamsFactory:L}){const{t:k}=q(),S=a.indexOf(X),A=a.map(j=>j===X?ot:j),I=k("viewSpeaker"),M=t.getCollection(e).speaker!==void 0,D=A.map(j=>K.dir(j)),F=D.every(j=>j===D[0]),f=d.useRef(null),v=()=>{const j=f.current,C=window.getSelection();C!==null&&j!==null&&(C.removeAllRanges(),C.selectAllChildren(j),document.execCommand("copy"),C.removeAllRanges())},_=["results-table",`collection-${t.getCollection(e).id??e.toLowerCase()}`,`file-${o}`,`rich-text-${g?"enabled":"disabled"}`];t.getCollection(e).softWrap===!0&&_.push("soft");const b=s.jsx("div",{className:"results-table-container",children:s.jsxs("table",{ref:f,className:_.join(" "),children:[s.jsx("thead",{children:s.jsxs("tr",{children:[S!==-1&&s.jsx("th",{className:"results-table-actions-cell",children:s.jsx(yt,{callback:v})}),a.filter(j=>p||j!==X).map(j=>s.jsx("th",{children:s.jsx("abbr",{title:k(`languages:${j}.name`),children:s.jsx("span",{translate:"no",children:k(`languages:${j}.code`)})})},j))]})}),s.jsx("tbody",{dir:F&&D[0]!==K.dir()?D[0]:void 0,translate:"no",children:i.map((j,C)=>l<=C&&C<r&&s.jsxs("tr",{"data-id":S!==-1?j[S]:void 0,children:[S!==-1&&s.jsx(Lt,{id:j[S]}),j.map((R,$)=>{if(p||a[$]!==X)return s.jsx("td",{lang:A[$],dir:F?void 0:D[$],dangerouslySetInnerHTML:{__html:St(M?_t(R,L,e,a[$],I):R,a[$])}},$)})]},C))})]})});return s.jsxs(s.Fragment,{children:[l!==0&&s.jsx("button",{className:"results-notice",onClick:h(w,n),children:k("tablePartial",{count:l})}),l!==r&&b,r<i.length&&s.jsx("button",{className:"results-notice",onClick:h(w+r,n),children:k("tablePartial",{count:i.length-r})})]})}function kt(t){const{index:n,status:e,header:o,offset:a,limit:i,lines:l,sectionOffset:r,richText:p}=t,g=Math.max(0,Math.min(l.length,a-r)),w=Math.max(0,Math.min(l.length,a+i-r)),h=d.useMemo(()=>{switch(e){case"noLines":return;case"worker":return s.jsx(Ct,{});case"done":return s.jsx(Et,{...t,start:g,end:w})}},[e,g,w,p]);return h&&s.jsxs("section",{id:`results-section${n}`,className:"results-section",children:[o&&s.jsx("h2",{children:o}),h]})}function Pt({results:t,headers:n,jumpTo:e,...o}){const a=d.useMemo(()=>Se(o.corpus),[o.corpus]),i=d.useMemo(()=>{let l=0;const r=[];for(const[p,g]of t.entries()){if(g.status==="initial")break;const w=g.status==="done"&&g.richText;r.push({...o,...g.params,index:p,sectionOffset:l,richText:w,status:g.status,header:n[p],searchParamsFactory:a}),l+=g.params.lines.length}return r},[t,o]);return d.useEffect(()=>{let l=0;for(const[r,p]of t.entries())if(p.status!=="initial"){if(o.offset>=l&&o.offset<l+p.params.lines.length){e(r);break}l+=p.params.lines.length}},[o.offset]),s.jsx("div",{className:"app-window-inner",children:i.map(l=>s.jsx(kt,{...l},l.index))})}function te(t){const n=document.getElementById("results"),e=document.getElementById(`results-section${t}`),o=n?.firstElementChild;n&&e&&o instanceof HTMLElement&&(n.scrollTop=e.offsetTop-o.offsetTop)}function At({headers:t}){const{t:n}=q();return s.jsx("nav",{className:"results-jump",children:s.jsxs("select",{name:"jump",id:"jump",onChange:e=>{te(Number(e.target.value))},value:"",children:[s.jsx("option",{value:"",disabled:!0,children:n("jumpTo")}),t.map((e,o)=>e!==void 0&&(o===0||t[o-1]!==e)&&s.jsx("option",{value:o,children:e},o))]})})}function Rt({count:t,offset:n,limit:e,setOffset:o}){const{t:a}=q();return s.jsxs("div",{className:"results-nav",children:[s.jsxs("div",{children:[s.jsx("span",{className:"results-nav-range-long",children:a("displayedRange.long",{count:t,start:n+1,end:Math.min(t,n+e)})}),s.jsx("span",{className:"results-nav-range-short",children:a("displayedRange.short",{count:t,start:n+1,end:Math.min(t,n+e)})})]}),s.jsx("button",{className:"button-square",disabled:n===0,onClick:()=>{o(Math.max(0,n-e))},title:a("loadPrev"),children:a("icons:loadPrev",{limit:e})}),s.jsx("button",{className:"button-square",disabled:n+e>=t,onClick:()=>{o(Math.min(Math.floor(t/e)*e,n+e))},title:a("loadNext"),children:a("icons:loadNext",{limit:e})})]})}const me={showVariables:0,showAllCharacters:!1,showGender:2,showPlural:0,showGrammar:!0,showFurigana:!0},Nt=()=>{const t=G("corpus-toggle");if(t===null)return me;const n={...me},e=we(t);return typeof e=="object"&&e!==null&&("showVariables"in e&&typeof e.showVariables=="number"&&[0,1,2].includes(e.showVariables)&&(n.showVariables=e.showVariables),"showAllCharacters"in e&&typeof e.showAllCharacters=="boolean"&&(n.showAllCharacters=e.showAllCharacters),"showGender"in e&&typeof e.showGender=="number"&&[0,1,2].includes(e.showGender)&&(n.showGender=e.showGender),"showPlural"in e&&typeof e.showPlural=="number"&&[0,1,2].includes(e.showPlural)&&(n.showPlural=e.showPlural),"showGrammar"in e&&typeof e.showGrammar=="boolean"&&(n.showGrammar=e.showGrammar),"showFurigana"in e&&typeof e.showFurigana=="boolean"&&(n.showFurigana=e.showFurigana)),n};function Mt({corpus:t,status:n,progress:e,results:o,showId:a=!0,richText:i=!0,limit:l=ae}){const{t:r}=q(),p=d.useMemo(Nt,[]),[g,w]=d.useState(p.showVariables),[h,L]=d.useState(p.showAllCharacters),[k,S]=d.useState(p.showGender),[A,I]=d.useState(p.showPlural),[M,D]=d.useState(p.showGrammar),[F,f]=d.useState(p.showFurigana),[v,_]=d.useState(null),[b,j]=d.useState(0);d.useEffect(()=>{Z("corpus-toggle",JSON.stringify({showVariables:g,showAllCharacters:h,showGender:k,showPlural:A,showGrammar:M,showFurigana:F}))},[g,h,k,A,M,F]);const C=d.useCallback((m,V)=>()=>{j(m),te(V)},[]),R=d.useMemo(()=>{const m=[];let V="";for(const H of o){if(H.status==="initial"||H.status==="noLines"){m.push(void 0);continue}const{collection:z,file:c}=H.params,u=r("tableHeader",{collection:r(`collections:${z}.name`),file:r(`files:${c}`),interpolation:{escapeValue:!1}});m.push(u===V?void 0:u),V=u}return m},[o,K.language]),$=d.useMemo(()=>o.reduce((m,V)=>m+(V.status==="initial"?0:V.params.lines.length),0),[o]);$<b&&j(m=>Math.min(m,$));const P=s.jsxs("div",{className:"results-toggle",children:[s.jsx("button",{className:g!==2?"button-square active":"button-square",disabled:!i,onClick:()=>{w((g+1)%3)},title:r("showVariables"),children:s.jsx("span",{translate:"no",children:r("icons:showVariables",{context:g})})}),s.jsx("button",{className:h?"button-square active":"button-square",disabled:!i,onClick:()=>{L(!h)},title:r("showAllCharacters"),children:s.jsx("span",{translate:"no",children:r("icons:showAllCharacters")})}),s.jsx("button",{className:k!==2?"button-square active":"button-square",disabled:!i,onClick:()=>{S((k+1)%3)},title:r("showGender"),children:s.jsx("span",{translate:"no",children:r("icons:showGender",{context:k})})}),s.jsx("button",{className:A!==0?"button-square active":"button-square",disabled:!i,onClick:()=>{I((A+1)%3)},title:r("showPlural"),children:s.jsx("span",{translate:"no",children:r("icons:showPlural",{context:A})})}),s.jsx("button",{className:M?"button-square active":"button-square",disabled:!i,onClick:()=>{D(!M)},title:r("showGrammar"),children:s.jsx("span",{translate:"no",children:r("icons:showGrammar")})}),s.jsx("button",{className:F?"button-square active":"button-square",disabled:!i,onClick:()=>{f(!F)},title:r("showFurigana"),children:s.jsx("span",{className:"results-toggle-furigana",translate:"no",children:r("icons:showFurigana")})})]});d.useEffect(()=>{d.startTransition(()=>{_(s.jsx(Pt,{corpus:t,results:o,headers:R,showId:a,offset:b,limit:l,onShowSection:C,jumpTo:te}))})},[t,o,R,a,b,l,C,te]);const x=ye(n),N=r(`status.${n.split(".",1)[0]}`),O=d.useMemo(()=>!x&&R.filter(m=>m!==void 0).length>1?s.jsx(At,{headers:R}):s.jsx("div",{className:"results-status-text",children:N}),[x,R]),U=`app-window variables-${["short","show","hide"][g]} control-${h?"show":"hide"} gender-${k} number-${A} grammar-${M?"show":"hide"} furigana-${F?"show":"hide"}`;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"results-status",children:[O,s.jsx(xt,{src:"logo.svg",active:x}),!x&&$>l?s.jsx(Rt,{count:$,offset:b,limit:l,setOffset:j}):s.jsx(Le,{progress:e}),P]}),s.jsx("main",{id:"results",className:U,children:v})]})}const Tt={status:"initial"},fe="corpus-warn",It=2e7;function Ft({loader:t,showModal:n,richText:e,limit:o}){const{t:a}=q(),i=d.useRef(null),l=d.useRef(null),r=d.useRef([]),p=d.useRef(e),g=d.useRef(G(fe)!=="false"),[w,h]=d.useState("initial"),[L,k]=d.useState(0),[S,A]=d.useState(!0),[I,M]=d.useState([]);d.useEffect(()=>{p.current=e;for(const{index:x,params:N}of r.current)f(x,N)},[e]);const D=(x,N)=>{M(O=>{const U=Array().concat(O);for(let m=U.length;m<x;m++)U[m]=Tt;return U[x]=N,U})},F=x=>{D(x.data.index,{status:"done",params:x.data,richText:x.data.richText}),x.data.error&&n({message:a("statusModal.error"),buttons:[{message:a("statusModal.buttons.ok"),autoFocus:!0}]})},f=(x,N)=>{l.current===null&&(console.log("Creating new TextWorker..."),l.current=new Ye,l.current.addEventListener("message",F)),l.current.postMessage({...N,index:x,richText:p.current,corpusLiterals:t.corpus.getCollection(N.collection).literals})},v=x=>{if(h(x.data.status),k(x.data.progress),A(x.data.showId),"index"in x.data&&"result"in x.data){const{index:N,result:O}=x.data;x.data.result.lines.length===0?D(N,{status:"noLines",params:O}):(r.current.push({index:N,params:O}),D(N,{status:"worker",params:O}),f(N,O))}x.data.complete&&tt(x.data.status)&&n({message:a(`statusModal.${x.data.status}`),buttons:[{message:a("statusModal.buttons.ok"),autoFocus:!0}]})},_=d.useCallback(()=>{console.log("Terminating workers!"),i.current!==null&&(i.current.removeEventListener("message",v),i.current.terminate(),i.current=null),l.current!==null&&(l.current.removeEventListener("message",v),l.current.terminate(),l.current=null),h("initial"),k(0),M([]),r.current=[]},[]),b=x=>{M([]),r.current=[],x.query.length>0&&x.collections.length>0&&x.languages.length>0&&(i.current===null&&(console.log("Creating new SearchWorkerManager..."),i.current=new Xe,i.current.addEventListener("message",v)),h("waiting"),k(0),i.current.postMessage({...x,serializedCorpus:Ce(t.corpus)}))},j=d.useCallback(x=>{if(!g.current){b(x);return}t.getDownloadSizeTotal(x.collections,x.showAllLanguages?void 0:x.languages).then(N=>{if(N<=It){b(x);return}n({message:a("searchModal.message",Y(N)),checkbox:{message:a("searchModal.checkboxDoNotShowAgain"),checked:!1},buttons:[{message:a("searchModal.buttons.yes"),callback:()=>{b(x)},checkboxCallback:O=>{g.current=!O,Z(fe,(!O).toString())}},{message:a("searchModal.buttons.no"),callback:()=>{h("initial")},autoFocus:!0}],cancelCallback:()=>{h("initial")}})}).catch(J)},[t.getDownloadSizeTotal]),C=ye(w),R=w==="waiting",$=d.useMemo(()=>s.jsx(jt,{corpus:t.corpus,inProgress:C,waiting:R,postToWorker:j,terminateWorker:_}),[t.corpus,C,R,j,_]),P=d.useMemo(()=>s.jsx(Mt,{corpus:t.corpus,status:w,progress:L,showId:S,richText:e,results:I,limit:o}),[t.corpus,w,L,S,e,I,o]);return s.jsxs("div",{className:"search",children:[$,P]})}function Dt(t){return new Worker("/poke-corpus/assets/cacheManagerWorker-C6FDjb1p.js",{name:t?.name})}function Ot({callback:t}){const{t:n}=q();return s.jsx("button",{className:"link",title:n("delete"),onClick:t,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#trash-can"})})})}function Vt({callback:t}){const{t:n}=q();return s.jsx("button",{className:"link",title:n("refresh"),onClick:t,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#arrows-rotate"})})})}function $t({cacheStorageEnabled:t,cachedMetadata:n}){const{t:e}=q(),o=d.useMemo(()=>Y(n.reduce((a,[,i])=>a+i,0)),[n]);return s.jsxs("ul",{children:[s.jsx("li",{children:e("cache.storageStatus",{val:e(t?"cache.storageEnabled":"cache.storageDisabled")})}),t&&s.jsx("li",{children:e("cache.filesStored",{count:n.length})}),t&&s.jsx("li",{children:e("cache.storageUsed",o)})]})}function Bt({loadedBytes:t,totalBytes:n,progress:e}){const{t:o}=q();return s.jsxs("div",{className:"cache-entry-notice",children:[o("cache.loading",{message:o("cache.inProgress"),loaded:o("cache.size",Y(t)),total:o("cache.size",Y(n))}),s.jsx(Le,{progress:e})]})}function qt({corpus:t,cachedMetadata:n,cacheCollections:e,clearCachedFile:o}){const{t:a}=q(),i=d.useMemo(()=>t.collections.map(r=>{const p=n.filter(([[g]])=>r===g);return[r,p.reduce((g,[,w])=>g+w,0),p.every(([,,g])=>g)]}).filter(([,r])=>r>0),[n]);return s.jsx("div",{className:"cache-entry-list",children:n.length>0&&i.map(([l,r,p],g)=>s.jsxs("div",{className:`cache-entry cache-entry-${p?"current":"outdated"}`,children:[s.jsxs("div",{className:"cache-entry-text",children:[s.jsx("div",{children:s.jsx("abbr",{title:a(`collections:${l}.name`),children:s.jsx("span",{translate:"no",children:a(`collections:${l}.short`)})})}),s.jsx("div",{translate:"no",children:a("cache.size",Y(r))})]}),s.jsxs("div",{className:"cache-entry-actions",children:[!p&&s.jsx(Vt,{callback:()=>{e(l)}}),s.jsx(Ot,{callback:()=>{o(l)}})]})]},g))})}function zt({active:t,loader:n,showModal:e}){const{t:o}=q(),[a,i]=d.useState(!1),[l,r]=d.useState([]),[p,g]=d.useState(!1),[w,h]=d.useState(0),[L,k]=d.useState(0),[S,A]=d.useState(0),I=d.useRef(null),M=()=>{"caches"in window&&"indexedDB"in window&&"databases"in window.indexedDB?Promise.all([n.getCache(),n.getIndexedDB()]).then(()=>{i(!0)}).catch(()=>{i(!1),r([])}):(i(!1),r([]))},D=P=>{const{status:x,loadedBytes:N,totalBytes:O,requestedCollection:U}=P.data;switch(h(N/O),k(N),A(O),x){case"loading":return;case"done":console.log("Caching complete");break;case"error":console.log("Caching error");break}I.current?.terminate(),I.current=null,g(!1),v(U)},F=d.useCallback(P=>{"caches"in window&&(g(!0),h(0),k(0),I.current===null&&(console.log("Creating new CacheManagerWorker..."),I.current=new Dt,I.current.addEventListener("message",D),I.current.postMessage({serializedCorpus:Ce(n.corpus),requestedCollection:P})))},[n]),f=async(P="background")=>{if("caches"in window&&"indexedDB"in window&&"databases"in window.indexedDB){const[x,N]=await Promise.all([n.getCache(),n.getIndexedDB()]),O=n.corpus.entries.flatMap(([z,c])=>c.files.flatMap(u=>c.languages.map(y=>[z,y,u]))),U=O.map(([z,c,u])=>n.getFilePath(z,c,u)),m=await Promise.all(U.map(z=>n.getFileCacheOnly(x,N,z).then(async([c,u])=>[c!==void 0?(await c.blob()).size:-1,u])));r(m.map(([z,c],u)=>[O[u],z,c]).filter(([,z])=>z!==-1));const V=new Set(U),H=(await n.getAllLocalFilePaths(N)).filter(z=>!V.has(z));await Promise.all(H.map(z=>Promise.all([n.deleteLocalMetadata(N,z),x.delete(z)]).then(([c,u])=>{console.debug(c&&u?`Deleted ${z} from cache`:`Failed to delete ${z} from cache`)}))),N.close(),P==="cacheAll"&&m.some(([z,c])=>z===-1||!c)&&R()}},v=P=>{f(P).catch(J)},_=()=>{const P=[];I.current&&(I.current.terminate(),I.current=null),"serviceWorker"in navigator&&P.push(navigator.serviceWorker.ready.then(x=>x.unregister())),"indexedDB"in window&&"databases"in window.indexedDB&&P.push(n.getIndexedDB().then(x=>n.clearLocalMetadata(x).then(()=>f()))),"caches"in window&&P.push(n.getCache().then(x=>x.keys().then(N=>Promise.all(N.map(O=>x.delete(O)))))),Promise.all(P).then(()=>{console.log("Cache cleared")}).catch(x=>{console.log("Error clearing cache"),console.error(x)})},b=async P=>{if("caches"in window&&"indexedDB"in window&&"databases"in window.indexedDB){const[x,N]=await Promise.all([n.getCache(),n.getIndexedDB()]),O=n.corpus.getCollection(P);await Promise.all(O.languages.flatMap(U=>O.files.flatMap(m=>{const V=n.getFilePath(P,U,m);return[n.deleteLocalMetadata(N,V),x.delete(V)]}))),N.close(),await f()}},j=d.useCallback(P=>{b(P).catch(J)},[]);d.useEffect(()=>{M(),f().catch(J)},[t,n.corpus.entries,n.corpus.metadata]);const C=()=>{n.getDownloadSizeTotal().then(P=>{e({message:o("cache.cacheAllModal.message",Y(P)),buttons:[{message:o("cache.cacheAllModal.buttons.yes"),callback:()=>{F("cacheAll")}},{message:o("cache.cacheAllModal.buttons.no"),callback:()=>{g(!1)},autoFocus:!0}],cancelCallback:()=>{g(!1)}})}).catch(J)},R=()=>{e({message:o("cache.cacheAllFailedModal.message"),buttons:[{message:o("cache.cacheAllFailedModal.buttons.ok"),autoFocus:!0}]})},$=()=>{e({message:o("cache.clearCacheModal.message"),buttons:[{message:o("cache.clearCacheModal.buttons.yes"),callback:_},{message:o("cache.clearCacheModal.buttons.no"),autoFocus:!0}]})};return t&&s.jsxs("div",{className:"cache",children:[s.jsxs("div",{className:"cache-button-group item-group",children:[s.jsx("button",{onClick:C,disabled:p!==!1,children:o("cacheAll")}),s.jsx("button",{onClick:$,children:o("clearCache")})]}),s.jsx("div",{className:"cache-results app-window",children:s.jsxs("div",{className:"app-window-inner",children:[s.jsx($t,{cacheStorageEnabled:a,cachedMetadata:l}),p?s.jsx(Bt,{loadedBytes:L,totalBytes:S,progress:w}):s.jsx(qt,{corpus:n.corpus,cachedMetadata:l,cacheCollections:F,clearCachedFile:j})]})})]})}function Ut({classes:t,message:n,buttons:e,checkbox:o,cancelCallback:a}){const[i,l]=d.useState(n!==void 0),[r,p]=d.useState(o?.checked??!1),g=d.useRef(null),w=d.useRef(null);d.useEffect(()=>{const S=g.current,A=w.current;if(S!==null)if(i){if(S.showModal(),e){const I=e.findIndex(M=>M.autoFocus);A!==null&&I!==-1&&Array.from(A.children).filter(M=>M instanceof HTMLButtonElement)[I].focus()}}else S.close()},[i]);const h=(S,A)=>()=>{l(!1),S&&S(),A&&A(r)},L=()=>{a&&a(),l(!1)};if(!i)return null;const k=["modal"];return t&&t.forEach(S=>k.push(S)),s.jsxs("dialog",{ref:g,id:"modal",className:k.join(" "),onCancel:L,children:[s.jsx("div",{className:"modal-message",children:n}),o&&s.jsx("div",{className:"modal-checkbox",children:s.jsxs("div",{children:[s.jsx("input",{type:"checkbox",id:"modalCheckbox",name:"modalCheckbox",checked:r,onChange:S=>{p(S.target.checked)}}),s.jsx("label",{htmlFor:"modalCheckbox",children:o.message})]})}),s.jsx("div",{ref:w,className:"modal-button-group",children:e?.map(({message:S,callback:A,checkboxCallback:I,autoFocus:M},D)=>s.jsx("button",{type:"button",onClick:h(A,I),autoFocus:M,children:S},D))})]})}function re(){const{t}=q();return s.jsx("div",{className:"app-window",children:s.jsx("div",{className:"app-window-inner",children:s.jsxs("section",{className:"results-section",children:[s.jsx("h2",{children:t("error.title")}),s.jsx("div",{children:t("error.message")})]})})})}const le="corpus",se=t=>"/poke-corpus/"+t,Wt=se("data.json"),Ht=t=>{const n=f=>w(f).size,e=async(f,v)=>{const[_,b]=await S(f,v);return b?.hash===_.hash?0:_.size},o=async(f=t.collections,v=t.languages)=>{try{const _=await g(),b=(await Promise.all(f.flatMap(j=>t.getCollection(j).languages.filter(C=>v.includes(C)).flatMap(C=>t.getCollection(j).files.map(R=>e(_,ee(j,C,R))))))).reduce((j,C)=>j+C,0);return _.close(),b}catch{return f.flatMap(_=>t.getCollection(_).languages.filter(b=>v.includes(b)).flatMap(b=>t.getCollection(_).files.map(j=>n(ee(_,b,j))))).reduce((_,b)=>_+b,0)}},a=async(f,v,_)=>{const b=se(_),[j,C]=await S(v,_);if(C?.hash===j.hash||!navigator.onLine&&C?.hash!==void 0){const P=await D(f,b);if(P!==void 0)return P}const R=await fetch(b);return R.ok?(await F(f,b,R).then(async P=>{P&&await L(v,_)}),R):await D(f,b)??null},i=async(f,v,_)=>{const b=se(_),[j,C]=await S(v,_);return C!==void 0?[await D(f,b),C.hash===j.hash]:[void 0,!1]},l=async f=>{const v=se(f),_=await fetch(v);return _.ok?_:null},r="corpus",p="files",g=async()=>{const f=indexedDB.open(r);return new Promise((v,_)=>{f.onupgradeneeded=()=>{f.result.createObjectStore(p),f.transaction!==null&&(f.transaction.oncomplete=()=>{console.log("Created object store")})},f.onsuccess=()=>{v(f.result)},f.onerror=()=>{_(f.error)}})},w=f=>t.metadata[f],h=async(f,v)=>{const j=f.transaction([p],"readonly").objectStore(p).get(v);return new Promise((C,R)=>{j.onsuccess=()=>{C(rt(j.result)?j.result:void 0)},j.onerror=()=>{R(j.error)}})},L=async(f,v)=>{const j=f.transaction([p],"readwrite").objectStore(p).put(w(v),v);return new Promise((C,R)=>{j.onsuccess=()=>{C(j.result===v)},j.onerror=()=>{R(j.error)}})},k=async(f,v)=>{const j=f.transaction([p],"readwrite").objectStore(p).delete(v);return new Promise((C,R)=>{j.onsuccess=()=>{C(!0)},j.onerror=()=>{R(j.error)}})},S=async(f,v)=>[w(v),await h(f,v)],A=async f=>{const b=f.transaction(["files"],"readwrite").objectStore("files").clear();return f.close(),new Promise((j,C)=>{b.onsuccess=()=>{j(!0)},b.onerror=()=>{C(b.error)}})},I=async f=>{const b=f.transaction([p],"readonly").objectStore(p).getAllKeys();return f.close(),new Promise((j,C)=>{b.onsuccess=()=>{j(b.result.filter(R=>typeof R=="string"))},b.onerror=()=>{C(b.error)}})},M=async()=>await caches.open(le),D=async(f,v)=>{try{return await f.match(v)}catch(_){console.error(_);return}},F=async(f,v,_)=>{try{return await f.put(v,_.clone()),!0}catch(b){return console.error(b),!1}};return{corpus:t,getFilePath:ee,getFileSize:n,getDownloadSizeTotal:o,getFile:a,getFileCacheOnly:i,getFileRemote:l,getIndexedDB:g,deleteLocalMetadata:k,clearLocalMetadata:A,getAllLocalFilePaths:I,getCache:M}};function Gt(t){return Ht(t)}function Kt(t,n=Wt){const e=()=>{t(o=>o===void 0?null:o)};Promise.all([Jt(n).then(o=>{t(a=>a===void 0&&o!==null?o:a)}).catch(J),Zt(n).then(o=>{t(a=>o??a)}).catch(J)]).then(e,e)}async function Jt(t){if("caches"in window){const e=await(await caches.open(le)).match(t);if(e?.ok)return Ee(e)}return null}async function Zt(t){const n=await fetch(t);if(!n.ok)return null;if("caches"in window){const e=n.clone();caches.open(le).then(o=>o.put(t,e)).catch(J)}return Ee(n)}async function Ee(t){const n=await t.json(),e=it(n);return Gt(e)}const pe="Search";function Qt({showModal:t,richText:n,setRichText:e,limit:o,setLimit:a,reset:i}){const{t:l}=q();return s.jsxs("header",{className:"header",children:[s.jsx("h1",{children:s.jsxs("a",{href:"/poke-corpus/",onClick:i,children:[s.jsx("img",{className:"header-logo",src:"logo.svg",alt:"",height:"40",width:"40"})," ",l("title",{version:l("version")})]})}),s.jsx(ce,{fallback:null,children:s.jsx(Qe,{showModal:t,richText:n,setRichText:e,limit:o,setLimit:a})})]})}function Xt({view:t,switchView:n}){const{t:e}=q();return s.jsxs("footer",{children:[s.jsx("span",{children:e("tagline")}),s.jsx("span",{className:"separator",translate:"no",children:" | "}),s.jsx("span",{children:e("footerText")}),s.jsx("span",{className:"separator",translate:"no",children:" | "}),s.jsx("span",{children:s.jsx("button",{className:"link",onClick:n,children:e(t!=="Search"?"backToSearch":"manageCache")})}),s.jsx("span",{className:"separator",translate:"no",children:" | "}),s.jsx("span",{children:s.jsx("a",{href:"https://github.com/abcboy101/poke-corpus",children:e("github")})})]})}function Yt(){const[t,n]=d.useState(Ge),[e,o]=d.useState(He),[a,i]=d.useState(pe),[l,r]=d.useState(0),[p,g]=d.useState(0),[w,h]=d.useState(null),[L,k]=d.useState(!1),[S,A]=d.useState(void 0);d.useEffect(()=>{const f=ve();document.body.classList.add(`mode-${f}`),k(!0),Kt(A)},[]);const I=d.useCallback(f=>{window.location.hash="",ze("corpus-params"),i(pe),r(v=>v+1&255),g(0),h(null),f.preventDefault()},[]),M=d.useCallback(f=>{h(f),g(v=>v+1&255)},[]),D=d.useCallback(()=>{i(f=>{const v=f!=="Search"?"Search":"CacheManager";return L||k(v==="CacheManager"),v})},[]);if(S===void 0)return;const F=["app",`view-${a.toLowerCase()}`];return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&F.push("ua-safari"),s.jsxs("div",{className:F.join(" "),lang:K.language,dir:K.dir(),children:[s.jsx(Qt,{showModal:M,richText:t,setRichText:n,limit:e,setLimit:o,reset:I}),S!==null?s.jsxs(ce,{FallbackComponent:re,children:[s.jsx(Ft,{loader:S,showModal:M,richText:t,limit:e}),s.jsx(zt,{active:a==="CacheManager",loader:S,showModal:M})]}):s.jsx(re,{}),s.jsx(Xt,{view:a,switchView:D}),s.jsx(Ut,{...w},p)]},l)}function es(){return s.jsx("div",{className:"app",children:s.jsx(re,{})})}const ts=Me.createRoot(document.getElementById("root"));ts.render(s.jsx(Ne.StrictMode,{children:s.jsx(ce,{FallbackComponent:es,children:s.jsx(Yt,{})})}));qe({onOfflineReady(){console.log("Ready to work offline!")}});
