import{u as $,r as h,j as s,i as G,B as Ce,a as Le,b as Ee,E as ae,R as ke}from"./vendor-XPNbIhcT.js";import{R as Pe}from"./react-dom-BYbQ8dEu.js";import{t as Ae,i as Re,f as Ne,l as Me,c as Te,a as Ie}from"./i18n-en-84MEhzKe.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(a){if(a.ep)return;a.ep=!0;const c=e(a);fetch(a.href,c)}})();const Fe="modulepreload",De=function(t){return"/poke-corpus/"+t},re={},k=function(n,e,o){let a=Promise.resolve();if(e&&e.length>0){let l=function(d){return Promise.all(d.map(v=>Promise.resolve(v).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),f=r?.nonce||r?.getAttribute("nonce");a=l(e.map(d=>{if(d=De(d),d in re)return;re[d]=!0;const v=d.endsWith(".css"),g=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const C=document.createElement("link");if(C.rel=v?"stylesheet":Fe,v||(C.as="script"),C.crossOrigin="",C.href=d,f&&C.setAttribute("nonce",f),document.head.appendChild(C),v)return new Promise((A,E)=>{C.addEventListener("load",A),C.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${d}`)))})}))}function c(l){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=l,window.dispatchEvent(r),!r.defaultPrevented)throw l}return a.then(l=>{for(const r of l||[])r.status==="rejected"&&c(r.reason);return n().catch(c)})};function Oe(t={}){const{immediate:n=!1,onNeedRefresh:e,onOfflineReady:o,onRegistered:a,onRegisteredSW:c,onRegisterError:l}=t;let r,f;const d=async(g=!0)=>{await f};async function v(){if("serviceWorker"in navigator){if(r=await k(async()=>{const{Workbox:g}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:g}},[]).then(({Workbox:g})=>new g("/poke-corpus/sw.js",{scope:"/poke-corpus/",type:"classic"})).catch(g=>{l?.(g)}),!r)return;r.addEventListener("activated",g=>{(g.isUpdate||g.isExternal)&&window.location.reload()}),r.addEventListener("installed",g=>{g.isUpdate||o?.()}),r.register({immediate:n}).then(g=>{c?c("/poke-corpus/sw.js",g):a?.(g)}).catch(g=>{l?.(g)})}}return f=v(),d}const ce=t=>t.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&");function H(t){try{return localStorage.getItem(t)}catch{return null}}function K(t,n){try{localStorage.setItem(t,n)}catch{return}}function Ve(t){try{localStorage.removeItem(t)}catch{return}}const he=["system","light","dark"],ge=t=>he.some(n=>t===n),$e=t=>typeof t=="string"&&ge(t)?t:"system",me=()=>$e(H("mode")),se=500,qe=t=>!Number.isNaN(t)&&Number.isInteger(t)&&t>0,Be=()=>{const t=+(H("corpus-limit")??se);return Number.isNaN(t)?se:t},ze=()=>H("corpus-richText")!=="false",ie=["byte","kilobyte","megabyte","gigabyte","terabyte","petabyte"];function Q(t){const n=Math.min(Math.floor((t.toString().length-1)/3),ie.length-1),e={style:"unit",unit:ie[n],unitDisplay:n===0?"long":"short",minimumFractionDigits:n===0?0:1,maximumFractionDigits:1,maximumSignificantDigits:3,roundingPriority:"lessPrecision"};return{amount:t/Math.pow(1e3,n),formatParams:{amount:e}}}function Ue(t,n=1){return{amount:t,formatParams:{amount:{style:"percent",minimumFractionDigits:n,maximumFractionDigits:n}}}}function fe(t){try{return JSON.parse(t)}catch(n){return console.error(n),null}}const We=[{code:"en",name:"English (United States)"},{code:"en-GB",name:"English (United Kingdom)"},{code:"ja",name:"日本語"},{code:"de",name:"Deutsch"},{code:"fr",name:"Français (France)"},{code:"fr-CA",name:"Français (Canada)"},{code:"es",name:"Español (España)"},{code:"it",name:"Italiano"},{code:"ko",name:"한국어"},{code:"zh-Hans",name:"简体中文"},{code:"zh-Hant",name:"繁体中文"}];function He({showModal:t,richText:n,richTextRef:e,limit:o,limitRef:a}){const{t:c}=$(),[l,r]=h.useState(me),f=g=>{G.changeLanguage(g.target.value,C=>{C?.some(A=>!A.message.includes("Unknown variable dynamic import"))&&(console.error(C),t({message:c("options.network"),buttons:[{message:s.jsx(pe,{}),autoFocus:!0}]}))}).catch(C=>{console.error(C)})},d=g=>{const C=g.target.value;ge(C)&&(r(C),K("mode",C),document.body.classList.replace(`mode-${l}`,`mode-${C}`))},v=g=>{const C=g.target.value;(C==="true"||C==="false")&&K("corpus-longURL",C)};return s.jsx("div",{className:"options",children:s.jsxs("div",{className:"options-grid",children:[s.jsx("label",{htmlFor:"language",children:c("options.language")}),s.jsx("select",{name:"language",id:"language",onChange:f,defaultValue:G.language,autoFocus:!0,translate:"no",children:We.map(g=>s.jsx("option",{value:g.code,lang:g.code,children:g.name},g.code))}),s.jsx("label",{htmlFor:"mode",children:c("options.mode")}),s.jsx("select",{name:"mode",id:"mode",onChange:d,defaultValue:l,children:he.map(g=>s.jsx("option",{value:g,children:c(`options.modes.${g}`)},g))}),s.jsx("label",{htmlFor:"longURL",children:c("options.longURL")}),s.jsx("select",{name:"longURL",id:"longURL",onChange:v,defaultValue:H("corpus-longURL")??"false",children:["true","false"].map(g=>s.jsx("option",{value:g,children:c(`options.longURLSelect.${g}`)},g))}),s.jsx("label",{htmlFor:"richText",children:c("options.richText")}),s.jsx("select",{ref:e,name:"richText",id:"richText",defaultValue:n?"true":"false",children:["true","false"].map(g=>s.jsx("option",{value:g,children:c(`options.richTextSelect.${g}`)},g))}),s.jsx("label",{htmlFor:"limit",children:c("options.limit")}),s.jsx("input",{ref:a,type:"number",name:"limit",id:"limit",min:1,defaultValue:o})]})})}function pe(){const{t}=$();return t("options.close")}function Ge(t){const{t:n}=$(),{showModal:e,setRichText:o,setLimit:a}=t,c=h.useRef(null),l=h.useRef(null),r=()=>{if(c.current!==null){const d=c.current.value;(d==="true"||d==="false")&&(K("corpus-richText",d),o(d!=="false"))}if(l.current!==null){const d=l.current.valueAsNumber;qe(d)&&(K("corpus-limit",d.toString()),a(d))}},f={classes:["modal-options"],message:s.jsx(He,{...t,richTextRef:c,limitRef:l}),buttons:[{message:s.jsx(pe,{}),callback:r}],cancelCallback:r};return s.jsxs("button",{className:"header-options",onClick:()=>{e(f)},children:[s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#gear"})}),n("options.options")]})}function Ke(t){return new Worker("/poke-corpus/assets/searchWorkerManager-DXXWWZvh.js",{name:t?.name})}function Je(t){return new Worker("/poke-corpus/assets/textWorker-Xwew4GOV.js",{name:t?.name})}const Ze=["error","regex","noMatch","network","boolean.parentheses","boolean.regex","boolean.slash","boolean.quote","boolean.operand","boolean.empty","boolean.where"],Qe=t=>Ze.some(n=>t===n),Xe=["waiting","loading","processing","collecting"],je=t=>Xe.some(n=>t===n),J=["exact","regex","boolean","all"],oe=t=>J.some(n=>t===n),xe={id:"",file:"",query:"",type:"all",caseInsensitive:!0,common:!0,script:!0,showAllLanguages:!0,run:!1},Ye=t=>({...xe,collections:t.collections.filter(n=>t.getCollection(n).structured),languages:t.languages}),et=t=>{function n(i){const u={};return i.id!==void 0&&(u.id=i.id),i.file!==void 0&&(u.file=i.file),i.run!==void 0&&(u.run=i.run.toString()),new URLSearchParams({query:i.query,type:i.type,caseInsensitive:i.caseInsensitive.toString(),common:i.common.toString(),script:i.script.toString(),showAllLanguages:i.showAllLanguages.toString(),collections:i.collections.join(","),languages:i.languages.join(","),...u}).toString()}function e(i){const u=new URLSearchParams(i);return{id:o(u.get("id")),file:o(u.get("file")),query:o(u.get("query")),type:c(u.get("type")??(u.get("regex")==="true"?"regex":null),oe),caseInsensitive:a(u.get("caseInsensitive")),common:a(u.get("common")),script:a(u.get("script")),showAllLanguages:a(u.get("showAllLanguages")),collections:l(u.get("collections"),t.isCollectionKey),languages:l(u.get("languages"),t.isLanguageKey,r),run:a(u.get("run"))}}function o(i){return i??void 0}function a(i){switch(i){case"true":return!0;case"false":return!1}}function c(i,u){if(i!==null&&u(i))return i}function l(i,u,x=P=>P){if(i!==null)return i.split(",").map(x).filter(u)}function r(i){switch(i){case"qid-ZZ":case"ja-JP":case"en-US":case"fr-FR":case"it-IT":case"de-DE":case"es-ES":case"ko-KR":return i.split("-",1)[0];case"ja-Hrkt-JP":return"ja-Hrkt";case"zh-CN":return"zh-Hans";case"zh-TW":return"zh-Hant";default:return i}}const f=t.collections.length^t.languages.length<<4,d=2,v=Math.ceil(t.languages.length/8),g=Math.ceil(t.collections.length/8),C=v+g,A=64,E=Math.ceil(Math.log2(t.languages.length+t.collections.length)),R=d+C,q=i=>btoa(String.fromCodePoint(...i)).replaceAll("/","_").replaceAll("+","-").replace(/=+$/,""),I=i=>Uint8Array.from(atob(i.replaceAll("_","/").replaceAll("-","+")),u=>u.charCodeAt(0));function M(i){const u={};i.id!==void 0&&(u.id=i.id),i.file!==void 0&&(u.file=i.file);const x=B(i);return y(x),new URLSearchParams({...u,q:i.query,s:q(x)}).toString()}function D(i){const u=new URLSearchParams(i),x={id:o(u.get("id")),file:o(u.get("file")),query:o(u.get("q"))},P=o(u.get("s"));if(!P)return x;try{const O=I(P).subarray(0,R);return S(O),{...x,...T(O)}}catch{return x}}function B(i){const u=new Uint8Array(R);u[1]=+(i.run??xe.run)<<0|+i.caseInsensitive<<1|+i.common<<2|+i.script<<3|J.indexOf(i.type)<<4|+!i.showAllLanguages<<7;const x=u.subarray(d);p(i,x),j(x,u.subarray(1,2));let P=u.length;for(;u[P-1]===0&&P>1;)P--;return u.subarray(0,P)}function T(i){const u=new Uint8Array(C);i[1]&A?b(i.subarray(d),u):u.set(i.subarray(d));const x=t.languages.filter((O,W)=>V(u,W)===1),P=t.collections.filter((O,W)=>V(u,8*v+W)===1);return{run:(i[1]&1)!==0,caseInsensitive:(i[1]&2)!==0,common:(i[1]&4)!==0,script:(i[1]&8)!==0,type:J[(i[1]&48)>>4],showAllLanguages:(i[1]&128)===0,languages:x,collections:P}}function p(i,u){t.languages.forEach((x,P)=>{i.languages.includes(x)&&L(u,P)}),t.collections.forEach((x,P)=>{i.collections.includes(x)&&L(u,8*v+P)})}function b(i,u){const x=_(i);t.languages.forEach((P,O)=>{x.next().value&&L(u,O)}),t.collections.forEach((P,O)=>{x.next().value&&L(u,8*v+O)})}function j(i,u){const x=V(i,0)===1,P=w(i,x);let O=i.length;for(;i[O-1]===0;)O--;if(1+P.length*E<8*O){u[0]|=A,i.fill(0),x||L(i,0);let W=1;P.forEach(([Se])=>{for(let te=0;te<E;W++,te++)L(i,W,Se>>te&1)})}}function w(i,u){const x=[[0,u]];return t.languages.forEach((P,O)=>{const W=V(i,O)===1;x[x.length-1][1]===W?x[x.length-1][0]++:x.push([1,W])}),t.collections.forEach((P,O)=>{const W=V(i,8*v+O)===1;x[x.length-1][1]===W?x[x.length-1][0]++:x.push([1,W])}),x.pop(),x}function*_(i){const u=new Uint8Array(C);u.set(i);let x=V(u,0)!==1;for(let P=1;P+E<=u.length*8;){let O=0;for(let W=0;W<E;P++,W++)O|=V(u,P)<<W;if(O===0)break;for(;O>0;)yield x,O--;x=!x}for(;;)yield x}function L(i,u,x=1){i[u>>3]|=x<<(u&7)}function V(i,u){return i[u>>3]>>(u&7)&1}function y(i){const u=i[0]=N(i);z(u,i)}function S(i){const u=i[0];if(z(u,i),u!==N(i))throw Error("invalid checksum")}function N(i,u=1){return i.subarray(u).reduce((x,P)=>x+P&255,0)^f&255}function z(i,u,x=1){let P=m(i);for(let O=x;O<u.length;O++)u[O]^=P>>24,P=F(P)}const m=i=>2480367069*i&4294967295,F=i=>2438952949*i+2654435769&4294967295;function U(i){return(H("corpus-longURL")==="true"?n:M)(i)}function X(i){const u=new URLSearchParams(i);return(u.get("q")||u.get("s")?D:e)(i)}return{_bytesBase64:R,_searchParamsToQueryString:n,_queryStringToSearchParams:e,_searchParamsToBase64:M,_base64ToSearchParams:D,_serializeByteArray:B,_deserializeByteArray:T,_encryptBytes:y,_decryptBytes:S,searchParamsToHash:U,hashToSearchParams:X}};function ve(t){return et(t)}const Z="qid",tt="zxx",st=t=>t!==null&&typeof t=="object"&&"hash"in t&&typeof t.hash=="string"&&"size"in t&&typeof t.size=="number",nt=t=>{const n=Object.entries(t.corpus.collections);return Object.fromEntries(n.flatMap(([e,o])=>o.languages.flatMap(a=>o.files.map(c=>Y(e,a,c)))).map((e,o)=>[e,{hash:t.hashes[o],size:t.sizes[o]}]))},at=t=>{const n=t.corpus,e=Object.keys(n.collections),o=Object.entries(n.collections),a=nt(t);return{_corpus:n,collections:e,languages:n.languages,entries:o,metadata:a,getCollection:c=>n.collections[c],isCollectionKey:c=>e.some(l=>c===l),isLanguageKey:c=>n.languages.some(l=>c===l)}},Y=(t,n,e)=>`corpus/${t}/${n}_${e}.txt.gz`;async function ot(){const n=await(await fetch("/poke-corpus/data.json")).json();return at(n)}function be(t){return{corpus:t._corpus,metadata:t.metadata}}const rt=(t,n,e)=>{const o=t[n];return o?typeof o=="function"?o():Promise.resolve(o):new Promise((a,c)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(c.bind(null,new Error("Unknown variable dynamic import: "+n+(n.split("/").length!==e?". Note that variables only represent file names one level deep.":""))))})};G.use(Ce).use(Le).use(Ee((t,n)=>rt(Object.assign({"./de/collections.json":()=>k(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.c),[]),"./de/files.json":()=>k(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.f),[]),"./de/languages.json":()=>k(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.l),[]),"./de/translation.json":()=>k(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.t),[]),"./en-GB/translation.json":()=>k(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.j),[]),"./en/collections.json":()=>k(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.d),[]),"./en/files.json":()=>k(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.g),[]),"./en/icons.json":()=>k(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.h),[]),"./en/languages.json":()=>k(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.e),[]),"./en/translation.json":()=>k(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.b),[]),"./es/collections.json":()=>k(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.c),[]),"./es/files.json":()=>k(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.f),[]),"./es/languages.json":()=>k(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.l),[]),"./es/translation.json":()=>k(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.t),[]),"./fr-CA/translation.json":()=>k(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.t),[]),"./fr/collections.json":()=>k(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.c),[]),"./fr/files.json":()=>k(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.f),[]),"./fr/languages.json":()=>k(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.l),[]),"./fr/translation.json":()=>k(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.a),[]),"./it/collections.json":()=>k(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.c),[]),"./it/files.json":()=>k(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.f),[]),"./it/languages.json":()=>k(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.l),[]),"./it/translation.json":()=>k(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.t),[]),"./ja/collections.json":()=>k(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.c),[]),"./ja/files.json":()=>k(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.f),[]),"./ja/icons.json":()=>k(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.i),[]),"./ja/languages.json":()=>k(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.l),[]),"./ja/translation.json":()=>k(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.t),[]),"./ko/collections.json":()=>k(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.c),[]),"./ko/files.json":()=>k(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.f),[]),"./ko/languages.json":()=>k(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.l),[]),"./ko/translation.json":()=>k(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.t),[]),"./zh-Hans/collections.json":()=>k(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.c),[]),"./zh-Hans/files.json":()=>k(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.f),[]),"./zh-Hans/languages.json":()=>k(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.l),[]),"./zh-Hans/translation.json":()=>k(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.t),[]),"./zh-Hant/collections.json":()=>k(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.a),[]),"./zh-Hant/files.json":()=>k(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.b),[]),"./zh-Hant/languages.json":()=>k(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.d),[]),"./zh-Hant/translation.json":()=>k(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.e),[])}),`./${t}/${n}.json`,3))).init({partialBundledLanguages:!0,fallbackLng:"en",ns:["translation","collections","languages","files","icons"],resources:{en:{translation:Ie,collections:Te,languages:Me,files:Ne,icons:Re},"en-GB":{translation:Ae}}}).catch(t=>{console.error(t)});function ne(t,n=4){let e=0;for(let o=0;o<t.length;o++)e+=t.charCodeAt(o)>255?1:.5;return e<=n?void 0:{fontSize:`${n*100/e}%`,scale:`1 ${e/n}`,whiteSpace:"nowrap"}}function ct(t,n){if(n.length===0)return new Set(t.collections);const e=new Set,o=new Set(n);for(const a of t.collections)t.getCollection(a).languages.some(c=>o.has(c))&&e.add(a);return e}function it(t,n){if(n.length===0)return new Set(t.languages);const e=new Set;for(const o of n)for(const a of t.getCollection(o).languages)e.add(a);return e}function lt({corpus:t,collections:n,languages:e,setCollections:o}){const{t:a}=$(),c=["ja","ko","zh"].some(r=>G.language.startsWith(r)),l=ct(t,e);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"search-collections",children:t.collections.map(r=>[r,a(`collections:${r}.name`),a(`collections:${r}.short`)]).map(([r,f,d])=>s.jsxs("div",{className:`search-collection search-${l.has(r)?"valid":"invalid"}`,children:[s.jsx("input",{type:"checkbox",name:`collection-${r}`,id:`collection-${r}`,checked:n.includes(r),onChange:v=>{v.target.checked&&!n.includes(r)?o(n.concat([r])):!v.target.checked&&n.includes(r)&&o(n.filter(g=>g!==r))}}),s.jsx("label",{htmlFor:`collection-${r}`,style:c?ne(d):void 0,children:f===d?f:s.jsx("abbr",{title:f,children:s.jsx("span",{translate:"no",children:d})})})]},r))}),s.jsxs("div",{className:"item-group",children:[s.jsx("button",{disabled:n.length===t.collections.length,onClick:()=>{o(t.collections)},children:a("selectAll")}),s.jsx("button",{disabled:n.length===0,onClick:()=>{o([])},children:a("deselectAll")})]})]})}function ut({corpus:t,collections:n,languages:e,setLanguages:o}){const{t:a}=$(),c=["ja","ko","zh"].some(r=>G.language.startsWith(r)),l=it(t,n);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"search-languages",children:t.languages.map(r=>[r,a(`languages:${r}.name`),a(`languages:${r}.code`)]).map(([r,f,d])=>s.jsxs("div",{className:`search-language search-${l.has(r)?"valid":"invalid"}`,children:[s.jsx("input",{type:"checkbox",name:`language-${r}`,id:`language-${r}`,checked:e.includes(r),onChange:v=>{v.target.checked&&!e.includes(r)?o(e.concat([r])):!v.target.checked&&e.includes(r)&&o(e.filter(g=>g!==r))}}),s.jsxs("label",{htmlFor:`language-${r}`,children:[s.jsx("span",{className:"search-language-code",children:s.jsx("abbr",{title:f,children:s.jsx("span",{translate:"no",children:d})})}),s.jsx("span",{className:"search-language-name",style:c?ne(f,12):ne(f,15),children:f})]})]},r))}),s.jsxs("div",{className:"item-group",children:[s.jsx("button",{disabled:e.length===t.languages.length,onClick:()=>{o(t.languages)},children:a("selectAll")}),s.jsx("button",{disabled:e.length===0,onClick:()=>{o([])},children:a("deselectAll")})]})]})}function dt({corpus:t,filtersVisible:n,collections:e,setCollections:o,languages:a,setLanguages:c}){const l=h.useRef(null),r=()=>l.current?.style.setProperty("--search-filters-height",`${l.current.scrollHeight}px`);return h.useEffect(()=>{if(!CSS.supports("interpolate-size","allow-keywords"))return r(),window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[]),s.jsx("div",{ref:l,className:`search-filters search-filters-${n?"show":"hide"}`,children:s.jsxs(s.Fragment,{children:[s.jsx(lt,{corpus:t,collections:e,languages:a,setCollections:o}),s.jsx("div",{className:"search-filters-divider"}),s.jsx(ut,{corpus:t,collections:e,languages:a,setLanguages:c})]})})}const le=t=>Array.isArray(t)&&t.every(n=>typeof n=="string"),ht=t=>{const n=t.languages.filter(c=>c.startsWith(G.language.split("-")[0])),e={...Ye(t),languages:n.length===0?t.languages.filter(c=>c.startsWith("en")):n},o=H("corpus-params");if(o===null)return e;const a=fe(o);return typeof a=="object"&&a!==null&&("query"in a&&typeof a.query=="string"&&(e.query=a.query),"type"in a&&oe(a.type)&&(e.type=a.type),"caseInsensitive"in a&&typeof a.caseInsensitive=="boolean"&&(e.caseInsensitive=a.caseInsensitive),"common"in a&&typeof a.common=="boolean"&&(e.common=a.common),"script"in a&&typeof a.script=="boolean"&&(e.script=a.script),"showAllLanguages"in a&&typeof a.showAllLanguages=="boolean"&&(e.showAllLanguages=a.showAllLanguages),"collections"in a&&le(a.collections)&&a.collections.every(c=>t.isCollectionKey(c))&&(e.collections=a.collections),"languages"in a&&le(a.languages)&&a.languages.every(c=>t.isLanguageKey(c))&&(e.languages=a.languages)),e},gt=[J[3],J[0],J[1],J[2]];function mt({corpus:t,waiting:n,inProgress:e,postToWorker:o,terminateWorker:a}){const{t:c}=$(),l=h.useMemo(()=>ht(t),[t]),[r,f]=h.useState(l.query),[d,v]=h.useState(l.type),[g,C]=h.useState(l.caseInsensitive),[A,E]=h.useState(l.common),[R,q]=h.useState(l.script),[I,M]=h.useState(l.showAllLanguages),[D,B]=h.useState(l.collections),[T,p]=h.useState(l.languages),[b,j]=h.useState((H("corpus-filtersVisible")??(window.location.hash?"false":"true"))!=="false"),w=h.useMemo(()=>ve(t),[t]),_=h.useCallback(()=>{const m=w.hashToSearchParams(window.location.hash.substring(1));if(m.query!==void 0&&f(m.query),m.type!==void 0&&v(m.type),m.caseInsensitive!==void 0&&C(m.caseInsensitive),m.common!==void 0&&E(m.common),m.script!==void 0&&q(m.script),m.showAllLanguages!==void 0&&M(m.showAllLanguages),m.collections!==void 0&&B(m.collections),m.languages!==void 0&&p(m.languages),m.id!==void 0&&m.id!==""){const F=m.id.split(".")[0];o({query:`^${ce(m.id)}$`,type:"regex",caseInsensitive:!1,common:!0,script:!0,showAllLanguages:!0,collections:t.collections.filter(U=>t.getCollection(U).id===F),languages:[Z]});return}if(m.file!==void 0&&m.file!==""){const F=m.file.split(".")[0];o({query:`^${ce(m.file)}\\..*$`,type:"regex",caseInsensitive:!1,common:!0,script:!0,showAllLanguages:!0,collections:t.collections.filter(U=>t.getCollection(U).id===F),languages:[Z]});return}if(m.run!==void 0&&m.run){const F={query:m.query??l.query,type:m.type??l.type,caseInsensitive:m.caseInsensitive??l.caseInsensitive,common:m.common??l.common,script:m.script??l.script,showAllLanguages:m.showAllLanguages??l.showAllLanguages,collections:m.collections??l.collections,languages:m.languages??l.languages};window.location.hash=w.searchParamsToHash(F),o(F);return}H("corpus-filtersVisible")===null&&j(!m.query||!m.collections||!m.languages)},[o,l]);h.useEffect(()=>(window.location.hash&&_(),window.addEventListener("hashchange",_),()=>{window.removeEventListener("hashchange",_)}),[_]),h.useEffect(()=>{K("corpus-params",JSON.stringify({query:r,type:d,caseInsensitive:g,common:A,script:R,showAllLanguages:I,collections:D,languages:T}))},[r,d,g,A,R,I,D,T]);const L=m=>{m.preventDefault(),H("corpus-filtersVisible")||K("corpus-filtersVisible",b.toString());const F=document.getElementsByClassName("view-search").item(0);F&&F.scrollHeight>document.body.clientHeight&&j(!1);const U={query:r,type:d,caseInsensitive:g,common:A,script:R,showAllLanguages:I,collections:D,languages:T};window.location.hash=w.searchParamsToHash(U),o(U)},V=()=>{a()},y=()=>{const m=!b;j(m),K("corpus-filtersVisible",m.toString())},S=m=>{const F=m.target.value;oe(F)&&v(F)},N=n||e||r.length===0||D.length===0||T.length===0,z=h.useMemo(()=>s.jsx(dt,{corpus:t,filtersVisible:b,collections:D,setCollections:B,languages:T,setLanguages:p}),[b,D,T]);return s.jsxs("form",{className:"search-form",role:"search",onSubmit:L,children:[s.jsxs("div",{className:"search-bar",children:[s.jsxs("div",{className:"item-group",children:[s.jsx("label",{htmlFor:"query",children:c("query")}),s.jsx("input",{type:"search",name:"query",id:"query",value:r,onChange:m=>{f(m.target.value)}}),s.jsxs("div",{className:"btn-alternate-container",children:[s.jsx("input",{id:"submit",type:"submit",className:e?"invisible":"visible",value:c("search"),disabled:N}),s.jsx("button",{type:"button",className:e?"visible":"invisible",onClick:V,disabled:!e,children:c("cancel")})]}),s.jsx("button",{type:"button",className:b?"active":void 0,onClick:y,children:c("filters")}),s.jsx("select",{name:"type",id:"type",onChange:S,value:d,title:c("searchType.searchType"),"aria-label":c("searchType.searchType"),children:gt.map(m=>s.jsx("option",{value:m,children:c(`searchType.${m}`)},m))})]}),s.jsxs("div",{className:"item-group search-option-group",children:[s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"caseInsensitive",id:"caseInsensitive",checked:g,onChange:m=>{C(m.target.checked)}}),s.jsx("label",{htmlFor:"caseInsensitive",children:c("caseInsensitive")})]}),s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"common",id:"common",checked:A,onChange:m=>{E(m.target.checked)}}),s.jsx("label",{htmlFor:"common",children:c("common")})]}),s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"script",id:"script",checked:R,onChange:m=>{q(m.target.checked)}}),s.jsx("label",{htmlFor:"script",children:c("script")})]}),s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"showAllLanguages",id:"showAllLanguages",checked:I,onChange:m=>{M(m.target.checked)}}),s.jsx("label",{htmlFor:"showAllLanguages",children:c("showAllLanguages")})]})]})]}),z]})}function ft({src:t,active:n=!0}){const e=h.useRef(null);h.useEffect(()=>{e.current?.classList.add("spinner-stopped")},[]),h.useEffect(()=>{const a=e.current;if(a!==null){const c=()=>{n||a.classList.add("spinner-stopped")};return a.addEventListener("animationiteration",c),()=>{a.removeEventListener("animationiteration",c)}}},[n]);const o=["spinner",n?"spinner-active":"spinner-inactive"];return s.jsx("img",{ref:e,className:o.join(" "),src:t,alt:""})}function we({progress:t}){const{t:n}=$(),e=Math.min(Math.max(0,t*100),100);return s.jsxs("div",{className:"progress-bar-container",role:"progressbar","aria-label":n("progressBar.title"),"aria-valuenow":e,children:[s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-bar-complete",style:{width:`${e}%`,maxWidth:e===0?0:void 0,visibility:e===0?"hidden":void 0}})}),s.jsx("div",{className:"progress-bar-text",children:n("progressBar.value",Ue(t))})]})}const pt=t=>{if("share"in navigator){const n=t.currentTarget.href;t.preventDefault(),navigator.share({url:n}).catch(e=>{e instanceof Error&&e.name!=="AbortError"||(console.error(e),window.open(n,"_blank"))})}};function jt({hash:t}){const{t:n}=$();return s.jsx("a",{href:t,rel:"bookmark noreferrer",target:"_blank",title:n("share"),onClick:pt,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#share"})})})}function xt({hash:t,callback:n}){const{t:e}=$();return s.jsx("a",{href:t,rel:"bookmark noreferrer",title:e("viewNearby"),onClick:n,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#file-lines"})})})}function vt({callback:t}){const{t:n}=$();return s.jsx("button",{className:"link",title:n("copy"),onClick:t,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#copy"})})})}function bt(t,n,e,o,a){return t.replaceAll(/<a class="speaker" data-var="(.+?)">(.+?)<\/a>/gu,(c,l,r)=>`<a class="speaker" href="#${n.searchParamsToHash({query:l,type:"exact",caseInsensitive:!1,common:!1,script:!0,showAllLanguages:!1,collections:[e],languages:[o],run:!0})}" title="${a}" translate="yes"><span translate="no">${r}</span></a>`)}const wt=(t,n)=>n===Z?t.replaceAll(/([._/]|([a-z])(?=[A-Z])|([A-Za-z])(?=[0-9]))/gu,"$1<wbr>"):t;function yt(){const{t}=$();return s.jsx("div",{className:"results-rendering",children:t("status.rendering")})}function _t({id:t}){return s.jsx("td",{className:"results-table-actions-cell",translate:"yes",children:s.jsxs("div",{className:"results-table-actions",children:[s.jsx(jt,{hash:`#id=${t}`}),s.jsx(xt,{hash:`#file=${t.split(".").slice(0,-1).join(".")}`})]})},"actions")}function St({corpus:t,index:n,collection:e,file:o,languages:a,lines:c,start:l,end:r,showId:f,richText:d,sectionOffset:v,onShowSection:g,searchParamsFactory:C}){const{t:A}=$(),E=a.indexOf(Z),R=a.map(j=>j===Z?tt:j),q=A("viewSpeaker"),I=t.getCollection(e).speaker!==void 0,M=R.map(j=>G.dir(j)),D=M.every(j=>j===M[0]),B=h.useRef(null),T=()=>{const j=B.current,w=window.getSelection();w!==null&&j!==null&&(w.removeAllRanges(),w.selectAllChildren(j),document.execCommand("copy"),w.removeAllRanges())},p=["results-table",`collection-${t.getCollection(e).id??e.toLowerCase()}`,`file-${o}`,`rich-text-${d?"enabled":"disabled"}`];t.getCollection(e).softWrap===!0&&p.push("soft");const b=s.jsx("div",{className:"results-table-container",children:s.jsxs("table",{ref:B,className:p.join(" "),children:[s.jsx("thead",{children:s.jsxs("tr",{children:[E!==-1&&s.jsx("th",{className:"results-table-actions-cell",children:s.jsx(vt,{callback:T})}),a.filter(j=>f||j!==Z).map(j=>s.jsx("th",{children:s.jsx("abbr",{title:A(`languages:${j}.name`),children:s.jsx("span",{translate:"no",children:A(`languages:${j}.code`)})})},j))]})}),s.jsx("tbody",{dir:D&&M[0]!==G.dir()?M[0]:void 0,translate:"no",children:c.map((j,w)=>l<=w&&w<r&&s.jsxs("tr",{"data-id":E!==-1?j[E]:void 0,children:[E!==-1&&s.jsx(_t,{id:j[E]}),j.map((_,L)=>{if(f||a[L]!==Z)return s.jsx("td",{lang:R[L],dir:D?void 0:M[L],dangerouslySetInnerHTML:{__html:wt(I?bt(_,C,e,a[L],q):_,a[L])}},L)})]},w))})]})});return s.jsxs(s.Fragment,{children:[l!==0&&s.jsx("button",{className:"results-notice",onClick:g(v,n),children:A("tablePartial",{count:l})}),l!==r&&b,r<c.length&&s.jsx("button",{className:"results-notice",onClick:g(v+r,n),children:A("tablePartial",{count:c.length-r})})]})}function Ct(t){const{index:n,status:e,header:o,offset:a,limit:c,lines:l,sectionOffset:r,richText:f}=t,d=Math.max(0,Math.min(l.length,a-r)),v=Math.max(0,Math.min(l.length,a+c-r)),g=h.useMemo(()=>{switch(e){case"noLines":return;case"worker":return s.jsx(yt,{});case"done":return s.jsx(St,{...t,start:d,end:v})}},[e,d,v,f]);return g&&s.jsxs("section",{id:`results-section${n}`,className:"results-section",children:[o&&s.jsx("h2",{children:o}),g]})}function Lt({results:t,headers:n,jumpTo:e,...o}){const a=h.useMemo(()=>ve(o.corpus),[o.corpus]),c=h.useMemo(()=>{let l=0;const r=[];for(const[f,d]of t.entries()){if(d.status==="initial")break;const v=d.status==="done"&&d.richText;r.push({...o,...d.params,index:f,sectionOffset:l,richText:v,status:d.status,header:n[f],searchParamsFactory:a}),l+=d.params.lines.length}return r},[t,o]);return h.useEffect(()=>{let l=0;for(const[r,f]of t.entries())if(f.status!=="initial"){if(o.offset>=l&&o.offset<l+f.params.lines.length){e(r);break}l+=f.params.lines.length}},[o.offset]),s.jsx("div",{className:"app-window-inner",children:c.map(l=>s.jsx(Ct,{...l},l.index))})}function ee(t){const n=document.getElementById("results"),e=document.getElementById(`results-section${t}`),o=n?.firstElementChild;n&&e&&o instanceof HTMLElement&&(n.scrollTop=e.offsetTop-o.offsetTop)}function Et({headers:t}){const{t:n}=$();return s.jsx("nav",{className:"results-jump",children:s.jsxs("select",{name:"jump",id:"jump",onChange:e=>{ee(Number(e.target.value))},value:"",children:[s.jsx("option",{value:"",disabled:!0,children:n("jumpTo")}),t.map((e,o)=>e!==void 0&&(o===0||t[o-1]!==e)&&s.jsx("option",{value:o,children:e},o))]})})}function kt({count:t,offset:n,limit:e,setOffset:o}){const{t:a}=$();return s.jsxs("div",{className:"results-nav",children:[s.jsxs("div",{children:[s.jsx("span",{className:"results-nav-range-long",children:a("displayedRange.long",{count:t,start:n+1,end:Math.min(t,n+e)})}),s.jsx("span",{className:"results-nav-range-short",children:a("displayedRange.short",{count:t,start:n+1,end:Math.min(t,n+e)})})]}),s.jsx("button",{className:"button-square",disabled:n===0,onClick:()=>{o(Math.max(0,n-e))},title:a("loadPrev"),children:a("icons:loadPrev",{limit:e})}),s.jsx("button",{className:"button-square",disabled:n+e>=t,onClick:()=>{o(Math.min(Math.floor(t/e)*e,n+e))},title:a("loadNext"),children:a("icons:loadNext",{limit:e})})]})}const ue={showVariables:0,showAllCharacters:!1,showGender:2,showPlural:0,showGrammar:!0,showFurigana:!0},Pt=()=>{const t=H("corpus-toggle");if(t===null)return ue;const n={...ue},e=fe(t);return typeof e=="object"&&e!==null&&("showVariables"in e&&typeof e.showVariables=="number"&&[0,1,2].includes(e.showVariables)&&(n.showVariables=e.showVariables),"showAllCharacters"in e&&typeof e.showAllCharacters=="boolean"&&(n.showAllCharacters=e.showAllCharacters),"showGender"in e&&typeof e.showGender=="number"&&[0,1,2].includes(e.showGender)&&(n.showGender=e.showGender),"showPlural"in e&&typeof e.showPlural=="number"&&[0,1,2].includes(e.showPlural)&&(n.showPlural=e.showPlural),"showGrammar"in e&&typeof e.showGrammar=="boolean"&&(n.showGrammar=e.showGrammar),"showFurigana"in e&&typeof e.showFurigana=="boolean"&&(n.showFurigana=e.showFurigana)),n};function At({corpus:t,status:n,progress:e,results:o,showId:a=!0,richText:c=!0,limit:l=se}){const{t:r}=$(),f=h.useMemo(Pt,[]),[d,v]=h.useState(f.showVariables),[g,C]=h.useState(f.showAllCharacters),[A,E]=h.useState(f.showGender),[R,q]=h.useState(f.showPlural),[I,M]=h.useState(f.showGrammar),[D,B]=h.useState(f.showFurigana),[T,p]=h.useState(null),[b,j]=h.useState(0);h.useEffect(()=>{K("corpus-toggle",JSON.stringify({showVariables:d,showAllCharacters:g,showGender:A,showPlural:R,showGrammar:I,showFurigana:D}))},[d,g,A,R,I,D]);const w=h.useCallback((m,F)=>()=>{j(m),ee(F)},[]),_=h.useMemo(()=>{const m=[];let F="";for(const U of o){if(U.status==="initial"||U.status==="noLines"){m.push(void 0);continue}const{collection:X,file:i}=U.params,u=r("tableHeader",{collection:r(`collections:${X}.name`),file:r(`files:${i}`),interpolation:{escapeValue:!1}});m.push(u===F?void 0:u),F=u}return m},[o,G.language]),L=h.useMemo(()=>o.reduce((m,F)=>m+(F.status==="initial"?0:F.params.lines.length),0),[o]);L<b&&j(m=>Math.min(m,L));const V=s.jsxs("div",{className:"results-toggle",children:[s.jsx("button",{className:d!==2?"button-square active":"button-square",disabled:!c,onClick:()=>{v((d+1)%3)},title:r("showVariables"),children:s.jsx("span",{translate:"no",children:r("icons:showVariables",{context:d})})}),s.jsx("button",{className:g?"button-square active":"button-square",disabled:!c,onClick:()=>{C(!g)},title:r("showAllCharacters"),children:s.jsx("span",{translate:"no",children:r("icons:showAllCharacters")})}),s.jsx("button",{className:A!==2?"button-square active":"button-square",disabled:!c,onClick:()=>{E((A+1)%3)},title:r("showGender"),children:s.jsx("span",{translate:"no",children:r("icons:showGender",{context:A})})}),s.jsx("button",{className:R!==0?"button-square active":"button-square",disabled:!c,onClick:()=>{q((R+1)%3)},title:r("showPlural"),children:s.jsx("span",{translate:"no",children:r("icons:showPlural",{context:R})})}),s.jsx("button",{className:I?"button-square active":"button-square",disabled:!c,onClick:()=>{M(!I)},title:r("showGrammar"),children:s.jsx("span",{translate:"no",children:r("icons:showGrammar")})}),s.jsx("button",{className:D?"button-square active":"button-square",disabled:!c,onClick:()=>{B(!D)},title:r("showFurigana"),children:s.jsx("span",{className:"results-toggle-furigana",translate:"no",children:r("icons:showFurigana")})})]});h.useEffect(()=>{h.startTransition(()=>{p(s.jsx(Lt,{corpus:t,results:o,headers:_,showId:a,offset:b,limit:l,onShowSection:w,jumpTo:ee}))})},[t,o,_,a,b,l,w,ee]);const y=je(n),S=r(`status.${n.split(".",1)[0]}`),N=h.useMemo(()=>!y&&_.filter(m=>m!==void 0).length>1?s.jsx(Et,{headers:_}):s.jsx("div",{className:"results-status-text",children:S}),[y,_]),z=`app-window variables-${["short","show","hide"][d]} control-${g?"show":"hide"} gender-${A} number-${R} grammar-${I?"show":"hide"} furigana-${D?"show":"hide"}`;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"results-status",children:[N,s.jsx(ft,{src:"logo.svg",active:y}),!y&&L>l?s.jsx(kt,{count:L,offset:b,limit:l,setOffset:j}):s.jsx(we,{progress:e}),V]}),s.jsx("main",{id:"results",className:z,children:T})]})}const Rt={status:"initial"},de="corpus-warn",Nt=2e7;function Mt({loader:t,showModal:n,richText:e,limit:o}){const{t:a}=$(),c=h.useRef(null),l=h.useRef(null),r=h.useRef([]),f=h.useRef(e),d=h.useRef(H(de)!=="false"),[v,g]=h.useState("initial"),[C,A]=h.useState(0),[E,R]=h.useState(!0),[q,I]=h.useState([]);h.useEffect(()=>{f.current=e;for(const{index:y,params:S}of r.current)B(y,S)},[e]);const M=(y,S)=>{I(N=>{const z=Array().concat(N);for(let m=z.length;m<y;m++)z[m]=Rt;return z[y]=S,z})},D=y=>{M(y.data.index,{status:"done",params:y.data,richText:y.data.richText}),y.data.error&&n({message:a("statusModal.error"),buttons:[{message:a("statusModal.buttons.ok"),autoFocus:!0}]})},B=(y,S)=>{l.current===null&&(console.log("Creating new TextWorker..."),l.current=new Je,l.current.addEventListener("message",D)),l.current.postMessage({...S,index:y,richText:f.current,corpusLiterals:t.corpus.getCollection(S.collection).literals})},T=y=>{if(g(y.data.status),A(y.data.progress),R(y.data.showId),"index"in y.data&&"result"in y.data){const{index:S,result:N}=y.data;y.data.result.lines.length===0?M(S,{status:"noLines",params:N}):(r.current.push({index:S,params:N}),M(S,{status:"worker",params:N}),B(S,N))}y.data.complete&&Qe(y.data.status)&&n({message:a(`statusModal.${y.data.status}`),buttons:[{message:a("statusModal.buttons.ok"),autoFocus:!0}]})},p=h.useCallback(()=>{console.log("Terminating workers!"),c.current!==null&&(c.current.removeEventListener("message",T),c.current.terminate(),c.current=null),l.current!==null&&(l.current.removeEventListener("message",T),l.current.terminate(),l.current=null),g("initial"),A(0),I([]),r.current=[]},[]),b=y=>{I([]),r.current=[],y.query.length>0&&y.collections.length>0&&y.languages.length>0&&(c.current===null&&(console.log("Creating new SearchWorkerManager..."),c.current=new Ke,c.current.addEventListener("message",T)),g("waiting"),A(0),c.current.postMessage({...y,serializedCorpus:be(t.corpus)}))},j=h.useCallback(y=>{if(!d.current){b(y);return}t.getDownloadSizeTotal().then(S=>{if(S<=Nt){b(y);return}n({message:a("searchModal.message",Q(S)),checkbox:{message:a("searchModal.checkboxDoNotShowAgain"),checked:!1},buttons:[{message:a("searchModal.buttons.yes"),callback:()=>{b(y)},checkboxCallback:N=>{d.current=!N,K(de,(!N).toString())}},{message:a("searchModal.buttons.no"),callback:()=>{g("initial")},autoFocus:!0}],cancelCallback:()=>{g("initial")}})}).catch(S=>{console.error(S)})},[]),w=je(v),_=v==="waiting",L=h.useMemo(()=>s.jsx(mt,{corpus:t.corpus,inProgress:w,waiting:_,postToWorker:j,terminateWorker:p}),[w,_,j,p]),V=h.useMemo(()=>s.jsx(At,{corpus:t.corpus,status:v,progress:C,showId:E,richText:e,results:q,limit:o}),[v,C,E,e,q,o]);return s.jsxs("div",{className:"search",children:[L,V]})}function Tt(t){return new Worker("/poke-corpus/assets/cacheManagerWorker-B0pULQdF.js",{name:t?.name})}function It({callback:t}){const{t:n}=$();return s.jsx("button",{className:"link",title:n("delete"),onClick:t,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#trash-can"})})})}function Ft({callback:t}){const{t:n}=$();return s.jsx("button",{className:"link",title:n("refresh"),onClick:t,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#arrows-rotate"})})})}function Dt({cacheStorageEnabled:t,cachedMetadata:n}){const{t:e}=$(),o=h.useMemo(()=>Q(n.reduce((a,[,c])=>a+c,0)),[n]);return s.jsxs("ul",{children:[s.jsx("li",{children:e("cache.storageStatus",{val:e(t?"cache.storageEnabled":"cache.storageDisabled")})}),t&&s.jsx("li",{children:e("cache.filesStored",{count:n.length})}),t&&s.jsx("li",{children:e("cache.storageUsed",o)})]})}function Ot({loadedBytes:t,totalBytes:n,progress:e}){const{t:o}=$();return s.jsxs("div",{className:"cache-entry-notice",children:[o("cache.loading",{message:o("cache.inProgress"),loaded:o("cache.size",Q(t)),total:o("cache.size",Q(n))}),s.jsx(we,{progress:e})]})}function Vt({corpus:t,cachedMetadata:n,cacheCollections:e,clearCachedFile:o}){const{t:a}=$(),c=h.useMemo(()=>t.collections.map(r=>{const f=n.filter(([[d]])=>r===d);return[r,f.reduce((d,[,v])=>d+v,0),f.every(([,,d])=>d)]}).filter(([,r])=>r>0),[n]);return s.jsx("div",{className:"cache-entry-list",children:n.length>0&&c.map(([l,r,f],d)=>s.jsxs("div",{className:`cache-entry cache-entry-${f?"current":"outdated"}`,children:[s.jsxs("div",{className:"cache-entry-text",children:[s.jsx("div",{children:s.jsx("abbr",{title:a(`collections:${l}.name`),children:s.jsx("span",{translate:"no",children:a(`collections:${l}.short`)})})}),s.jsx("div",{translate:"no",children:a("cache.size",Q(r))})]}),s.jsxs("div",{className:"cache-entry-actions",children:[!f&&s.jsx(Ft,{callback:()=>{e(l)}}),s.jsx(It,{callback:()=>{o(l)}})]})]},d))})}function $t({active:t,loader:n,showModal:e}){const{t:o}=$(),[a,c]=h.useTransition(),[l,r]=h.useState(!1),[f,d]=h.useState([]),[v,g]=h.useState(!1),[C,A]=h.useState(0),[E,R]=h.useState(0),[q,I]=h.useState(0),M=h.useRef(null),D=async()=>{r("caches"in window&&await window.caches.keys().then(()=>!0).catch(()=>!1))},B=S=>{const{status:N,loadedBytes:z,totalBytes:m,requestedCollection:F}=S.data;switch(A(z/m),R(z),I(m),N){case"loading":return;case"done":console.log("Caching complete");break;case"error":console.log("Caching error");break}M.current?.terminate(),M.current=null,g(!1),b(F)},T=h.useCallback(S=>{"caches"in window&&(g(!0),A(0),R(0),M.current===null&&(console.log("Creating new CacheManagerWorker..."),M.current=new Tt,M.current.addEventListener("message",B),M.current.postMessage({serializedCorpus:be(n.corpus),requestedCollection:S})))},[]),p=async(S="background")=>{if("caches"in window&&"indexedDB"in window&&"databases"in window.indexedDB){const[N,z]=await Promise.all([n.getCache(),n.getIndexedDB()]),m=n.corpus.entries.flatMap(([u,x])=>x.files.flatMap(P=>x.languages.map(O=>[u,O,P]))),F=m.map(([u,x,P])=>n.getFilePath(u,x,P)),U=await Promise.all(F.map(u=>n.getFileCacheOnly(N,z,u).then(async([x,P])=>[x!==void 0?(await x.blob()).size:-1,P])));d(U.map(([u,x],P)=>[m[P],u,x]).filter(([,u])=>u!==-1));const X=new Set(F),i=(await n.getAllLocalFilePaths()).filter(u=>!X.has(u));await Promise.all(i.flatMap(u=>n.deleteLocalMetadata(z,u).then(()=>N.delete(u)).then(()=>{console.debug(`Deleted ${u} from cache`)}))),z.close(),S==="cacheAll"&&U.some(([u,x])=>u===-1||!x)&&V()}},b=S=>{p(S).catch(N=>{console.error(N)})},j=()=>{const S=[];M.current&&(M.current.terminate(),M.current=null),"serviceWorker"in navigator&&S.push(navigator.serviceWorker.ready.then(N=>N.unregister())),"indexedDB"in window&&"databases"in window.indexedDB&&S.push(n.clearLocalMetadata().then(()=>p())),"caches"in window&&S.push(n.getCache().then(N=>N.keys().then(z=>Promise.all(z.map(m=>N.delete(m)))))),Promise.all(S).then(()=>{console.log("Cache cleared")}).catch(N=>{console.log("Error clearing cache"),console.error(N)})},w=async S=>{if("caches"in window&&"indexedDB"in window&&"databases"in window.indexedDB){const[N,z]=await Promise.all([n.getCache(),n.getIndexedDB()]);await Promise.all(n.corpus.getCollection(S).languages.flatMap(m=>n.corpus.getCollection(S).files.flatMap(F=>{const U=n.getFilePath(S,m,F);return[n.deleteLocalMetadata(z,U),N.delete(U)]}))),z.close(),await p()}},_=h.useCallback(S=>{w(S).catch(N=>{console.error(N)})},[]);h.useEffect(()=>{c(async()=>{await Promise.all([D(),p()])})},[]),h.useEffect(()=>{t&&c(async()=>{await Promise.all([D(),p()])})},[t]);const L=()=>{n.getDownloadSizeTotal().then(S=>{e({message:o("cache.cacheAllModal.message",Q(S)),buttons:[{message:o("cache.cacheAllModal.buttons.yes"),callback:()=>{T("cacheAll")}},{message:o("cache.cacheAllModal.buttons.no"),callback:()=>{g(!1)},autoFocus:!0}],cancelCallback:()=>{g(!1)}})}).catch(S=>{console.error(S)})},V=()=>{e({message:o("cache.cacheAllFailedModal.message"),buttons:[{message:o("cache.cacheAllFailedModal.buttons.ok"),autoFocus:!0}]})},y=()=>{e({message:o("cache.clearCacheModal.message"),buttons:[{message:o("cache.clearCacheModal.buttons.yes"),callback:j},{message:o("cache.clearCacheModal.buttons.no"),autoFocus:!0}]})};return t&&s.jsxs("div",{className:"cache",children:[s.jsxs("div",{className:"cache-button-group item-group",children:[s.jsx("button",{onClick:L,disabled:v!==!1,children:o("cacheAll")}),s.jsx("button",{onClick:y,children:o("clearCache")})]}),s.jsx("div",{className:"cache-results app-window",children:!a&&s.jsxs("div",{className:"app-window-inner",children:[s.jsx(Dt,{cacheStorageEnabled:l,cachedMetadata:f}),v?s.jsx(Ot,{loadedBytes:E,totalBytes:q,progress:C}):s.jsx(Vt,{corpus:n.corpus,cachedMetadata:f,cacheCollections:T,clearCachedFile:_})]})})]})}function qt({classes:t,message:n,buttons:e,checkbox:o,cancelCallback:a}){const[c,l]=h.useState(n!==void 0),[r,f]=h.useState(o?.checked??!1),d=h.useRef(null),v=h.useRef(null);h.useEffect(()=>{const E=d.current,R=v.current;if(E!==null)if(c){if(E.showModal(),e){const q=e.findIndex(I=>I.autoFocus);R!==null&&q!==-1&&Array.from(R.children).filter(I=>I instanceof HTMLButtonElement)[q].focus()}}else E.close()},[c]);const g=(E,R)=>()=>{l(!1),E&&E(),R&&R(r)},C=()=>{a&&a(),l(!1)};if(!c)return null;const A=["modal"];return t&&t.forEach(E=>A.push(E)),s.jsxs("dialog",{ref:d,id:"modal",className:A.join(" "),onCancel:C,children:[s.jsx("div",{className:"modal-message",children:n}),o&&s.jsx("div",{className:"modal-checkbox",children:s.jsxs("div",{children:[s.jsx("input",{type:"checkbox",id:"modalCheckbox",name:"modalCheckbox",checked:r,onChange:E=>{f(E.target.checked)}}),s.jsx("label",{htmlFor:"modalCheckbox",children:o.message})]})}),s.jsx("div",{ref:v,className:"modal-button-group",children:e?.map(({message:E,callback:R,checkboxCallback:q,autoFocus:I},M)=>s.jsx("button",{type:"button",onClick:g(R,q),autoFocus:I,children:E},M))})]})}function ye(){const{t}=$();return s.jsx("div",{className:"app-window",children:s.jsx("div",{className:"app-window-inner",children:s.jsxs("section",{className:"results-section",children:[s.jsx("h2",{children:t("error.title")}),s.jsx("div",{children:t("error.message")})]})})})}const Bt=t=>{const n=p=>g(p).size,e=async(p,b)=>{const[j,w]=await R(p,b);return w?.hash===j.hash?0:j.size},o=async(p=t.collections)=>{try{const b=await v(),j=(await Promise.all(p.flatMap(w=>t.getCollection(w).languages.flatMap(_=>t.getCollection(w).files.map(L=>e(b,Y(w,_,L))))))).reduce((w,_)=>w+_,0);return b.close(),j}catch{return p.flatMap(b=>t.getCollection(b).languages.flatMap(j=>t.getCollection(b).files.map(w=>n(Y(b,j,w))))).reduce((b,j)=>b+j,0)}},a=p=>"/poke-corpus/"+p,c=async(p,b,j)=>{const w=a(j),[_,L]=await R(b,j);if(L?.hash===_.hash||!navigator.onLine&&L?.hash!==void 0){const y=await B(p,w);if(y!==void 0)return y}const V=await fetch(w);return await T(p,w,V).then(async y=>{y&&await A(b,j)}),V},l=async(p,b,j)=>{const w=a(j),[_,L]=await R(b,j);return L!==void 0?[await B(p,w),L.hash===_.hash]:[void 0,!1]},r=p=>{const b=a(p);return fetch(b)},f="corpus",d="files",v=()=>{const p=indexedDB.open(f);return new Promise((b,j)=>{p.onupgradeneeded=()=>{p.result.createObjectStore(d),p.transaction!==null&&(p.transaction.oncomplete=()=>{console.log("Created object store")})},p.onsuccess=()=>{b(p.result)},p.onerror=()=>{j(p.error)}})},g=p=>t.metadata[p],C=(p,b)=>{const _=p.transaction([d],"readonly").objectStore(d).get(b);return new Promise((L,V)=>{_.onsuccess=()=>{L(st(_.result)?_.result:void 0)},_.onerror=()=>{V(_.error)}})},A=(p,b)=>{const _=p.transaction([d],"readwrite").objectStore(d).put(g(b),b);return new Promise((L,V)=>{_.onsuccess=()=>{L(_.result===b)},_.onerror=()=>{V(_.error)}})},E=(p,b)=>{const _=p.transaction([d],"readwrite").objectStore(d).delete(b);return new Promise((L,V)=>{_.onsuccess=()=>{L(!0)},_.onerror=()=>{V(_.error)}})},R=async(p,b)=>[g(b),await C(p,b)],q=()=>v().then(p=>{const w=p.transaction(["files"],"readwrite").objectStore("files").clear();return p.close(),new Promise((_,L)=>{w.onsuccess=()=>{_(!0)},w.onerror=()=>{L(w.error)}})}),I=()=>v().then(p=>{const w=p.transaction([d],"readonly").objectStore(d).getAllKeys();return p.close(),new Promise((_,L)=>{w.onsuccess=()=>{_(w.result.filter(V=>typeof V=="string"))},w.onerror=()=>{L(w.error)}})}),M="corpus",D=async()=>await caches.open(M),B=async(p,b)=>{try{return await p.match(b)}catch(j){console.error(j);return}},T=async(p,b,j)=>{try{return await p.put(b,j.clone()),!0}catch(w){return console.error(w),!1}};return{corpus:t,getFilePath:Y,getFileSize:n,getDownloadSizeTotal:o,getFile:c,getFileCacheOnly:l,getFileRemote:r,getIndexedDB:v,deleteLocalMetadata:E,clearLocalMetadata:q,getAllLocalFilePaths:I,getCache:D}};async function zt(){const t=await ot();return Bt(t)}const _e="Search";function Ut({showModal:t,richText:n,setRichText:e,limit:o,setLimit:a,setView:c,setAppKey:l}){const{t:r}=$(),f=d=>{window.location.hash="",Ve("corpus-params"),c(_e),l(v=>v+1&255),d.preventDefault()};return s.jsxs("header",{className:"header",children:[s.jsx("h1",{children:s.jsxs("a",{href:"/poke-corpus/",onClick:f,children:[s.jsx("img",{className:"header-logo",src:"logo.svg",alt:"",height:"40",width:"40"})," ",r("title",{version:r("version")})]})}),s.jsx(ae,{fallback:null,children:s.jsx(Ge,{showModal:t,richText:n,setRichText:e,limit:o,setLimit:a})})]})}function Wt({view:t,switchView:n}){const{t:e}=$();return s.jsxs("footer",{children:[s.jsx("span",{children:e("tagline")}),s.jsx("span",{className:"separator",translate:"no",children:" | "}),s.jsx("span",{children:e("footerText")}),s.jsx("span",{className:"separator",translate:"no",children:" | "}),s.jsx("span",{children:s.jsx("button",{className:"link",onClick:n,children:e(t!=="Search"?"backToSearch":"manageCache")})}),s.jsx("span",{className:"separator",translate:"no",children:" | "}),s.jsx("span",{children:s.jsx("a",{href:"https://github.com/abcboy101/poke-corpus",children:e("github")})})]})}function Ht(){const[t,n]=h.useState(ze),[e,o]=h.useState(Be),[a,c]=h.useState(_e),[l,r]=h.useState(0),[f,d]=h.useState(0),[v,g]=h.useState(null),[C,A]=h.useState(!1),[E,R]=h.useState(null);h.useEffect(()=>{const B=me();document.body.classList.add(`mode-${B}`),A(!0),zt().then(T=>{R(T)}).catch(T=>{console.error(T)})},[]);const q=h.useCallback(B=>{g(B),d(T=>T+1&255)},[]),I=h.useCallback(()=>{c(B=>{const T=B!=="Search"?"Search":"CacheManager";return C||A(T==="CacheManager"),T})},[]);if(E===null)return;const M=C&&s.jsx($t,{active:a==="CacheManager",loader:E,showModal:q}),D=["app",`view-${a.toLowerCase()}`];return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&D.push("ua-safari"),s.jsxs("div",{className:D.join(" "),lang:G.language,dir:G.dir(),children:[s.jsx(Ut,{showModal:q,richText:t,setRichText:n,limit:e,setLimit:o,setView:c,setAppKey:r}),s.jsxs(ae,{FallbackComponent:ye,children:[s.jsx(Mt,{loader:E,showModal:q,richText:t,limit:e}),M]}),s.jsx(Wt,{view:a,switchView:I}),s.jsx(qt,{...v},f)]},l)}function Gt(){return s.jsx("div",{className:"app",children:s.jsx(ye,{})})}const Kt=Pe.createRoot(document.getElementById("root"));Kt.render(s.jsx(ke.StrictMode,{children:s.jsx(ae,{FallbackComponent:Gt,children:s.jsx(Ht,{})})}));Oe({onOfflineReady(){console.log("Ready to work offline!")}});
