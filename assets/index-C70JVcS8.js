import{u as q,r as d,j as s,i as K,B as ke,a as Pe,b as Ae,E as re,R as Re}from"./vendor-XPNbIhcT.js";import{R as Ne}from"./react-dom-BYbQ8dEu.js";import{t as Me,i as Te,f as Ie,l as Fe,c as De,a as Oe}from"./i18n-en-84MEhzKe.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=e(a);fetch(a.href,i)}})();const Ve="modulepreload",$e=function(t){return"/poke-corpus/"+t},le={},E=function(n,e,o){let a=Promise.resolve();if(e&&e.length>0){let l=function(h){return Promise.all(h.map(w=>Promise.resolve(w).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),p=r?.nonce||r?.getAttribute("nonce");a=l(e.map(h=>{if(h=$e(h),h in le)return;le[h]=!0;const w=h.endsWith(".css"),g=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${g}`))return;const S=document.createElement("link");if(S.rel=w?"stylesheet":Ve,w||(S.as="script"),S.crossOrigin="",S.href=h,p&&S.setAttribute("nonce",p),document.head.appendChild(S),w)return new Promise((P,C)=>{S.addEventListener("load",P),S.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${h}`)))})}))}function i(l){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=l,window.dispatchEvent(r),!r.defaultPrevented)throw l}return a.then(l=>{for(const r of l||[])r.status==="rejected"&&i(r.reason);return n().catch(i)})};function qe(t={}){const{immediate:n=!1,onNeedRefresh:e,onOfflineReady:o,onRegistered:a,onRegisteredSW:i,onRegisterError:l}=t;let r,p;const h=async(g=!0)=>{await p};async function w(){if("serviceWorker"in navigator){if(r=await E(async()=>{const{Workbox:g}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:g}},[]).then(({Workbox:g})=>new g("/poke-corpus/sw.js",{scope:"/poke-corpus/",type:"classic"})).catch(g=>{l?.(g)}),!r)return;r.addEventListener("activated",g=>{(g.isUpdate||g.isExternal)&&window.location.reload()}),r.addEventListener("installed",g=>{g.isUpdate||o?.()}),r.register({immediate:n}).then(g=>{i?i("/poke-corpus/sw.js",g):a?.(g)}).catch(g=>{l?.(g)})}}return p=w(),h}const ue=t=>t.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&");function G(t){try{return localStorage.getItem(t)}catch{return null}}function J(t,n){try{localStorage.setItem(t,n)}catch{return}}function Be(t){try{localStorage.removeItem(t)}catch{return}}const pe=["system","light","dark"],je=t=>pe.some(n=>t===n),ze=t=>typeof t=="string"&&je(t)?t:"system",ve=()=>ze(G("mode")),ne=500,Ue=t=>!Number.isNaN(t)&&Number.isInteger(t)&&t>0,We=()=>{const t=+(G("corpus-limit")??ne);return Number.isNaN(t)?ne:t},He=()=>G("corpus-richText")!=="false",de=["byte","kilobyte","megabyte","gigabyte","terabyte","petabyte"];function X(t){const n=Math.min(Math.floor((t.toString().length-1)/3),de.length-1),e={style:"unit",unit:de[n],unitDisplay:n===0?"long":"short",minimumFractionDigits:n===0?0:1,maximumFractionDigits:1,maximumSignificantDigits:3,roundingPriority:"lessPrecision"};return{amount:t/Math.pow(1e3,n),formatParams:{amount:e}}}function Ge(t,n=1){return{amount:t,formatParams:{amount:{style:"percent",minimumFractionDigits:n,maximumFractionDigits:n}}}}function xe(t){try{return JSON.parse(t)}catch(n){return console.error(n),null}}const Ke=[{code:"en",name:"English (United States)"},{code:"en-GB",name:"English (United Kingdom)"},{code:"ja",name:"日本語"},{code:"de",name:"Deutsch"},{code:"fr",name:"Français (France)"},{code:"fr-CA",name:"Français (Canada)"},{code:"es",name:"Español (España)"},{code:"it",name:"Italiano"},{code:"ko",name:"한국어"},{code:"zh-Hans",name:"简体中文"},{code:"zh-Hant",name:"繁体中文"}];function Je({showModal:t,richText:n,richTextRef:e,limit:o,limitRef:a}){const{t:i}=q(),[l,r]=d.useState(ve),p=g=>{K.changeLanguage(g.target.value,S=>{S?.some(P=>!P.message.includes("Unknown variable dynamic import"))&&(console.error(S),t({message:i("options.network"),buttons:[{message:s.jsx(we,{}),autoFocus:!0}]}))}).catch(S=>{console.error(S)})},h=g=>{const S=g.target.value;je(S)&&(r(S),J("mode",S),document.body.classList.replace(`mode-${l}`,`mode-${S}`))},w=g=>{const S=g.target.value;(S==="true"||S==="false")&&J("corpus-longURL",S)};return s.jsx("div",{className:"options",children:s.jsxs("div",{className:"options-grid",children:[s.jsx("label",{htmlFor:"language",children:i("options.language")}),s.jsx("select",{name:"language",id:"language",onChange:p,defaultValue:K.language,autoFocus:!0,translate:"no",children:Ke.map(g=>s.jsx("option",{value:g.code,lang:g.code,children:g.name},g.code))}),s.jsx("label",{htmlFor:"mode",children:i("options.mode")}),s.jsx("select",{name:"mode",id:"mode",onChange:h,defaultValue:l,children:pe.map(g=>s.jsx("option",{value:g,children:i(`options.modes.${g}`)},g))}),s.jsx("label",{htmlFor:"longURL",children:i("options.longURL")}),s.jsx("select",{name:"longURL",id:"longURL",onChange:w,defaultValue:G("corpus-longURL")??"false",children:["true","false"].map(g=>s.jsx("option",{value:g,children:i(`options.longURLSelect.${g}`)},g))}),s.jsx("label",{htmlFor:"richText",children:i("options.richText")}),s.jsx("select",{ref:e,name:"richText",id:"richText",defaultValue:n?"true":"false",children:["true","false"].map(g=>s.jsx("option",{value:g,children:i(`options.richTextSelect.${g}`)},g))}),s.jsx("label",{htmlFor:"limit",children:i("options.limit")}),s.jsx("input",{ref:a,type:"number",name:"limit",id:"limit",min:1,defaultValue:o})]})})}function we(){const{t}=q();return t("options.close")}function Ze(t){const{t:n}=q(),{showModal:e,setRichText:o,setLimit:a}=t,i=d.useRef(null),l=d.useRef(null),r=()=>{if(i.current!==null){const h=i.current.value;(h==="true"||h==="false")&&(J("corpus-richText",h),o(h!=="false"))}if(l.current!==null){const h=l.current.valueAsNumber;Ue(h)&&(J("corpus-limit",h.toString()),a(h))}},p={classes:["modal-options"],message:s.jsx(Je,{...t,richTextRef:i,limitRef:l}),buttons:[{message:s.jsx(we,{}),callback:r}],cancelCallback:r};return s.jsxs("button",{className:"header-options",onClick:()=>{e(p)},children:[s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#gear"})}),n("options.options")]})}function Qe(t){return new Worker("/poke-corpus/assets/searchWorkerManager-DEZG9meu.js",{name:t?.name})}function Xe(t){return new Worker("/poke-corpus/assets/textWorker-Xwew4GOV.js",{name:t?.name})}const Ye=["error","regex","noMatch","network","boolean.parentheses","boolean.regex","boolean.slash","boolean.quote","boolean.operand","boolean.empty","boolean.where"],et=t=>Ye.some(n=>t===n),tt=["waiting","loading","processing","collecting"],be=t=>tt.some(n=>t===n),Z=["exact","regex","boolean","all"],ce=t=>Z.some(n=>t===n),ye={id:"",file:"",query:"",type:"all",caseInsensitive:!0,common:!0,script:!0,showAllLanguages:!0,run:!1},st=t=>({...ye,collections:t.collections.filter(n=>t.getCollection(n).structured),languages:t.languages}),nt=t=>{function n(c){const u={};return c.id!==void 0&&(u.id=c.id),c.file!==void 0&&(u.file=c.file),c.run!==void 0&&(u.run=c.run.toString()),new URLSearchParams({query:c.query,type:c.type,caseInsensitive:c.caseInsensitive.toString(),common:c.common.toString(),script:c.script.toString(),showAllLanguages:c.showAllLanguages.toString(),collections:c.collections.join(","),languages:c.languages.join(","),...u}).toString()}function e(c){const u=new URLSearchParams(c);return{id:o(u.get("id")),file:o(u.get("file")),query:o(u.get("query")),type:i(u.get("type")??(u.get("regex")==="true"?"regex":null),ce),caseInsensitive:a(u.get("caseInsensitive")),common:a(u.get("common")),script:a(u.get("script")),showAllLanguages:a(u.get("showAllLanguages")),collections:l(u.get("collections"),t.isCollectionKey),languages:l(u.get("languages"),t.isLanguageKey,r),run:a(u.get("run"))}}function o(c){return c??void 0}function a(c){switch(c){case"true":return!0;case"false":return!1}}function i(c,u){if(c!==null&&u(c))return c}function l(c,u,y=T=>T){if(c!==null)return c.split(",").map(y).filter(u)}function r(c){switch(c){case"qid-ZZ":case"ja-JP":case"en-US":case"fr-FR":case"it-IT":case"de-DE":case"es-ES":case"ko-KR":return c.split("-",1)[0];case"ja-Hrkt-JP":return"ja-Hrkt";case"zh-CN":return"zh-Hans";case"zh-TW":return"zh-Hant";default:return c}}const p=t.collections.length^t.languages.length<<4,h=2,w=Math.ceil(t.languages.length/8),g=Math.ceil(t.collections.length/8),S=w+g,P=64,C=Math.ceil(Math.log2(t.languages.length+t.collections.length)),R=h+S,I=c=>btoa(String.fromCodePoint(...c)).replaceAll("/","_").replaceAll("+","-").replace(/=+$/,""),N=c=>Uint8Array.from(atob(c.replaceAll("_","/").replaceAll("-","+")),u=>u.charCodeAt(0));function D(c){const u={};c.id!==void 0&&(u.id=c.id),c.file!==void 0&&(u.file=c.file);const y=f(c);return x(y),new URLSearchParams({...u,q:c.query,s:I(y)}).toString()}function F(c){const u=new URLSearchParams(c),y={id:o(u.get("id")),file:o(u.get("file")),query:o(u.get("q"))},T=o(u.get("s"));if(!T)return y;try{const $=N(T).subarray(0,R);return A($),{...y,...j($)}}catch{return y}}function f(c){const u=new Uint8Array(R);u[1]=+(c.run??ye.run)<<0|+c.caseInsensitive<<1|+c.common<<2|+c.script<<3|Z.indexOf(c.type)<<4|+!c.showAllLanguages<<7;const y=u.subarray(h);_(c,y),v(y,u.subarray(1,2));let T=u.length;for(;u[T-1]===0&&T>1;)T--;return u.subarray(0,T)}function j(c){const u=new Uint8Array(S);c[1]&P?b(c.subarray(h),u):u.set(c.subarray(h));const y=t.languages.filter(($,W)=>L(u,W)===1),T=t.collections.filter(($,W)=>L(u,8*w+W)===1);return{run:(c[1]&1)!==0,caseInsensitive:(c[1]&2)!==0,common:(c[1]&4)!==0,script:(c[1]&8)!==0,type:Z[(c[1]&48)>>4],showAllLanguages:(c[1]&128)===0,languages:y,collections:T}}function _(c,u){t.languages.forEach((y,T)=>{c.languages.includes(y)&&V(u,T)}),t.collections.forEach((y,T)=>{c.collections.includes(y)&&V(u,8*w+T)})}function b(c,u){const y=M(c);t.languages.forEach((T,$)=>{y.next().value&&V(u,$)}),t.collections.forEach((T,$)=>{y.next().value&&V(u,8*w+$)})}function v(c,u){const y=L(c,0)===1,T=k(c,y);let $=c.length;for(;c[$-1]===0;)$--;if(1+T.length*C<8*$){u[0]|=P,c.fill(0),y||V(c,0);let W=1;T.forEach(([Ee])=>{for(let se=0;se<C;W++,se++)V(c,W,Ee>>se&1)})}}function k(c,u){const y=[[0,u]];return t.languages.forEach((T,$)=>{const W=L(c,$)===1;y[y.length-1][1]===W?y[y.length-1][0]++:y.push([1,W])}),t.collections.forEach((T,$)=>{const W=L(c,8*w+$)===1;y[y.length-1][1]===W?y[y.length-1][0]++:y.push([1,W])}),y.pop(),y}function*M(c){const u=new Uint8Array(S);u.set(c);let y=L(u,0)!==1;for(let T=1;T+C<=u.length*8;){let $=0;for(let W=0;W<C;T++,W++)$|=L(u,T)<<W;if($===0)break;for(;$>0;)yield y,$--;y=!y}for(;;)yield y}function V(c,u,y=1){c[u>>3]|=y<<(u&7)}function L(c,u){return c[u>>3]>>(u&7)&1}function x(c){const u=c[0]=O(c);U(u,c)}function A(c){const u=c[0];if(U(u,c),u!==O(c))throw Error("invalid checksum")}function O(c,u=1){return c.subarray(u).reduce((y,T)=>y+T&255,0)^p&255}function U(c,u,y=1){let T=m(c);for(let $=y;$<u.length;$++)u[$]^=T>>24,T=B(T)}const m=c=>2480367069*c&4294967295,B=c=>2438952949*c+2654435769&4294967295;function H(c){return(G("corpus-longURL")==="true"?n:D)(c)}function z(c){const u=new URLSearchParams(c);return(u.get("q")||u.get("s")?F:e)(c)}return{_bytesBase64:R,_searchParamsToQueryString:n,_queryStringToSearchParams:e,_searchParamsToBase64:D,_base64ToSearchParams:F,_serializeByteArray:f,_deserializeByteArray:j,_encryptBytes:x,_decryptBytes:A,searchParamsToHash:H,hashToSearchParams:z}};function _e(t){return nt(t)}const Q="qid",at="zxx",ot=t=>t!==null&&typeof t=="object"&&"hash"in t&&typeof t.hash=="string"&&"size"in t&&typeof t.size=="number",rt=t=>{const n=Object.entries(t.corpus.collections);return Object.fromEntries(n.flatMap(([e,o])=>o.languages.flatMap(a=>o.files.map(i=>Y(e,a,i)))).map((e,o)=>[e,{hash:t.hashes[o],size:t.sizes[o]}]))},ct=t=>{const n=t.corpus,e=Object.keys(n.collections),o=Object.entries(n.collections),a=rt(t);return{_corpus:n,collections:e,languages:n.languages,entries:o,metadata:a,getCollection:i=>n.collections[i],isCollectionKey:i=>e.some(l=>i===l),isLanguageKey:i=>n.languages.some(l=>i===l)}},Y=(t,n,e)=>`corpus/${t}/${n}_${e}.txt.gz`;function Se(t){return{corpus:t._corpus,metadata:t.metadata}}const it=(t,n,e)=>{const o=t[n];return o?typeof o=="function"?o():Promise.resolve(o):new Promise((a,i)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(i.bind(null,new Error("Unknown variable dynamic import: "+n+(n.split("/").length!==e?". Note that variables only represent file names one level deep.":""))))})};K.use(ke).use(Pe).use(Ae((t,n)=>it(Object.assign({"./de/collections.json":()=>E(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.c),[]),"./de/files.json":()=>E(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.f),[]),"./de/languages.json":()=>E(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.l),[]),"./de/translation.json":()=>E(()=>import("./i18n-de-DvTfi3sT.js").then(e=>e.t),[]),"./en-GB/translation.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.j),[]),"./en/collections.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.d),[]),"./en/files.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.g),[]),"./en/icons.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.h),[]),"./en/languages.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.e),[]),"./en/translation.json":()=>E(()=>import("./i18n-en-84MEhzKe.js").then(e=>e.b),[]),"./es/collections.json":()=>E(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.c),[]),"./es/files.json":()=>E(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.f),[]),"./es/languages.json":()=>E(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.l),[]),"./es/translation.json":()=>E(()=>import("./i18n-es-DMw6BnNb.js").then(e=>e.t),[]),"./fr-CA/translation.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.t),[]),"./fr/collections.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.c),[]),"./fr/files.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.f),[]),"./fr/languages.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.l),[]),"./fr/translation.json":()=>E(()=>import("./i18n-fr-CCeUqura.js").then(e=>e.a),[]),"./it/collections.json":()=>E(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.c),[]),"./it/files.json":()=>E(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.f),[]),"./it/languages.json":()=>E(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.l),[]),"./it/translation.json":()=>E(()=>import("./i18n-it-C970Nh-w.js").then(e=>e.t),[]),"./ja/collections.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.c),[]),"./ja/files.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.f),[]),"./ja/icons.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.i),[]),"./ja/languages.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.l),[]),"./ja/translation.json":()=>E(()=>import("./i18n-ja-BwQ8-9Fx.js").then(e=>e.t),[]),"./ko/collections.json":()=>E(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.c),[]),"./ko/files.json":()=>E(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.f),[]),"./ko/languages.json":()=>E(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.l),[]),"./ko/translation.json":()=>E(()=>import("./i18n-ko-Dg8pId4h.js").then(e=>e.t),[]),"./zh-Hans/collections.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.c),[]),"./zh-Hans/files.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.f),[]),"./zh-Hans/languages.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.l),[]),"./zh-Hans/translation.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.t),[]),"./zh-Hant/collections.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.a),[]),"./zh-Hant/files.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.b),[]),"./zh-Hant/languages.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.d),[]),"./zh-Hant/translation.json":()=>E(()=>import("./i18n-zh-DRN2pXQa.js").then(e=>e.e),[])}),`./${t}/${n}.json`,3))).init({partialBundledLanguages:!0,fallbackLng:"en",ns:["translation","collections","languages","files","icons"],resources:{en:{translation:Oe,collections:De,languages:Fe,files:Ie,icons:Te},"en-GB":{translation:Me}}}).catch(t=>{console.error(t)});function ae(t,n=4){let e=0;for(let o=0;o<t.length;o++)e+=t.charCodeAt(o)>255?1:.5;return e<=n?void 0:{fontSize:`${n*100/e}%`,scale:`1 ${e/n}`,whiteSpace:"nowrap"}}function lt(t,n){if(n.length===0)return new Set(t.collections);const e=new Set,o=new Set(n);for(const a of t.collections)t.getCollection(a).languages.some(i=>o.has(i))&&e.add(a);return e}function ut(t,n){if(n.length===0)return new Set(t.languages);const e=new Set;for(const o of n)for(const a of t.getCollection(o).languages)e.add(a);return e}function dt({corpus:t,collections:n,languages:e,setCollections:o}){const{t:a}=q(),i=["ja","ko","zh"].some(r=>K.language.startsWith(r)),l=lt(t,e);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"search-collections",children:t.collections.map(r=>[r,a(`collections:${r}.name`),a(`collections:${r}.short`)]).map(([r,p,h])=>s.jsxs("div",{className:`search-collection search-${l.has(r)?"valid":"invalid"}`,children:[s.jsx("input",{type:"checkbox",name:`collection-${r}`,id:`collection-${r}`,checked:n.includes(r),onChange:w=>{w.target.checked&&!n.includes(r)?o(n.concat([r])):!w.target.checked&&n.includes(r)&&o(n.filter(g=>g!==r))}}),s.jsx("label",{htmlFor:`collection-${r}`,style:i?ae(h):void 0,children:p===h?p:s.jsx("abbr",{title:p,children:s.jsx("span",{translate:"no",children:h})})})]},r))}),s.jsxs("div",{className:"item-group",children:[s.jsx("button",{disabled:n.length===t.collections.length,onClick:()=>{o(t.collections)},children:a("selectAll")}),s.jsx("button",{disabled:n.length===0,onClick:()=>{o([])},children:a("deselectAll")})]})]})}function ht({corpus:t,collections:n,languages:e,setLanguages:o}){const{t:a}=q(),i=["ja","ko","zh"].some(r=>K.language.startsWith(r)),l=ut(t,n);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"search-languages",children:t.languages.map(r=>[r,a(`languages:${r}.name`),a(`languages:${r}.code`)]).map(([r,p,h])=>s.jsxs("div",{className:`search-language search-${l.has(r)?"valid":"invalid"}`,children:[s.jsx("input",{type:"checkbox",name:`language-${r}`,id:`language-${r}`,checked:e.includes(r),onChange:w=>{w.target.checked&&!e.includes(r)?o(e.concat([r])):!w.target.checked&&e.includes(r)&&o(e.filter(g=>g!==r))}}),s.jsxs("label",{htmlFor:`language-${r}`,children:[s.jsx("span",{className:"search-language-code",children:s.jsx("abbr",{title:p,children:s.jsx("span",{translate:"no",children:h})})}),s.jsx("span",{className:"search-language-name",style:i?ae(p,12):ae(p,15),children:p})]})]},r))}),s.jsxs("div",{className:"item-group",children:[s.jsx("button",{disabled:e.length===t.languages.length,onClick:()=>{o(t.languages)},children:a("selectAll")}),s.jsx("button",{disabled:e.length===0,onClick:()=>{o([])},children:a("deselectAll")})]})]})}function gt({corpus:t,filtersVisible:n,collections:e,setCollections:o,languages:a,setLanguages:i}){const l=d.useRef(null),r=()=>l.current?.style.setProperty("--search-filters-height",`${l.current.scrollHeight}px`);return d.useEffect(()=>{if(!CSS.supports("interpolate-size","allow-keywords"))return r(),window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[]),s.jsx("div",{ref:l,className:`search-filters search-filters-${n?"show":"hide"}`,children:s.jsxs(s.Fragment,{children:[s.jsx(dt,{corpus:t,collections:e,languages:a,setCollections:o}),s.jsx("div",{className:"search-filters-divider"}),s.jsx(ht,{corpus:t,collections:e,languages:a,setLanguages:i})]})})}const he=t=>Array.isArray(t)&&t.every(n=>typeof n=="string"),mt=t=>{const n=t.languages.filter(i=>i.startsWith(K.language.split("-")[0])),e={...st(t),languages:n.length===0?t.languages.filter(i=>i.startsWith("en")):n},o=G("corpus-params");if(o===null)return e;const a=xe(o);return typeof a=="object"&&a!==null&&("query"in a&&typeof a.query=="string"&&(e.query=a.query),"type"in a&&ce(a.type)&&(e.type=a.type),"caseInsensitive"in a&&typeof a.caseInsensitive=="boolean"&&(e.caseInsensitive=a.caseInsensitive),"common"in a&&typeof a.common=="boolean"&&(e.common=a.common),"script"in a&&typeof a.script=="boolean"&&(e.script=a.script),"showAllLanguages"in a&&typeof a.showAllLanguages=="boolean"&&(e.showAllLanguages=a.showAllLanguages),"collections"in a&&he(a.collections)&&a.collections.every(i=>t.isCollectionKey(i))&&(e.collections=a.collections),"languages"in a&&he(a.languages)&&a.languages.every(i=>t.isLanguageKey(i))&&(e.languages=a.languages)),e},ft=[Z[3],Z[0],Z[1],Z[2]];function pt({corpus:t,waiting:n,inProgress:e,postToWorker:o,terminateWorker:a}){const{t:i}=q(),l=d.useMemo(()=>mt(t),[t]),[r,p]=d.useState(l.query),[h,w]=d.useState(l.type),[g,S]=d.useState(l.caseInsensitive),[P,C]=d.useState(l.common),[R,I]=d.useState(l.script),[N,D]=d.useState(l.showAllLanguages),[F,f]=d.useState(l.collections),[j,_]=d.useState(l.languages),[b,v]=d.useState((G("corpus-filtersVisible")??(window.location.hash?"false":"true"))!=="false"),k=d.useMemo(()=>_e(t),[t]),M=d.useCallback(()=>{const m=k.hashToSearchParams(window.location.hash.substring(1));if(m.query!==void 0&&p(m.query),m.type!==void 0&&w(m.type),m.caseInsensitive!==void 0&&S(m.caseInsensitive),m.common!==void 0&&C(m.common),m.script!==void 0&&I(m.script),m.showAllLanguages!==void 0&&D(m.showAllLanguages),m.collections!==void 0&&f(m.collections),m.languages!==void 0&&_(m.languages),m.id!==void 0&&m.id!==""){const B=m.id.split(".")[0];o({query:`^${ue(m.id)}$`,type:"regex",caseInsensitive:!1,common:!0,script:!0,showAllLanguages:!0,collections:t.collections.filter(H=>t.getCollection(H).id===B),languages:[Q]});return}if(m.file!==void 0&&m.file!==""){const B=m.file.split(".")[0];o({query:`^${ue(m.file)}\\..*$`,type:"regex",caseInsensitive:!1,common:!0,script:!0,showAllLanguages:!0,collections:t.collections.filter(H=>t.getCollection(H).id===B),languages:[Q]});return}if(m.run!==void 0&&m.run){const B={query:m.query??l.query,type:m.type??l.type,caseInsensitive:m.caseInsensitive??l.caseInsensitive,common:m.common??l.common,script:m.script??l.script,showAllLanguages:m.showAllLanguages??l.showAllLanguages,collections:m.collections??l.collections,languages:m.languages??l.languages};window.location.hash=k.searchParamsToHash(B),o(B);return}G("corpus-filtersVisible")===null&&v(!m.query||!m.collections||!m.languages)},[o,l]);d.useEffect(()=>(window.location.hash&&M(),window.addEventListener("hashchange",M),()=>{window.removeEventListener("hashchange",M)}),[M]),d.useEffect(()=>{J("corpus-params",JSON.stringify({query:r,type:h,caseInsensitive:g,common:P,script:R,showAllLanguages:N,collections:F,languages:j}))},[r,h,g,P,R,N,F,j]);const V=m=>{m.preventDefault(),G("corpus-filtersVisible")||J("corpus-filtersVisible",b.toString());const B=document.getElementsByClassName("view-search").item(0);B&&B.scrollHeight>document.body.clientHeight&&v(!1);const H={query:r,type:h,caseInsensitive:g,common:P,script:R,showAllLanguages:N,collections:F,languages:j};window.location.hash=k.searchParamsToHash(H),o(H)},L=()=>{a()},x=()=>{const m=!b;v(m),J("corpus-filtersVisible",m.toString())},A=m=>{const B=m.target.value;ce(B)&&w(B)},O=n||e||r.length===0||F.length===0||j.length===0,U=d.useMemo(()=>s.jsx(gt,{corpus:t,filtersVisible:b,collections:F,setCollections:f,languages:j,setLanguages:_}),[b,F,j]);return s.jsxs("form",{className:"search-form",role:"search",onSubmit:V,children:[s.jsxs("div",{className:"search-bar",children:[s.jsxs("div",{className:"item-group",children:[s.jsx("label",{htmlFor:"query",children:i("query")}),s.jsx("input",{type:"search",name:"query",id:"query",value:r,onChange:m=>{p(m.target.value)}}),s.jsxs("div",{className:"btn-alternate-container",children:[s.jsx("input",{id:"submit",type:"submit",className:e?"invisible":"visible",value:i("search"),disabled:O}),s.jsx("button",{type:"button",className:e?"visible":"invisible",onClick:L,disabled:!e,children:i("cancel")})]}),s.jsx("button",{type:"button",className:b?"active":void 0,onClick:x,children:i("filters")}),s.jsx("select",{name:"type",id:"type",onChange:A,value:h,title:i("searchType.searchType"),"aria-label":i("searchType.searchType"),children:ft.map(m=>s.jsx("option",{value:m,children:i(`searchType.${m}`)},m))})]}),s.jsxs("div",{className:"item-group search-option-group",children:[s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"caseInsensitive",id:"caseInsensitive",checked:g,onChange:m=>{S(m.target.checked)}}),s.jsx("label",{htmlFor:"caseInsensitive",children:i("caseInsensitive")})]}),s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"common",id:"common",checked:P,onChange:m=>{C(m.target.checked)}}),s.jsx("label",{htmlFor:"common",children:i("common")})]}),s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"script",id:"script",checked:R,onChange:m=>{I(m.target.checked)}}),s.jsx("label",{htmlFor:"script",children:i("script")})]}),s.jsxs("div",{className:"search-option",children:[s.jsx("input",{type:"checkbox",name:"showAllLanguages",id:"showAllLanguages",checked:N,onChange:m=>{D(m.target.checked)}}),s.jsx("label",{htmlFor:"showAllLanguages",children:i("showAllLanguages")})]})]})]}),U]})}function jt({src:t,active:n=!0}){const e=d.useRef(null);d.useEffect(()=>{e.current?.classList.add("spinner-stopped")},[]),d.useEffect(()=>{const a=e.current;if(a!==null){const i=()=>{n||a.classList.add("spinner-stopped")};return a.addEventListener("animationiteration",i),()=>{a.removeEventListener("animationiteration",i)}}},[n]);const o=["spinner",n?"spinner-active":"spinner-inactive"];return s.jsx("img",{ref:e,className:o.join(" "),src:t,alt:""})}function Ce({progress:t}){const{t:n}=q(),e=Math.min(Math.max(0,t*100),100);return s.jsxs("div",{className:"progress-bar-container",role:"progressbar","aria-label":n("progressBar.title"),"aria-valuenow":e,children:[s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-bar-complete",style:{width:`${e}%`,maxWidth:e===0?0:void 0,visibility:e===0?"hidden":void 0}})}),s.jsx("div",{className:"progress-bar-text",children:n("progressBar.value",Ge(t))})]})}const vt=t=>{if("share"in navigator){const n=t.currentTarget.href;t.preventDefault(),navigator.share({url:n}).catch(e=>{e instanceof Error&&e.name!=="AbortError"||(console.error(e),window.open(n,"_blank"))})}};function xt({hash:t}){const{t:n}=q();return s.jsx("a",{href:t,rel:"bookmark noreferrer",target:"_blank",title:n("share"),onClick:vt,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#share"})})})}function wt({hash:t,callback:n}){const{t:e}=q();return s.jsx("a",{href:t,rel:"bookmark noreferrer",title:e("viewNearby"),onClick:n,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#file-lines"})})})}function bt({callback:t}){const{t:n}=q();return s.jsx("button",{className:"link",title:n("copy"),onClick:t,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#copy"})})})}function yt(t,n,e,o,a){return t.replaceAll(/<a class="speaker" data-var="(.+?)">(.+?)<\/a>/gu,(i,l,r)=>`<a class="speaker" href="#${n.searchParamsToHash({query:l,type:"exact",caseInsensitive:!1,common:!1,script:!0,showAllLanguages:!1,collections:[e],languages:[o],run:!0})}" title="${a}" translate="yes"><span translate="no">${r}</span></a>`)}const _t=(t,n)=>n===Q?t.replaceAll(/([._/]|([a-z])(?=[A-Z])|([A-Za-z])(?=[0-9]))/gu,"$1<wbr>"):t;function St(){const{t}=q();return s.jsx("div",{className:"results-rendering",children:t("status.rendering")})}function Ct({id:t}){return s.jsx("td",{className:"results-table-actions-cell",translate:"yes",children:s.jsxs("div",{className:"results-table-actions",children:[s.jsx(xt,{hash:`#id=${t}`}),s.jsx(wt,{hash:`#file=${t.split(".").slice(0,-1).join(".")}`})]})},"actions")}function Lt({corpus:t,index:n,collection:e,file:o,languages:a,lines:i,start:l,end:r,showId:p,richText:h,sectionOffset:w,onShowSection:g,searchParamsFactory:S}){const{t:P}=q(),C=a.indexOf(Q),R=a.map(v=>v===Q?at:v),I=P("viewSpeaker"),N=t.getCollection(e).speaker!==void 0,D=R.map(v=>K.dir(v)),F=D.every(v=>v===D[0]),f=d.useRef(null),j=()=>{const v=f.current,k=window.getSelection();k!==null&&v!==null&&(k.removeAllRanges(),k.selectAllChildren(v),document.execCommand("copy"),k.removeAllRanges())},_=["results-table",`collection-${t.getCollection(e).id??e.toLowerCase()}`,`file-${o}`,`rich-text-${h?"enabled":"disabled"}`];t.getCollection(e).softWrap===!0&&_.push("soft");const b=s.jsx("div",{className:"results-table-container",children:s.jsxs("table",{ref:f,className:_.join(" "),children:[s.jsx("thead",{children:s.jsxs("tr",{children:[C!==-1&&s.jsx("th",{className:"results-table-actions-cell",children:s.jsx(bt,{callback:j})}),a.filter(v=>p||v!==Q).map(v=>s.jsx("th",{children:s.jsx("abbr",{title:P(`languages:${v}.name`),children:s.jsx("span",{translate:"no",children:P(`languages:${v}.code`)})})},v))]})}),s.jsx("tbody",{dir:F&&D[0]!==K.dir()?D[0]:void 0,translate:"no",children:i.map((v,k)=>l<=k&&k<r&&s.jsxs("tr",{"data-id":C!==-1?v[C]:void 0,children:[C!==-1&&s.jsx(Ct,{id:v[C]}),v.map((M,V)=>{if(p||a[V]!==Q)return s.jsx("td",{lang:R[V],dir:F?void 0:D[V],dangerouslySetInnerHTML:{__html:_t(N?yt(M,S,e,a[V],I):M,a[V])}},V)})]},k))})]})});return s.jsxs(s.Fragment,{children:[l!==0&&s.jsx("button",{className:"results-notice",onClick:g(w,n),children:P("tablePartial",{count:l})}),l!==r&&b,r<i.length&&s.jsx("button",{className:"results-notice",onClick:g(w+r,n),children:P("tablePartial",{count:i.length-r})})]})}function Et(t){const{index:n,status:e,header:o,offset:a,limit:i,lines:l,sectionOffset:r,richText:p}=t,h=Math.max(0,Math.min(l.length,a-r)),w=Math.max(0,Math.min(l.length,a+i-r)),g=d.useMemo(()=>{switch(e){case"noLines":return;case"worker":return s.jsx(St,{});case"done":return s.jsx(Lt,{...t,start:h,end:w})}},[e,h,w,p]);return g&&s.jsxs("section",{id:`results-section${n}`,className:"results-section",children:[o&&s.jsx("h2",{children:o}),g]})}function kt({results:t,headers:n,jumpTo:e,...o}){const a=d.useMemo(()=>_e(o.corpus),[o.corpus]),i=d.useMemo(()=>{let l=0;const r=[];for(const[p,h]of t.entries()){if(h.status==="initial")break;const w=h.status==="done"&&h.richText;r.push({...o,...h.params,index:p,sectionOffset:l,richText:w,status:h.status,header:n[p],searchParamsFactory:a}),l+=h.params.lines.length}return r},[t,o]);return d.useEffect(()=>{let l=0;for(const[r,p]of t.entries())if(p.status!=="initial"){if(o.offset>=l&&o.offset<l+p.params.lines.length){e(r);break}l+=p.params.lines.length}},[o.offset]),s.jsx("div",{className:"app-window-inner",children:i.map(l=>s.jsx(Et,{...l},l.index))})}function ee(t){const n=document.getElementById("results"),e=document.getElementById(`results-section${t}`),o=n?.firstElementChild;n&&e&&o instanceof HTMLElement&&(n.scrollTop=e.offsetTop-o.offsetTop)}function Pt({headers:t}){const{t:n}=q();return s.jsx("nav",{className:"results-jump",children:s.jsxs("select",{name:"jump",id:"jump",onChange:e=>{ee(Number(e.target.value))},value:"",children:[s.jsx("option",{value:"",disabled:!0,children:n("jumpTo")}),t.map((e,o)=>e!==void 0&&(o===0||t[o-1]!==e)&&s.jsx("option",{value:o,children:e},o))]})})}function At({count:t,offset:n,limit:e,setOffset:o}){const{t:a}=q();return s.jsxs("div",{className:"results-nav",children:[s.jsxs("div",{children:[s.jsx("span",{className:"results-nav-range-long",children:a("displayedRange.long",{count:t,start:n+1,end:Math.min(t,n+e)})}),s.jsx("span",{className:"results-nav-range-short",children:a("displayedRange.short",{count:t,start:n+1,end:Math.min(t,n+e)})})]}),s.jsx("button",{className:"button-square",disabled:n===0,onClick:()=>{o(Math.max(0,n-e))},title:a("loadPrev"),children:a("icons:loadPrev",{limit:e})}),s.jsx("button",{className:"button-square",disabled:n+e>=t,onClick:()=>{o(Math.min(Math.floor(t/e)*e,n+e))},title:a("loadNext"),children:a("icons:loadNext",{limit:e})})]})}const ge={showVariables:0,showAllCharacters:!1,showGender:2,showPlural:0,showGrammar:!0,showFurigana:!0},Rt=()=>{const t=G("corpus-toggle");if(t===null)return ge;const n={...ge},e=xe(t);return typeof e=="object"&&e!==null&&("showVariables"in e&&typeof e.showVariables=="number"&&[0,1,2].includes(e.showVariables)&&(n.showVariables=e.showVariables),"showAllCharacters"in e&&typeof e.showAllCharacters=="boolean"&&(n.showAllCharacters=e.showAllCharacters),"showGender"in e&&typeof e.showGender=="number"&&[0,1,2].includes(e.showGender)&&(n.showGender=e.showGender),"showPlural"in e&&typeof e.showPlural=="number"&&[0,1,2].includes(e.showPlural)&&(n.showPlural=e.showPlural),"showGrammar"in e&&typeof e.showGrammar=="boolean"&&(n.showGrammar=e.showGrammar),"showFurigana"in e&&typeof e.showFurigana=="boolean"&&(n.showFurigana=e.showFurigana)),n};function Nt({corpus:t,status:n,progress:e,results:o,showId:a=!0,richText:i=!0,limit:l=ne}){const{t:r}=q(),p=d.useMemo(Rt,[]),[h,w]=d.useState(p.showVariables),[g,S]=d.useState(p.showAllCharacters),[P,C]=d.useState(p.showGender),[R,I]=d.useState(p.showPlural),[N,D]=d.useState(p.showGrammar),[F,f]=d.useState(p.showFurigana),[j,_]=d.useState(null),[b,v]=d.useState(0);d.useEffect(()=>{J("corpus-toggle",JSON.stringify({showVariables:h,showAllCharacters:g,showGender:P,showPlural:R,showGrammar:N,showFurigana:F}))},[h,g,P,R,N,F]);const k=d.useCallback((m,B)=>()=>{v(m),ee(B)},[]),M=d.useMemo(()=>{const m=[];let B="";for(const H of o){if(H.status==="initial"||H.status==="noLines"){m.push(void 0);continue}const{collection:z,file:c}=H.params,u=r("tableHeader",{collection:r(`collections:${z}.name`),file:r(`files:${c}`),interpolation:{escapeValue:!1}});m.push(u===B?void 0:u),B=u}return m},[o,K.language]),V=d.useMemo(()=>o.reduce((m,B)=>m+(B.status==="initial"?0:B.params.lines.length),0),[o]);V<b&&v(m=>Math.min(m,V));const L=s.jsxs("div",{className:"results-toggle",children:[s.jsx("button",{className:h!==2?"button-square active":"button-square",disabled:!i,onClick:()=>{w((h+1)%3)},title:r("showVariables"),children:s.jsx("span",{translate:"no",children:r("icons:showVariables",{context:h})})}),s.jsx("button",{className:g?"button-square active":"button-square",disabled:!i,onClick:()=>{S(!g)},title:r("showAllCharacters"),children:s.jsx("span",{translate:"no",children:r("icons:showAllCharacters")})}),s.jsx("button",{className:P!==2?"button-square active":"button-square",disabled:!i,onClick:()=>{C((P+1)%3)},title:r("showGender"),children:s.jsx("span",{translate:"no",children:r("icons:showGender",{context:P})})}),s.jsx("button",{className:R!==0?"button-square active":"button-square",disabled:!i,onClick:()=>{I((R+1)%3)},title:r("showPlural"),children:s.jsx("span",{translate:"no",children:r("icons:showPlural",{context:R})})}),s.jsx("button",{className:N?"button-square active":"button-square",disabled:!i,onClick:()=>{D(!N)},title:r("showGrammar"),children:s.jsx("span",{translate:"no",children:r("icons:showGrammar")})}),s.jsx("button",{className:F?"button-square active":"button-square",disabled:!i,onClick:()=>{f(!F)},title:r("showFurigana"),children:s.jsx("span",{className:"results-toggle-furigana",translate:"no",children:r("icons:showFurigana")})})]});d.useEffect(()=>{d.startTransition(()=>{_(s.jsx(kt,{corpus:t,results:o,headers:M,showId:a,offset:b,limit:l,onShowSection:k,jumpTo:ee}))})},[t,o,M,a,b,l,k,ee]);const x=be(n),A=r(`status.${n.split(".",1)[0]}`),O=d.useMemo(()=>!x&&M.filter(m=>m!==void 0).length>1?s.jsx(Pt,{headers:M}):s.jsx("div",{className:"results-status-text",children:A}),[x,M]),U=`app-window variables-${["short","show","hide"][h]} control-${g?"show":"hide"} gender-${P} number-${R} grammar-${N?"show":"hide"} furigana-${F?"show":"hide"}`;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"results-status",children:[O,s.jsx(jt,{src:"logo.svg",active:x}),!x&&V>l?s.jsx(At,{count:V,offset:b,limit:l,setOffset:v}):s.jsx(Ce,{progress:e}),L]}),s.jsx("main",{id:"results",className:U,children:j})]})}const Mt={status:"initial"},me="corpus-warn",Tt=2e7;function It({loader:t,showModal:n,richText:e,limit:o}){const{t:a}=q(),i=d.useRef(null),l=d.useRef(null),r=d.useRef([]),p=d.useRef(e),h=d.useRef(G(me)!=="false"),[w,g]=d.useState("initial"),[S,P]=d.useState(0),[C,R]=d.useState(!0),[I,N]=d.useState([]);d.useEffect(()=>{p.current=e;for(const{index:x,params:A}of r.current)f(x,A)},[e]);const D=(x,A)=>{N(O=>{const U=Array().concat(O);for(let m=U.length;m<x;m++)U[m]=Mt;return U[x]=A,U})},F=x=>{D(x.data.index,{status:"done",params:x.data,richText:x.data.richText}),x.data.error&&n({message:a("statusModal.error"),buttons:[{message:a("statusModal.buttons.ok"),autoFocus:!0}]})},f=(x,A)=>{l.current===null&&(console.log("Creating new TextWorker..."),l.current=new Xe,l.current.addEventListener("message",F)),l.current.postMessage({...A,index:x,richText:p.current,corpusLiterals:t.corpus.getCollection(A.collection).literals})},j=x=>{if(g(x.data.status),P(x.data.progress),R(x.data.showId),"index"in x.data&&"result"in x.data){const{index:A,result:O}=x.data;x.data.result.lines.length===0?D(A,{status:"noLines",params:O}):(r.current.push({index:A,params:O}),D(A,{status:"worker",params:O}),f(A,O))}x.data.complete&&et(x.data.status)&&n({message:a(`statusModal.${x.data.status}`),buttons:[{message:a("statusModal.buttons.ok"),autoFocus:!0}]})},_=d.useCallback(()=>{console.log("Terminating workers!"),i.current!==null&&(i.current.removeEventListener("message",j),i.current.terminate(),i.current=null),l.current!==null&&(l.current.removeEventListener("message",j),l.current.terminate(),l.current=null),g("initial"),P(0),N([]),r.current=[]},[]),b=x=>{N([]),r.current=[],x.query.length>0&&x.collections.length>0&&x.languages.length>0&&(i.current===null&&(console.log("Creating new SearchWorkerManager..."),i.current=new Qe,i.current.addEventListener("message",j)),g("waiting"),P(0),i.current.postMessage({...x,serializedCorpus:Se(t.corpus)}))},v=d.useCallback(x=>{if(!h.current){b(x);return}t.getDownloadSizeTotal().then(A=>{if(A<=Tt){b(x);return}n({message:a("searchModal.message",X(A)),checkbox:{message:a("searchModal.checkboxDoNotShowAgain"),checked:!1},buttons:[{message:a("searchModal.buttons.yes"),callback:()=>{b(x)},checkboxCallback:O=>{h.current=!O,J(me,(!O).toString())}},{message:a("searchModal.buttons.no"),callback:()=>{g("initial")},autoFocus:!0}],cancelCallback:()=>{g("initial")}})}).catch(A=>{console.error(A)})},[t.getDownloadSizeTotal]),k=be(w),M=w==="waiting",V=d.useMemo(()=>s.jsx(pt,{corpus:t.corpus,inProgress:k,waiting:M,postToWorker:v,terminateWorker:_}),[t.corpus,k,M,v,_]),L=d.useMemo(()=>s.jsx(Nt,{corpus:t.corpus,status:w,progress:S,showId:C,richText:e,results:I,limit:o}),[t.corpus,w,S,C,e,I,o]);return s.jsxs("div",{className:"search",children:[V,L]})}function Ft(t){return new Worker("/poke-corpus/assets/cacheManagerWorker-CALPWuuA.js",{name:t?.name})}function Dt({callback:t}){const{t:n}=q();return s.jsx("button",{className:"link",title:n("delete"),onClick:t,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#trash-can"})})})}function Ot({callback:t}){const{t:n}=q();return s.jsx("button",{className:"link",title:n("refresh"),onClick:t,children:s.jsx("svg",{className:"icon",children:s.jsx("use",{href:"sprites.svg#arrows-rotate"})})})}function Vt({cacheStorageEnabled:t,cachedMetadata:n}){const{t:e}=q(),o=d.useMemo(()=>X(n.reduce((a,[,i])=>a+i,0)),[n]);return s.jsxs("ul",{children:[s.jsx("li",{children:e("cache.storageStatus",{val:e(t?"cache.storageEnabled":"cache.storageDisabled")})}),t&&s.jsx("li",{children:e("cache.filesStored",{count:n.length})}),t&&s.jsx("li",{children:e("cache.storageUsed",o)})]})}function $t({loadedBytes:t,totalBytes:n,progress:e}){const{t:o}=q();return s.jsxs("div",{className:"cache-entry-notice",children:[o("cache.loading",{message:o("cache.inProgress"),loaded:o("cache.size",X(t)),total:o("cache.size",X(n))}),s.jsx(Ce,{progress:e})]})}function qt({corpus:t,cachedMetadata:n,cacheCollections:e,clearCachedFile:o}){const{t:a}=q(),i=d.useMemo(()=>t.collections.map(r=>{const p=n.filter(([[h]])=>r===h);return[r,p.reduce((h,[,w])=>h+w,0),p.every(([,,h])=>h)]}).filter(([,r])=>r>0),[n]);return s.jsx("div",{className:"cache-entry-list",children:n.length>0&&i.map(([l,r,p],h)=>s.jsxs("div",{className:`cache-entry cache-entry-${p?"current":"outdated"}`,children:[s.jsxs("div",{className:"cache-entry-text",children:[s.jsx("div",{children:s.jsx("abbr",{title:a(`collections:${l}.name`),children:s.jsx("span",{translate:"no",children:a(`collections:${l}.short`)})})}),s.jsx("div",{translate:"no",children:a("cache.size",X(r))})]}),s.jsxs("div",{className:"cache-entry-actions",children:[!p&&s.jsx(Ot,{callback:()=>{e(l)}}),s.jsx(Dt,{callback:()=>{o(l)}})]})]},h))})}function Bt({active:t,loader:n,showModal:e}){const{t:o}=q(),[a,i]=d.useState(!1),[l,r]=d.useState([]),[p,h]=d.useState(!1),[w,g]=d.useState(0),[S,P]=d.useState(0),[C,R]=d.useState(0),I=d.useRef(null),N=async()=>{i("caches"in window&&await window.caches.keys().then(()=>!0).catch(()=>!1))},D=L=>{const{status:x,loadedBytes:A,totalBytes:O,requestedCollection:U}=L.data;switch(g(A/O),P(A),R(O),x){case"loading":return;case"done":console.log("Caching complete");break;case"error":console.log("Caching error");break}I.current?.terminate(),I.current=null,h(!1),j(U)},F=d.useCallback(L=>{"caches"in window&&(h(!0),g(0),P(0),I.current===null&&(console.log("Creating new CacheManagerWorker..."),I.current=new Ft,I.current.addEventListener("message",D),I.current.postMessage({serializedCorpus:Se(n.corpus),requestedCollection:L})))},[n]),f=async(L="background")=>{if("caches"in window&&"indexedDB"in window&&"databases"in window.indexedDB){const[x,A]=await Promise.all([n.getCache(),n.getIndexedDB()]),O=n.corpus.entries.flatMap(([z,c])=>c.files.flatMap(u=>c.languages.map(y=>[z,y,u]))),U=O.map(([z,c,u])=>n.getFilePath(z,c,u)),m=await Promise.all(U.map(z=>n.getFileCacheOnly(x,A,z).then(async([c,u])=>[c!==void 0?(await c.blob()).size:-1,u])));r(m.map(([z,c],u)=>[O[u],z,c]).filter(([,z])=>z!==-1));const B=new Set(U),H=(await n.getAllLocalFilePaths()).filter(z=>!B.has(z));await Promise.all(H.flatMap(z=>n.deleteLocalMetadata(A,z).then(()=>x.delete(z)).then(()=>{console.debug(`Deleted ${z} from cache`)}))),A.close(),L==="cacheAll"&&m.some(([z,c])=>z===-1||!c)&&M()}},j=L=>{f(L).catch(x=>{console.error(x)})},_=()=>{const L=[];I.current&&(I.current.terminate(),I.current=null),"serviceWorker"in navigator&&L.push(navigator.serviceWorker.ready.then(x=>x.unregister())),"indexedDB"in window&&"databases"in window.indexedDB&&L.push(n.clearLocalMetadata().then(()=>f())),"caches"in window&&L.push(n.getCache().then(x=>x.keys().then(A=>Promise.all(A.map(O=>x.delete(O)))))),Promise.all(L).then(()=>{console.log("Cache cleared")}).catch(x=>{console.log("Error clearing cache"),console.error(x)})},b=async L=>{if("caches"in window&&"indexedDB"in window&&"databases"in window.indexedDB){const[x,A]=await Promise.all([n.getCache(),n.getIndexedDB()]);await Promise.all(n.corpus.getCollection(L).languages.flatMap(O=>n.corpus.getCollection(L).files.flatMap(U=>{const m=n.getFilePath(L,O,U);return[n.deleteLocalMetadata(A,m),x.delete(m)]}))),A.close(),await f()}},v=d.useCallback(L=>{b(L).catch(x=>{console.error(x)})},[]);d.useEffect(()=>{Promise.all([N(),f()]).catch(L=>{console.error(L)})},[t,n.corpus.entries,n.corpus.metadata]);const k=()=>{n.getDownloadSizeTotal().then(L=>{e({message:o("cache.cacheAllModal.message",X(L)),buttons:[{message:o("cache.cacheAllModal.buttons.yes"),callback:()=>{F("cacheAll")}},{message:o("cache.cacheAllModal.buttons.no"),callback:()=>{h(!1)},autoFocus:!0}],cancelCallback:()=>{h(!1)}})}).catch(L=>{console.error(L)})},M=()=>{e({message:o("cache.cacheAllFailedModal.message"),buttons:[{message:o("cache.cacheAllFailedModal.buttons.ok"),autoFocus:!0}]})},V=()=>{e({message:o("cache.clearCacheModal.message"),buttons:[{message:o("cache.clearCacheModal.buttons.yes"),callback:_},{message:o("cache.clearCacheModal.buttons.no"),autoFocus:!0}]})};return t&&s.jsxs("div",{className:"cache",children:[s.jsxs("div",{className:"cache-button-group item-group",children:[s.jsx("button",{onClick:k,disabled:p!==!1,children:o("cacheAll")}),s.jsx("button",{onClick:V,children:o("clearCache")})]}),s.jsx("div",{className:"cache-results app-window",children:s.jsxs("div",{className:"app-window-inner",children:[s.jsx(Vt,{cacheStorageEnabled:a,cachedMetadata:l}),p?s.jsx($t,{loadedBytes:S,totalBytes:C,progress:w}):s.jsx(qt,{corpus:n.corpus,cachedMetadata:l,cacheCollections:F,clearCachedFile:v})]})})]})}function zt({classes:t,message:n,buttons:e,checkbox:o,cancelCallback:a}){const[i,l]=d.useState(n!==void 0),[r,p]=d.useState(o?.checked??!1),h=d.useRef(null),w=d.useRef(null);d.useEffect(()=>{const C=h.current,R=w.current;if(C!==null)if(i){if(C.showModal(),e){const I=e.findIndex(N=>N.autoFocus);R!==null&&I!==-1&&Array.from(R.children).filter(N=>N instanceof HTMLButtonElement)[I].focus()}}else C.close()},[i]);const g=(C,R)=>()=>{l(!1),C&&C(),R&&R(r)},S=()=>{a&&a(),l(!1)};if(!i)return null;const P=["modal"];return t&&t.forEach(C=>P.push(C)),s.jsxs("dialog",{ref:h,id:"modal",className:P.join(" "),onCancel:S,children:[s.jsx("div",{className:"modal-message",children:n}),o&&s.jsx("div",{className:"modal-checkbox",children:s.jsxs("div",{children:[s.jsx("input",{type:"checkbox",id:"modalCheckbox",name:"modalCheckbox",checked:r,onChange:C=>{p(C.target.checked)}}),s.jsx("label",{htmlFor:"modalCheckbox",children:o.message})]})}),s.jsx("div",{ref:w,className:"modal-button-group",children:e?.map(({message:C,callback:R,checkboxCallback:I,autoFocus:N},D)=>s.jsx("button",{type:"button",onClick:g(R,I),autoFocus:N,children:C},D))})]})}function oe(){const{t}=q();return s.jsx("div",{className:"app-window",children:s.jsx("div",{className:"app-window-inner",children:s.jsxs("section",{className:"results-section",children:[s.jsx("h2",{children:t("error.title")}),s.jsx("div",{children:t("error.message")})]})})})}const ie="corpus",te=t=>"/poke-corpus/"+t,Ut=te("data.json"),Wt=t=>{const n=f=>w(f).size,e=async(f,j)=>{const[_,b]=await C(f,j);return b?.hash===_.hash?0:_.size},o=async(f=t.collections)=>{try{const j=await h(),_=(await Promise.all(f.flatMap(b=>t.getCollection(b).languages.flatMap(v=>t.getCollection(b).files.map(k=>e(j,Y(b,v,k))))))).reduce((b,v)=>b+v,0);return j.close(),_}catch{return f.flatMap(j=>t.getCollection(j).languages.flatMap(_=>t.getCollection(j).files.map(b=>n(Y(j,_,b))))).reduce((j,_)=>j+_,0)}},a=async(f,j,_)=>{const b=te(_),[v,k]=await C(j,_);if(k?.hash===v.hash||!navigator.onLine&&k?.hash!==void 0){const L=await D(f,b);if(L!==void 0)return L}const M=await fetch(b);return M.ok?(await F(f,b,M).then(async L=>{L&&await S(j,_)}),M):await D(f,b)??null},i=async(f,j,_)=>{const b=te(_),[v,k]=await C(j,_);return k!==void 0?[await D(f,b),k.hash===v.hash]:[void 0,!1]},l=async f=>{const j=te(f),_=await fetch(j);return _.ok?_:null},r="corpus",p="files",h=()=>{const f=indexedDB.open(r);return new Promise((j,_)=>{f.onupgradeneeded=()=>{f.result.createObjectStore(p),f.transaction!==null&&(f.transaction.oncomplete=()=>{console.log("Created object store")})},f.onsuccess=()=>{j(f.result)},f.onerror=()=>{_(f.error)}})},w=f=>t.metadata[f],g=(f,j)=>{const v=f.transaction([p],"readonly").objectStore(p).get(j);return new Promise((k,M)=>{v.onsuccess=()=>{k(ot(v.result)?v.result:void 0)},v.onerror=()=>{M(v.error)}})},S=(f,j)=>{const v=f.transaction([p],"readwrite").objectStore(p).put(w(j),j);return new Promise((k,M)=>{v.onsuccess=()=>{k(v.result===j)},v.onerror=()=>{M(v.error)}})},P=(f,j)=>{const v=f.transaction([p],"readwrite").objectStore(p).delete(j);return new Promise((k,M)=>{v.onsuccess=()=>{k(!0)},v.onerror=()=>{M(v.error)}})},C=async(f,j)=>[w(j),await g(f,j)],R=()=>h().then(f=>{const b=f.transaction(["files"],"readwrite").objectStore("files").clear();return f.close(),new Promise((v,k)=>{b.onsuccess=()=>{v(!0)},b.onerror=()=>{k(b.error)}})}),I=()=>h().then(f=>{const b=f.transaction([p],"readonly").objectStore(p).getAllKeys();return f.close(),new Promise((v,k)=>{b.onsuccess=()=>{v(b.result.filter(M=>typeof M=="string"))},b.onerror=()=>{k(b.error)}})}),N=async()=>await caches.open(ie),D=async(f,j)=>{try{return await f.match(j)}catch(_){console.error(_);return}},F=async(f,j,_)=>{try{return await f.put(j,_.clone()),!0}catch(b){return console.error(b),!1}};return{corpus:t,getFilePath:Y,getFileSize:n,getDownloadSizeTotal:o,getFile:a,getFileCacheOnly:i,getFileRemote:l,getIndexedDB:h,deleteLocalMetadata:P,clearLocalMetadata:R,getAllLocalFilePaths:I,getCache:N}};function Ht(t){return Wt(t)}function Gt(t,n=Ut){const e=()=>{t(o=>o===void 0?null:o)};Promise.all([Kt(n).then(o=>{t(a=>a===void 0&&o!==null?o:a)}).catch(o=>{console.log(o)}),Jt(n).then(o=>{t(a=>o??a)}).catch(o=>{console.log(o)})]).then(e,e)}async function Kt(t){if("caches"in window){const e=await(await caches.open(ie)).match(t);if(e?.ok)return Le(e)}return null}async function Jt(t){const n=await fetch(t);if(!n.ok)return null;if("caches"in window){const e=n.clone();caches.open(ie).then(o=>o.put(t,e)).catch(o=>{console.log(o)})}return Le(n)}async function Le(t){const n=await t.json(),e=ct(n);return Ht(e)}const fe="Search";function Zt({showModal:t,richText:n,setRichText:e,limit:o,setLimit:a,reset:i}){const{t:l}=q();return s.jsxs("header",{className:"header",children:[s.jsx("h1",{children:s.jsxs("a",{href:"/poke-corpus/",onClick:i,children:[s.jsx("img",{className:"header-logo",src:"logo.svg",alt:"",height:"40",width:"40"})," ",l("title",{version:l("version")})]})}),s.jsx(re,{fallback:null,children:s.jsx(Ze,{showModal:t,richText:n,setRichText:e,limit:o,setLimit:a})})]})}function Qt({view:t,switchView:n}){const{t:e}=q();return s.jsxs("footer",{children:[s.jsx("span",{children:e("tagline")}),s.jsx("span",{className:"separator",translate:"no",children:" | "}),s.jsx("span",{children:e("footerText")}),s.jsx("span",{className:"separator",translate:"no",children:" | "}),s.jsx("span",{children:s.jsx("button",{className:"link",onClick:n,children:e(t!=="Search"?"backToSearch":"manageCache")})}),s.jsx("span",{className:"separator",translate:"no",children:" | "}),s.jsx("span",{children:s.jsx("a",{href:"https://github.com/abcboy101/poke-corpus",children:e("github")})})]})}function Xt(){const[t,n]=d.useState(He),[e,o]=d.useState(We),[a,i]=d.useState(fe),[l,r]=d.useState(0),[p,h]=d.useState(0),[w,g]=d.useState(null),[S,P]=d.useState(!1),[C,R]=d.useState(void 0);d.useEffect(()=>{const f=ve();document.body.classList.add(`mode-${f}`),P(!0),Gt(R)},[]);const I=d.useCallback(f=>{window.location.hash="",Be("corpus-params"),i(fe),r(j=>j+1&255),h(0),g(null),f.preventDefault()},[]),N=d.useCallback(f=>{g(f),h(j=>j+1&255)},[]),D=d.useCallback(()=>{i(f=>{const j=f!=="Search"?"Search":"CacheManager";return S||P(j==="CacheManager"),j})},[]);if(C===void 0)return;const F=["app",`view-${a.toLowerCase()}`];return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&F.push("ua-safari"),s.jsxs("div",{className:F.join(" "),lang:K.language,dir:K.dir(),children:[s.jsx(Zt,{showModal:N,richText:t,setRichText:n,limit:e,setLimit:o,reset:I}),C!==null?s.jsxs(re,{FallbackComponent:oe,children:[s.jsx(It,{loader:C,showModal:N,richText:t,limit:e}),s.jsx(Bt,{active:a==="CacheManager",loader:C,showModal:N})]}):s.jsx(oe,{}),s.jsx(Qt,{view:a,switchView:D}),s.jsx(zt,{...w},p)]},l)}function Yt(){return s.jsx("div",{className:"app",children:s.jsx(oe,{})})}const es=Ne.createRoot(document.getElementById("root"));es.render(s.jsx(Re.StrictMode,{children:s.jsx(re,{FallbackComponent:Yt,children:s.jsx(Xt,{})})}));qe({onOfflineReady(){console.log("Ready to work offline!")}});
